# Deployment Documentation


---

## Tech Stack & Deployment Architecture

### Application Stack

* **Framework:** Next.js
* **Language:** JavaScript / TypeScript
* **Package Manager:** npm (can be yarn if preferred)
* **Version Control:** Git + GitHub

### Hosting & CI/CD

* **Hosting:** Hostinger (Shared Hosting)
* **Deployment Method:** GitHub Actions (CI/CD)
* **Build Output:** Static / Production build generated by Next.js
* **Transfer Method:** FTP (via GitHub Actions)

---

##  Prerequisites (New PC Setup – Windows)

These steps are written specifically for **Windows**

###  Install Node.js (Windows)

1. Download **Node.js LTS (18.x or later)** from the official website
2. Run the installer and keep default options checked
3. Restart your PC after installation

Verify installation in **Command Prompt or PowerShell**:

```bash
node -v
npm -v
```

---

###  Install Git (Windows)

1. Download Git from the official Git website
2. Run the installer
3. When prompted, select **"Git from the command line and also from 3rd-party software"**
4. Keep remaining options as default

Verify installation:

```bash
git --version
```

---

###  GitHub Account Access

* Ensure access to the **project GitHub repository**
* Permission to **push code** and **manage GitHub Actions secrets**

---

###  Hostinger Access

* Hostinger account credentials
* FTP details from hPanel:

  * FTP Host
  * FTP Username
  * FTP Password
  * Target directory (usually `public_html/`)

---

##  Project Setup on a New PC (Windows)

All commands below should be run using **Command Prompt**, **PowerShell**, or **Windows Terminal**.

### 4.1 Clone the Repository

Open Command Prompt and run:

```bash
git clone https://github.com/<username>/<repository-name>.git
cd <repository-name>
```

---

###  Install Dependencies

```bash
npm install
```

---

###  Environment Variables (Windows)

Create a file named `.env.local` in the project root folder:

```env
NEXT_PUBLIC_FIREBASE_API_KEY
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
NEXT_PUBLIC_FIREBASE_PROJECT_ID
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
NEXT_PUBLIC_FIREBASE_APP_ID
NEXT_PUBLIC_BACKEND_URL
NEXT_PUBLIC_PORT
NEXT_PUBLIC_CLOUDFLARE_WORKER_URL
NEXT_PUBLIC_MY_BUCKET
NEXT_PUBLIC_BASE_URL
NEXT_PUBLIC_CLIENT_URL 
NEXT_PUBLIC_FIREBASE_CLIENT_EMAIL
SERVICE_ACCOUNT_KEY_FIREBASE
FIREBASE_PROJECT_ID
FIREBASE_CLIENT_EMAIL
FIREBASE_SERVICE_ACCOUNT_KEY
```

> ⚠️ Do **NOT** commit `.env.local` to GitHub

---

##  Preparing the Project for Production

###  Update `next.config.js`

Ensure Next.js is configured for production:

```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  output: 'export',
};

module.exports = nextConfig;
```

###  Test Build Locally (Windows)

Run the following commands in Command Prompt:

````bash
npm run build
npm run start
```bash
npm run build
npm run start
````

Confirm the app runs correctly at:

```
http://localhost:3000
```

---

##  Hostinger Hosting Setup

###  Create Website

1. Log in to **Hostinger hPanel**
2. Create or select the domain
3. Open **File Manager**
4. Locate `public_html/`

### 6.2 Clean Target Directory

* Delete all default files inside `public_html/`

---

##  GitHub Actions CI/CD Setup

###  Create GitHub Actions Workflow

Create the following file:

```
.github/workflows/deploy.yml
```

###  GitHub Actions Configuration

```yaml
name: Deploy Next.js App to Hostinger

name: Build frontend and deploy worker

permissions:
  contents: write

on:
  push:
    branches: 
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    name: Build and Deploy

    env:
      NEXT_PUBLIC_FIREBASE_API_KEY: ${{ secrets.NEXT_PUBLIC_FIREBASE_API_KEY }}
      NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN: ${{ secrets.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN }}
      NEXT_PUBLIC_FIREBASE_PROJECT_ID: ${{ secrets.NEXT_PUBLIC_FIREBASE_PROJECT_ID }}
      NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET: ${{ secrets.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET }}
      NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID: ${{ secrets.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID }}
      NEXT_PUBLIC_FIREBASE_APP_ID: ${{ secrets.NEXT_PUBLIC_FIREBASE_APP_ID }}
      NEXT_PUBLIC_BACKEND_URL: ${{ secrets.NEXT_PUBLIC_BACKEND_URL }}
      NEXT_PUBLIC_PORT: ${{ secrets.NEXT_PUBLIC_PORT }}
      NEXT_PUBLIC_CLOUDFLARE_WORKER_URL: ${{ secrets.NEXT_PUBLIC_CLOUDFLARE_WORKER_URL }}
      NEXT_PUBLIC_MY_BUCKET: ${{ secrets.NEXT_PUBLIC_MY_BUCKET }}
      NEXT_PUBLIC_BASE_URL: ${{ secrets.NEXT_PUBLIC_BASE_URL }}
      NEXT_PUBLIC_CLIENT_URL: ${{ secrets.NEXT_PUBLIC_CLIENT_URL }}
      SERVICE_ACCOUNT_KEY_FIREBASE: ${{ secrets.SERVICE_ACCOUNT_KEY_FIREBASE }}
      FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
      FIREBASE_CLIENT_EMAIL: ${{ secrets.FIREBASE_CLIENT_EMAIL }}
      FIREBASE_SERVICE_ACCOUNT_KEY: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_KEY }}

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Debug repo structure
        run: ls -R

      # ─────── FRONTEND BUILD ───────
      - name: Install frontend dependencies
        working-directory: client
        run: npm install

      - name: Generate Sitemap
        working-directory: client
        run: npm run sitemap

      - name: Build frontend
        working-directory: client
        run: npm run build

      - name: Debug build output
        working-directory: client
        run: ls -la && ls -la out

      - name: Push frontend build
        uses: s0/git-publish-subdir-action@develop
        env:
          REPO: self
          BRANCH: build
          FOLDER: client/out
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          MESSAGE: "Build: ({sha}) {msg}"

      # ─────── CLOUDFLARE WORKER DEPLOY ───────
      - name: Install Wrangler
        run: npm install -g wrangler

      - name: Deploy Cloudflare Worker
        working-directory: cloudflare-upload
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
        run: wrangler deploy```

---

##  GitHub Secrets Configuration

In the GitHub repository:

1. Go to **Settings → Secrets and variables → Actions**
2. Add the following secrets:

| Secret Name  | Description        |
| ------------ | ------------------ |
| FTP_SERVER   | Hostinger FTP host |
| FTP_USERNAME | FTP username       |
| FTP_PASSWORD | FTP password       |

---

##  Deployment Process (Automatic)

Once configured, deployment works as follows:

1. Developer pushes code to `main` branch
2. GitHub Actions workflow runs automatically
3. Project is built on GitHub servers
4. Files are uploaded to Hostinger via FTP
5. Website updates go live immediately

---

