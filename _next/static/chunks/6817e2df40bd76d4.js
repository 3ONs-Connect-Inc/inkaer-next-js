(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,36180,97427,8070,83877,92953,98925,e=>{"use strict";let t,n;e.s([],36180),e.s(["AbstractUserDataWriter",()=>hZ,"AggregateField",()=>c0,"AggregateQuerySnapshot",()=>c1,"Bytes",()=>c2,"CACHE_SIZE_UNLIMITED",()=>cV,"CollectionReference",()=>cC,"DocumentReference",()=>cx,"DocumentSnapshot",()=>h7,"FieldPath",()=>c6,"FieldValue",()=>c4,"Firestore",()=>cB,"FirestoreError",()=>tO,"GeoPoint",()=>c5,"LoadBundleTask",()=>cF,"PersistentCacheIndexManager",()=>dX,"Query",()=>cS,"QueryCompositeFilterConstraint",()=>hO,"QueryConstraint",()=>hD,"QueryDocumentSnapshot",()=>de,"QueryEndAtConstraint",()=>hG,"QueryFieldFilterConstraint",()=>hk,"QueryLimitConstraint",()=>hV,"QueryOrderByConstraint",()=>hL,"QuerySnapshot",()=>dt,"QueryStartAtConstraint",()=>hq,"SnapshotMetadata",()=>h8,"Timestamp",()=>nt,"Transaction",()=>dB,"VectorValue",()=>c8,"WriteBatch",()=>dL,"_AutoId",()=>tG,"_ByteString",()=>rj,"_DatabaseId",()=>r2,"_DocumentKey",()=>t0,"_EmptyAppCheckTokenProvider",()=>tz,"_EmptyAuthCredentialsProvider",()=>tL,"_FieldPath",()=>t$,"_TestingHooks",()=>d4,"_cast",()=>t8,"_debugAssert",()=>tk,"_internalAggregationQueryToProtoRunAggregationQueryRequest",()=>d3,"_internalQueryToProtoQueryTarget",()=>d6,"_isBase64Available",()=>rq,"_logWarn",()=>tx,"_validateIsNotUsedTogether",()=>t2,"addDoc",()=>dm,"aggregateFieldEqual",()=>h3,"aggregateQuerySnapshotEqual",()=>h4,"and",()=>hP,"arrayRemove",()=>dG,"arrayUnion",()=>dz,"average",()=>h2,"clearIndexedDbPersistence",()=>cH,"collection",()=>cA,"collectionGroup",()=>cD,"connectFirestoreEmulator",()=>cT,"count",()=>h6,"deleteAllPersistentCacheIndexes",()=>d0,"deleteDoc",()=>dg,"deleteField",()=>dq,"disableNetwork",()=>cX,"disablePersistentCacheIndexAutoCreation",()=>d$,"doc",()=>cN,"documentId",()=>c3,"documentSnapshotFromJSON",()=>h9,"enableIndexedDbPersistence",()=>cG,"enableMultiTabIndexedDbPersistence",()=>cK,"enableNetwork",()=>cJ,"enablePersistentCacheIndexAutoCreation",()=>dZ,"endAt",()=>hQ,"endBefore",()=>hK,"ensureFirestoreConfigured",()=>cj,"executeWrite",()=>dw,"getAggregateFromServer",()=>d_,"getCountFromServer",()=>dI,"getDoc",()=>di,"getDocFromCache",()=>da,"getDocFromServer",()=>dl,"getDocs",()=>du,"getDocsFromCache",()=>dc,"getDocsFromServer",()=>dh,"getFirestore",()=>cq,"getPersistentCacheIndexManager",()=>dY,"increment",()=>dK,"initializeFirestore",()=>cU,"limit",()=>hB,"limitToLast",()=>hU,"loadBundle",()=>cZ,"memoryEagerGarbageCollector",()=>dC,"memoryLocalCache",()=>dD,"memoryLruGarbageCollector",()=>dA,"namedQuery",()=>c$,"onSnapshot",()=>dp,"onSnapshotResume",()=>dy,"onSnapshotsInSync",()=>dv,"or",()=>hM,"orderBy",()=>hF,"persistentLocalCache",()=>dN,"persistentMultipleTabManager",()=>dM,"persistentSingleTabManager",()=>dO,"query",()=>hN,"queryEqual",()=>cR,"querySnapshotFromJSON",()=>dn,"refEqual",()=>ck,"runTransaction",()=>dU,"serverTimestamp",()=>dj,"setDoc",()=>dd,"setIndexConfiguration",()=>dW,"setLogLevel",()=>tE,"snapshotEqual",()=>dr,"startAfter",()=>hz,"startAt",()=>hj,"sum",()=>h1,"terminate",()=>cY,"updateDoc",()=>df,"vector",()=>dQ,"waitForPendingWrites",()=>cW,"where",()=>hR,"writeBatch",()=>dH],98925);var r,i,s,a,o,l,u,c,h,d,f,g,m,p,y,v=e.i(47167),w=e.i(67034);e.s(["SDK_VERSION",()=>e3,"_DEFAULT_ENTRY_NAME",()=>eU,"_addComponent",()=>eK,"_addOrOverwriteComponent",()=>eQ,"_apps",()=>ej,"_clearComponents",()=>e$,"_components",()=>eG,"_getProvider",()=>eW,"_isFirebaseApp",()=>eX,"_isFirebaseServerApp",()=>eZ,"_isFirebaseServerAppSettings",()=>eY,"_registerComponent",()=>eH,"_removeServiceInstance",()=>eJ,"_serverApps",()=>ez,"deleteApp",()=>e9,"getApp",()=>e8,"getApps",()=>e7,"initializeApp",()=>e4,"initializeServerApp",()=>e5,"onLog",()=>tt,"registerVersion",()=>te,"setLogLevel",()=>tn],92953),e.s(["Component",()=>ed,"ComponentContainer",()=>em],8070),e.s(["Deferred",()=>O,"ErrorFactory",()=>ee,"FirebaseError",()=>$,"base64Decode",()=>x,"base64urlEncodeWithoutPadding",()=>S,"createMockUserToken",()=>L,"createSubscribe",()=>el,"deepEqual",()=>er,"extractQuerystring",()=>eo,"getDefaultAppConfig",()=>k,"getDefaultEmulatorHost",()=>D,"getDefaultEmulatorHostnameAndPort",()=>N,"getExperimentalSetting",()=>R,"getGlobal",()=>C,"getModularInstance",()=>eh,"getUA",()=>U,"isBrowser",()=>z,"isBrowserExtension",()=>Q,"isCloudWorkstation",()=>M,"isCloudflareWorker",()=>K,"isEmpty",()=>en,"isIE",()=>W,"isIndexedDBAvailable",()=>Y,"isMobileCordova",()=>q,"isReactNative",()=>H,"isSafari",()=>J,"isSafariOrWebkit",()=>X,"isWebWorker",()=>G,"pingServer",()=>P,"querystring",()=>es,"querystringDecode",()=>ea,"updateEmulatorBanner",()=>B,"validateIndexedDBOpenable",()=>Z],97427);let b=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},I=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=e[n++],a=((7&i)<<18|(63&s)<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(1023&a))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,c=(3&i)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(h=64)),r.push(n[u],n[c],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(b(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):I(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new E;let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class E extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let T=function(e){let t=b(e);return _.encodeByteArray(t,!0)},S=function(e){return T(e).replace(/\./g,"")},x=function(e){try{return _.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function C(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g}let A=()=>{try{return C().__FIREBASE_DEFAULTS__||(()=>{if(void 0===v.default||void 0===v.default.env)return;let e=v.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&x(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e));return}},D=e=>{var t,n;return null==(n=A())||null==(t=n.emulatorHosts)?void 0:t[e]},N=e=>{let t=D(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error("Invalid host ".concat(t," with no separate hostname and port!"));let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},k=()=>{var e;return null==(e=A())?void 0:e.config},R=e=>{var t;return null==(t=A())?void 0:t["_".concat(e)]};class O{wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}function M(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(e){return!1}}async function P(e){return(await fetch(e,{credentials:"include"})).ok}function L(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[S(JSON.stringify({alg:"none",type:"JWT"})),S(JSON.stringify(s)),""].join(".")}let F={},V=!1;function B(e,t){if("undefined"==typeof window||"undefined"==typeof document||!M(window.location.host)||F[e]===t||F[e]||V)return;function n(e){return"__firebase__banner__".concat(e)}F[e]=t;let r="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(F))F[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(r),t=!1,e||((e=document.createElement("div")).setAttribute("id",r),t=!0),{created:t,element:e}),a=n("text"),o=document.getElementById(a)||document.createElement("span"),l=n("learnmore"),u=document.getElementById(l)||document.createElement("a"),c=n("preprendIcon"),h=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e=s.element;e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let t=function(){let e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{V=!0;let e=document.getElementById(r);e&&e.remove()},e}();h.setAttribute("width","24"),h.setAttribute("id",c),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px",e.append(h,o,u,t),document.body.appendChild(e)}i?(o.innerText="Preview backend disconnected.",h.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(h.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function U(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function q(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(U())}function j(){var t;let n=null==(t=A())?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function z(){return"undefined"!=typeof window||G()}function G(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function K(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function Q(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function H(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function W(){let e=U();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function J(){return!j()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function X(){return!j()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Y(){try{return"object"==typeof indexedDB}catch(e){return!1}}function Z(){return new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(e){t(e)}})}class $ extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,$.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ee.prototype.create)}}class ee{create(e){for(var t,n,r=arguments.length,i=Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];let a=i[0]||{},o="".concat(this.service,"/").concat(e),l=this.errors[e],u=l?(t=l,n=a,t.replace(et,(e,t)=>{let r=n[t];return null!=r?String(r):"<".concat(t,"?>")})):"Error",c="".concat(this.serviceName,": ").concat(u," (").concat(o,").");return new $(o,c,a)}constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}}let et=/\{\$([^}]+)}/g;function en(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function er(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(ei(n)&&ei(s)){if(!er(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function ei(e){return null!==e&&"object"==typeof e}function es(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function ea(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function eo(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function el(e,t){let n=new eu(e,t);return n.subscribe.bind(n)}class eu{next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(r=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(r.next=ec),void 0===r.error&&(r.error=ec),void 0===r.complete&&(r.complete=ec);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}}function ec(){}function eh(e){return e&&e._delegate?e._delegate:e}class ed{setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}}let ef="[DEFAULT]";class eg{get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new O;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}if(r)return null;throw Error("Service ".concat(this.name," is not available"))}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ef})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ef;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ef;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ef;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;let r=this.normalizeInstanceIdentifier(t),i=null!=(n=this.onInitCallbacks.get(r))?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch(e){}}getOrInitializeService(e){var t;let{instanceIdentifier:n,options:r={}}=e,i=this.instances.get(n);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n)===ef?void 0:t,options:r}),this.instances.set(n,i),this.instancesOptions.set(n,r),this.invokeOnInitCallbacks(i,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,i)}catch(e){}return i||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ef;return this.component?this.component.multipleInstances?e:ef:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}}class em{addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eg(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}constructor(e){this.name=e,this.providers=new Map}}e.s(["LogLevel",()=>r,"Logger",()=>eI,"setLogLevel",()=>e_,"setUserLogHandler",()=>eE],83877);let ep=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(r={}));let ey={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},ev=r.INFO,ew={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},eb=function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(t<e.logLevel)return;let s=new Date().toISOString(),a=ew[t];if(a)console[a]("[".concat(s,"]  ").concat(e.name,":"),...r);else throw Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"))};class eI{get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ey[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...t),this._logHandler(this,r.DEBUG,...t)}log(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...t),this._logHandler(this,r.VERBOSE,...t)}info(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,r.INFO,...t),this._logHandler(this,r.INFO,...t)}warn(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,r.WARN,...t),this._logHandler(this,r.WARN,...t)}error(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,r.ERROR,...t),this._logHandler(this,r.ERROR,...t)}constructor(e){this.name=e,this._logLevel=ev,this._logHandler=eb,this._userLogHandler=null,ep.push(this)}}function e_(e){ep.forEach(t=>{t.setLogLevel(e)})}function eE(e,t){for(let n of ep){let i=null;t&&t.level&&(i=ey[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=function(t,n){for(var s=arguments.length,a=Array(s>2?s-2:0),o=2;o<s;o++)a[o-2]=arguments[o];let l=a.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(null!=i?i:t.logLevel)&&e({level:r[n].toLowerCase(),message:l,args:a,type:t.name})}}}let eT=new WeakMap,eS=new WeakMap,ex=new WeakMap,eC=new WeakMap,eA=new WeakMap,eD={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eS.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ex.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return eN(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eN(e){if(e instanceof IDBRequest){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eN(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&eT.set(t,e)}).catch(()=>{}),eA.set(t,e),t}if(eC.has(e))return eC.get(e);let r=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(ek(this),n),eN(eT.get(this))}:function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return eN(e.apply(ek(this),n))}:function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];let s=e.call(ek(this),t,...r);return ex.set(s,t.sort?t.sort():[t]),eN(s)};return e instanceof IDBTransaction&&function(e){if(eS.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eS.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,eD):e}(e);return r!==e&&(eC.set(e,r),eA.set(r,e)),r}let ek=e=>eA.get(e),eR=["get","getKey","getAll","getAllKeys","count"],eO=["put","add","delete","clear"],eM=new Map;function eP(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eM.get(t))return eM.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=eO.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||eR.includes(n)))return;let s=async function(e){for(var t=arguments.length,s=Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];let o=this.transaction(e,i?"readwrite":"readonly"),l=o.store;return r&&(l=l.index(s.shift())),(await Promise.all([l[n](...s),i&&o.done]))[0]};return eM.set(t,s),s}eD=(e=>({...e,get:(t,n,r)=>eP(t,n)||e.get(t,n,r),has:(t,n)=>!!eP(t,n)||e.has(t,n)}))(eD);class eL{getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}}).filter(e=>e).join(" ")}constructor(e){this.container=e}}let eF="@firebase/app",eV="0.14.3",eB=new eI("@firebase/app"),eU="[DEFAULT]",eq={[eF]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},ej=new Map,ez=new Map,eG=new Map;function eK(e,t){try{e.container.addComponent(t)}catch(n){eB.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function eQ(e,t){e.container.addOrOverwriteComponent(t)}function eH(e){let t=e.name;if(eG.has(t))return eB.debug("There were multiple attempts to register component ".concat(t,".")),!1;for(let n of(eG.set(t,e),ej.values()))eK(n,e);for(let t of ez.values())eK(t,e);return!0}function eW(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function eJ(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:eU;eW(e,t).clearInstance(n)}function eX(e){return void 0!==e.options}function eY(e){return!eX(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function eZ(e){return null!=e&&void 0!==e.settings}function e$(){eG.clear()}let e0=new ee("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class e1{get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw e0.create("app-deleted",{appName:this._name})}constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ed("app",()=>this,"PUBLIC"))}}function e2(e,t){let n=x(e.split(".")[1]);if(null===n)return void console.error("FirebaseServerApp ".concat(t," is invalid: second part could not be parsed."));if(void 0===JSON.parse(n).exp)return void console.error("FirebaseServerApp ".concat(t," is invalid: expiration claim could not be parsed"));let r=1e3*JSON.parse(n).exp;r-new Date().getTime()<=0&&console.error("FirebaseServerApp ".concat(t," is invalid: the token has expired."))}class e6 extends e1{toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){e9(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw e0.create("server-app-deleted")}constructor(e,t,n,r){let i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,r):super(e.options,s,r),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&e2(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&e2(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,te(eF,eV,"serverapp")}}let e3="12.3.0";function e4(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;"object"!=typeof t&&(t={name:t});let r={name:eU,automaticDataCollectionEnabled:!0,...t},i=r.name;if("string"!=typeof i||!i)throw e0.create("bad-app-name",{appName:String(i)});if(n||(n=k()),!n)throw e0.create("no-options");let s=ej.get(i);if(s)if(er(n,s.options)&&er(r,s.config))return s;else throw e0.create("duplicate-app",{appName:i});let a=new em(i);for(let e of eG.values())a.addComponent(e);let o=new e1(n,r,a);return ej.set(i,o),o}function e5(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(z()&&!G())throw e0.create("invalid-server-app-environment");let r=n||{};if(e&&(eX(e)?t=e.options:eY(e)?r=e:t=e),void 0===r.automaticDataCollectionEnabled&&(r.automaticDataCollectionEnabled=!0),t||(t=k()),!t)throw e0.create("no-options");let i={...r,...t};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==r.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw e0.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),a=ez.get(s);if(a)return a.incRefCount(r.releaseOnDeref),a;let o=new em(s);for(let e of eG.values())o.addComponent(e);let l=new e6(t,r,s,o);return ez.set(s,l),l}function e8(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:eU,t=ej.get(e);if(!t&&e===eU&&k())return e4();if(!t)throw e0.create("no-app",{appName:e});return t}function e7(){return Array.from(ej.values())}async function e9(e){let t=!1,n=e.name;ej.has(n)?(t=!0,ej.delete(n)):ez.has(n)&&0>=e.decRefCount()&&(ez.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function te(e,t,n){var r;let i=null!=(r=eq[e])?r:e;n&&(i+="-".concat(n));let s=i.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];s&&e.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),s&&a&&e.push("and"),a&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),eB.warn(e.join(" "));return}eH(new ed("".concat(i,"-version"),()=>({library:i,version:t}),"VERSION"))}function tt(e,t){if(null!==e&&"function"!=typeof e)throw e0.create("invalid-log-argument");eE(e,t)}function tn(e){e_(e)}let tr="firebase-heartbeat-store",ti=null;function ts(){return ti||(ti=(function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=indexedDB.open(e,t),o=eN(a);return r&&a.addEventListener("upgradeneeded",e=>{r(eN(a.result),e.oldVersion,e.newVersion,eN(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tr)}catch(e){console.warn(e)}}}).catch(e=>{throw e0.create("idb-open",{originalErrorMessage:e.message})})),ti}async function ta(e){try{let t=(await ts()).transaction(tr),n=await t.objectStore(tr).get(tl(e));return await t.done,n}catch(e){if(e instanceof $)eB.warn(e.message);else{let t=e0.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});eB.warn(t.message)}}}async function to(e,t){try{let n=(await ts()).transaction(tr,"readwrite"),r=n.objectStore(tr);await r.put(t,tl(e)),await n.done}catch(e){if(e instanceof $)eB.warn(e.message);else{let t=e0.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});eB.warn(t.message)}}}function tl(e){return"".concat(e.name,"!").concat(e.options.appId)}class tu{async triggerHeartbeat(){try{var e,t;let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=tc();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eB.warn(e)}}async getHeartbeatsHeader(){try{var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=tc(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),td(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),td(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=S(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return eB.warn(e),""}}constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new th(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}}function tc(){return new Date().toISOString().substring(0,10)}class th{async runIndexedDBEnvironmentCheck(){return!!Y()&&Z().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await ta(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){var t;let n=await this.read();return to(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){var t;let n=await this.read();return to(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}}function td(e){return S(JSON.stringify({version:2,heartbeats:e})).length}eH(new ed("platform-logger",e=>new eL(e),"PRIVATE")),eH(new ed("heartbeat",e=>new tu(e),"PRIVATE")),te(eF,eV,""),te(eF,eV,"esm2020"),te("fire-js","");var tf="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,tg={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function n(){}function r(e,t,n){n||(n=0);let r=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^n&(i^s))+r[0]+0xd76aa478|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[1]+0xe8c7b756|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[2]+0x242070db|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[3]+0xc1bdceee|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[4]+0xf57c0faf|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[5]+0x4787c62a|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[6]+0xa8304613|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[7]+0xfd469501|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[8]+0x698098d8|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[9]+0x8b44f7af|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[10]+0xffff5bb1|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[11]+0x895cd7be|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[12]+0x6b901122|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[13]+0xfd987193|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[14]+0xa679438e|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(a<<22|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,a=t+((n=i+(a<<20|a>>>12))^i^s)+r[5]+0xfffa3942|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[11]+0x6d9d6122|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[14]+0xfde5380c|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[1]+0xa4beea44|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[7]+0xf6bb4b60|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[10]+0xbebfbc70|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[13]+0x289b7ec6|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[3]+0xd4ef3085|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[6]+0x4881d05|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[9]+0xd9d4d039|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[15]+0x1fa27cf8|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(a<<23|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function a(e,t){this.h=t;let n=[],r=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let n=t-this.blockSize,i=this.C,s=this.h,a=0;for(;a<t;){if(0==s)for(;a<=n;)r(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){r(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var o,l={};function u(e){var t;return -128<=e&&e<128?(t=function(e){return new a([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new a([0|e],e<0?-1:0)}function c(e){if(isNaN(e)||!isFinite(e))return h;if(e<0)return p(c(-e));let t=[],n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new a(t,0)}var h=u(0),d=u(1),f=u(0x1000000);function g(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function p(e){let t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new a(n,~e.h).add(d)}function y(e,t){return e.add(p(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function w(e,t){this.g=e,this.h=t}function b(e,t){if(g(t))throw Error("division by zero");if(g(e))return new w(h,h);if(m(e))return t=b(p(e),t),new w(p(t.g),p(t.h));if(m(t))return t=b(e,p(t)),new w(p(t.g),t.h);if(e.g.length>30){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=I(n),r=I(r);var i=_(n,1),s=_(r,1);for(r=_(r,2),n=_(n,2);!g(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=_(r,1),n=_(n,1)}return t=y(e,i.j(t)),new w(i,t)}for(i=h;e.l(t)>=0;){for(r=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,r-48),a=(s=c(n)).j(t);m(a)||a.l(e)>0;)n-=r,a=(s=c(n)).j(t);g(s)&&(s=d),i=i.add(s),e=y(e,a)}return new w(i,e)}function I(e){let t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new a(n,e.h)}function _(e,t){let n=t>>5;t%=32;let r=e.g.length-n,i=[];for(let s=0;s<r;s++)i[s]=t>0?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new a(i,e.h)}(o=a.prototype).m=function(){if(m(this))return-p(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){let r=this.i(n);e+=(r>=0?r:0x100000000+r)*t,t*=0x100000000}return e},o.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(g(this))return"0";if(m(this))return"-"+p(this).toString(e);let t=c(Math.pow(e,6));var n=this;let r="";for(;;){let i=b(n,t).g,s=(((n=y(n,i.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(g(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},o.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},o.l=function(e){return m(e=y(this,e))?-1:+!g(e)},o.abs=function(){return m(this)?p(this):this},o.add=function(e){let t=Math.max(this.g.length,e.g.length),n=[],r=0;for(let i=0;i<=t;i++){let t=r+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=s>>>16,t&=65535,s&=65535,n[i]=s<<16|t}return new a(n,-0x80000000&n[n.length-1]?-1:0)},o.j=function(e){if(g(this)||g(e))return h;if(m(this))return m(e)?p(this).j(p(e)):p(p(this).j(e));if(m(e))return p(this.j(p(e)));if(0>this.l(f)&&0>e.l(f))return c(this.m()*e.m());let t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){let i=this.i(r)>>>16,s=65535&this.i(r),a=e.i(t)>>>16,o=65535&e.i(t);n[2*r+2*t]+=s*o,v(n,2*r+2*t),n[2*r+2*t+1]+=i*o,v(n,2*r+2*t+1),n[2*r+2*t+1]+=s*a,v(n,2*r+2*t+1),n[2*r+2*t+2]+=i*a,v(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new a(n,0)},o.B=function(e){return b(this,e).h},o.and=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new a(n,this.h&e.h)},o.or=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new a(n,this.h|e.h)},o.xor=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new a(n,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,s=tg.Md5=e,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=c,a.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return p(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=c(Math.pow(n,8)),i=h;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),n);s<8?(s=c(Math.pow(n,s)),i=i.j(s).add(c(a))):i=(i=i.j(r)).add(c(a))}return i},i=tg.Integer=a}).apply(void 0!==tf?tf:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var tm="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,tp={};(function(){var e,t,n=Object.defineProperty,r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof tm&&tm];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=r;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&n(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var s=s||{},g=this||self;function m(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function p(e,t,n){return e.call.apply(e.bind,arguments)}function y(e,t,n){return(y=p).apply(null,arguments)}function v(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function w(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}var b="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function I(e){let t=e.length;if(t>0){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function _(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];var n=typeof r;if("array"==(n="object"!=n?n:r?Array.isArray(r)?"array":n:"null")||"object"==n&&"number"==typeof r.length){n=e.length||0;let t=r.length||0;e.length=n+t;for(let i=0;i<t;i++)e[n+i]=r[i]}else e.push(r)}}var E=new class{get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}}(()=>new T,e=>e.reset());class T{set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}constructor(){this.next=this.g=this.h=null}}let S,x=!1,C=new class{add(e,t){let n=E.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}constructor(){this.h=this.g=null}},A=()=>{let e=Promise.resolve(void 0);S=()=>{e.then(D)}};function D(){let e;for(var t;e=null,C.g&&(e=C.g,C.g=C.g.next,C.g||(C.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){g.setTimeout(()=>{throw e},0)}(e)}E.j(t),E.h<100&&(E.h++,t.next=E.g,E.g=t)}x=!1}function N(){this.u=this.u,this.C=this.C}function k(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.u=!1,N.prototype.dispose=function(){this.u||(this.u=!0,this.N())},N.prototype[Symbol.dispose]=function(){this.dispose()},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},k.prototype.h=function(){this.defaultPrevented=!0};var R=function(){if(!g.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};g.addEventListener("test",e,t),g.removeEventListener("test",e,t)}catch(e){}return e}();function O(e){return/^[\s\xa0]*$/.test(e)}function M(e,t){k.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}w(M,k),M.prototype.init=function(e,t){let n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&M.Z.h.call(this)},M.prototype.h=function(){M.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var P="closure_listenable_"+(1e6*Math.random()|0),L=0;function F(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++L,this.da=this.fa=!1}function V(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function U(e){let t={};for(let n in e)t[n]=e[n];return t}let q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<q.length;t++)n=q[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function z(e){this.src=e,this.g={},this.h=0}function G(e,t){let n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=s>=0)&&Array.prototype.splice.call(i,s,1),r&&(V(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function K(e,t,n,r){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}z.prototype.add=function(e,t,n,r,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=K(e,t,r,i);return a>-1?(t=e[a],n||(t.fa=!1)):((t=new F(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var Q="closure_lm_"+(1e6*Math.random()|0),H={};function W(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");let a=m(i)?!!i.capture:!!i,o=Z(e);if(o||(e[Q]=o=new z(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return Y.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)R||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(X(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function J(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[P])G(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(X(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Z(t))?(G(n,e),0==n.h&&(n.src=null,t[Q]=null)):V(e)}}}function X(e){return e in H?H[e]:H[e]="on"+e}function Y(e,t){if(e.da)e=!0;else{t=new M(t,this);let n=e.listener,r=e.ha||e.src;e.fa&&J(e),e=n.call(r,t)}return e}function Z(e){return(e=e[Q])instanceof z?e:null}var $="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[$]||(e[$]=function(t){return e.handleEvent(t)}),e[$])}function et(){N.call(this),this.i=new z(this),this.M=this,this.G=null}function en(e,t){let n,r;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new k(t,e);else if(t instanceof k)t.target=t.target||e;else{var a=t;j(t=new k(s,e),a)}if(a=!0,i)for(r=i.length-1;r>=0;r--)a=er(n=t.g=i[r],s,!0,t)&&a;if(a=er(n=t.g=e,s,!0,t)&&a,a=er(n,s,!1,t)&&a,i)for(r=0;r<i.length;r++)a=er(n=t.g=i[r],s,!1,t)&&a}function er(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==n){let t=a.listener,n=a.ha||a.src;a.fa&&G(e.i,a),i=!1!==t.call(n,r)&&i}}return i&&!r.defaultPrevented}w(et,N),et.prototype[P]=!0,et.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=m(i)?!!i.capture:!!i,r=ee(r),t&&t[P])?(t=t.i,(a=String(n).toString())in t.g&&(r=K(n=t.g[a],r,i,s))>-1&&(V(n[r]),Array.prototype.splice.call(n,r,1),0==n.length&&(delete t.g[a],t.h--))):t&&(t=Z(t))&&(n=t.g[n.toString()],t=-1,n&&(t=K(n,r,i,s)),(r=t>-1?n[t]:null)&&J(r))}(this,e,t,n,r)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let n=e.g[t];for(let e=0;e<n.length;e++)V(n[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},et.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ei extends N{j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=y(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:g.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(g.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}}function es(e){N.call(this),this.h=e,this.g={}}w(es,N);var ea=[];function eo(e){B(e.g,function(e,t){this.g.hasOwnProperty(t)&&J(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),eo(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=g.JSON.stringify,eu=g.JSON.parse,ec=class{stringify(e){return g.JSON.stringify(e,void 0)}parse(e){return g.JSON.parse(e,void 0)}};function eh(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function eg(){k.call(this,"d")}function em(){k.call(this,"c")}w(eg,k),w(em,k);var ep={},ey=null;function ev(){return ey=ey||new et}function ew(e){k.call(this,ep.Ia,e)}function eb(e){let t=ev();en(t,new ew(t))}function eI(e,t){k.call(this,ep.STAT_EVENT,e),this.stat=t}function e_(e){let t=ev();en(t,new eI(t,e))}function eE(e,t){k.call(this,ep.Ja,e),this.size=t}function eT(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return g.setTimeout(function(){e()},t)}function eS(){this.g=!0}function ex(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var n=s[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<r.length;e++)r[e]=""}}}}return el(s)}catch(e){return t}}(e,n)+(r?" "+r:"")})}ep.Ia="serverreachability",w(ew,k),ep.STAT_EVENT="statevent",w(eI,k),ep.Ja="timingevent",w(eE,k),eS.prototype.ua=function(){this.g=!1},eS.prototype.info=function(){};var eC={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eA={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eD(){}function eN(e){return encodeURIComponent(String(e))}function ek(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eR}function eR(){this.i=null,this.g="",this.h=!1}w(eD,eh),eD.prototype.g=function(){return new XMLHttpRequest},e=new eD;var eO={},eM={};function eP(e,t,n){e.M=1,e.A=e4(e0(t)),e.u=n,e.R=!0,eL(e,null)}function eL(e,t){e.F=Date.now(),eV(e),e.B=e0(e.A);var n,r,i,s,a,o,l=e.B,u=e.S;Array.isArray(u)||(u=[String(u)]),tu(l.i,"t",u),e.C=0,l=e.j.L,e.h=new eR,e.g=tY(e.j,l?t:null,!e.u),e.P>0&&(e.O=new ei(y(e.Y,e,e.g),e.P)),t=e.V,l=e.g,u=e.ba;var c="readystatechange";Array.isArray(c)||(c&&(ea[0]=c.toString()),c=ea);for(let e=0;e<c.length;e++){let n=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(let a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=ee(r),t&&t[P]?t.K(n,r,m(i)?!!i.capture:!!i,s):W(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(let a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=ee(r),t&&t[P]?t.J(n,r,m(i)?!!i.capture:!!i,s):W(t,n,r,!1,i,s)}(l,c[e],u||t.handleEvent,!1,t.h||t);if(!n)break;t.g[n.key]=n}t=e.J?U(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),eb(),n=e.i,r=e.v,i=e.B,s=e.l,a=e.S,o=e.u,n.info(function(){if(n.g)if(o){var e="",t=o.split("&");for(let n=0;n<t.length;n++){var l=t[n].split("=");if(l.length>1){let t=l[0];l=l[1];let n=t.split("_");e=n.length>=2&&"type"==n[1]?e+(t+"=")+l+"&":e+(t+"=redacted&")}}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+r+"\n"+i+"\n"+e})}function eF(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eV(e){e.T=Date.now()+e.H,eB(e,e.H)}function eB(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eT(y(e.aa,e),t)}function eU(e){e.D&&(g.clearTimeout(e.D),e.D=null)}function eq(e){0==e.j.I||e.K||tQ(e.j,e)}function ej(e){eU(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ez(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||eW(n.h,e))){if(!e.L&&eW(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.v){if(n.g)if(n.g.F+3e3<e.F)tK(n),tP(n);else break e;tj(n),e_(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=eT(y(n.Va,n),6e3));1>=eH(n.h)&&n.ta&&(n.ta=void 0)}else tW(n,11)}else if((e.L||n.g==e)&&tK(n),!O(t))for(i=n.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=n.K))if(n.K=l,o=o[1],2==n.I)if("c"==o[0]){n.M=o[1],n.ba=o[2];let t=o[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));let i=o[4];null!=i&&(n.za=i,n.j.info("SVER="+n.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(n.O=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eJ(s,s.h),s.h=null))}if(r.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,e3(r.J,r.G,e))}}if(n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms")),(r=n).na=tX(r,r.L?r.ba:null,r.W),e.L){eX(r.h,e);var a=r.O;a&&(e.H=a),e.D&&(eU(e),eV(e)),r.g=e}else tq(r);n.i.length>0&&tF(n)}else"stop"!=o[0]&&"close"!=o[0]||tW(n,7);else 3==n.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tW(n,7):tM(n):"noop"!=o[0]&&n.l&&n.l.qa(o),n.A=0)}}eb(4)}catch(e){}}ek.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tN(e)?t.j():this.Y(e)},ek.prototype.Y=function(e){try{if(e==this.g)e:{let d=tN(this.g),f=this.g.ya(),m=this.g.ca();if(!(d<3)&&(3!=d||this.g&&(this.h.h||this.g.la()||tk(this.g)))){this.K||4!=d||7==f||(8==f||m<=0?eb(3):eb(2)),eU(this);var t=this.g.ca();this.X=t;var n=function(e){if(!eF(e))return e.g.la();let t=tk(e.g);if(""===t)return"";let n="",r=t.length,i=4==tN(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return ej(e),eq(e),"";e.h.i=new g.TextDecoder}for(let s=0;s<r;s++)e.h.h=!0,n+=e.h.i.decode(t[s],{stream:!(i&&s==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,r=this.i,i=this.v,s=this.B,a=this.l,o=this.S,r.info(function(){return"XMLHTTP RESP ("+a+") [ attempt "+o+"]: "+i+"\n"+s+"\n"+d+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var r,i,s,a,o,l,u=this.g;if((l=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O(l)){var c=l;break t}}c=null}if(e=c)ex(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ez(this,e);else{this.o=!1,this.m=3,e_(12),ej(this),eq(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;)if((t=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?eM:isNaN(n=Number(t.substring(n,r)))?eO:(r+=1)+n>t.length?eM:(t=t.slice(r,r+n),e.C=r+n,t)}(this,n))==eM){4==d&&(this.m=4,e_(14),e=!1),ex(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eO){this.m=4,e_(15),ex(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}else ex(this.i,this.l,t,null),ez(this,t);if(eF(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=n.length||this.h.h||(this.m=1,e_(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.aa&&!h.P&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),tz(h),h.P=!0,e_(11))}}else ex(this.i,this.l,n,"[Invalid Chunked Response]"),ej(this),eq(this)}else ex(this.i,this.l,n,null),ez(this,n);4==d&&ej(this),this.o&&!this.K&&(4==d?tQ(this.j,this):(this.o=!1,eV(this)))}else(function(e){let t={};e=(e.g&&tN(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(O(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,e_(12)):(this.m=0,e_(13)),ej(this),eq(this)}}}catch(e){}finally{}},ek.prototype.cancel=function(){this.K=!0,ej(this)},ek.prototype.aa=function(){var e,t;this.D=null;let n=Date.now();n-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(eb(),e_(17)),ej(this),this.m=2,eq(this)):eB(this,this.T-n)};var eG=class{constructor(e,t){this.g=e,this.map=t}};function eK(e){this.l=e||10,e=g.PerformanceNavigationTiming?(e=g.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(g.chrome&&g.chrome.loadTimes&&g.chrome.loadTimes()&&g.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eQ(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eH(e){return e.h?1:e.g?e.g.size:0}function eW(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eJ(e,t){e.g?e.g.add(t):e.h=t}function eX(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eY(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.G);return t}return I(e.i)}eK.prototype.cancel=function(){if(this.i=eY(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eZ=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e$(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof e$?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e6(this,tc(e.i)),this.m=e.m):e&&(t=String(e).match(eZ))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e5(t[2]||""),this.g=e5(t[3]||"",!0),e2(this,t[4]),this.h=e5(t[5]||"",!0),e6(this,t[6]||"",!0),this.m=e5(t[7]||"")):(this.l=!1,this.i=new ti(null,this.l))}function e0(e){return new e$(e)}function e1(e,t,n){e.j=n?e5(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e6(e,t,n){var r,i;t instanceof ti?(e.i=t,r=e.i,(i=e.l)&&!r.j&&(ts(r),r.i=null,r.g.forEach(function(e,t){let n=t.toLowerCase();t!=n&&(ta(this,t),tu(this,n,e))},r)),r.j=i):(n||(t=e8(t,tn)),e.i=new ti(t,e.l))}function e3(e,t,n){e.i.set(t,n)}function e4(e){return e3(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e5(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e$.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e9,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e9,!0),"@"),e.push(eN(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(e8(n,"/"==n.charAt(0)?tt:te,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",e8(n,tr)),e.join("")},e$.prototype.resolve=function(e){let t=e0(this),n=!!e.j;n?e1(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)e2(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var i=t.h.lastIndexOf("/");-1!=i&&(r=t.h.slice(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let n=i[t++];"."==n?r&&t==i.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==i.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=i}return n?t.h=r:n=""!==e.i.toString(),n?e6(t,tc(e.i)):n=!!e.m,n&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tn=/[#\?@]/g,tr=/#/g;function ti(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){let r=e[n].indexOf("="),i,s=null;r>=0?(i=e[n].substring(0,r),s=e[n].substring(r+1)):i=e[n],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function ta(e,t){ts(e),t=th(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function to(e,t){return ts(e),t=th(e,t),e.g.has(t)}function tl(e,t){ts(e);let n=[];if("string"==typeof t)to(e,t)&&(n=n.concat(e.g.get(th(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function tu(e,t,n){ta(e,t),n.length>0&&(e.i=null,e.g.set(th(e,t),I(n)),e.h+=n.length)}function tc(e){let t=new ti;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function th(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tf(){this.g=new ec}function tg(e){this.i=e.Sb||null,this.h=e.ab||!1}function ty(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tv(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function tw(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tb(e)}function tb(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tI(e){let t="";return B(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function t_(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tI(n),"string"==typeof e?null!=n&&eN(n):e3(e,t,n))}function tE(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ti.prototype).add=function(e,t){ts(this),this.i=null,e=th(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,to(this,e=th(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];let i=eN(n);n=tl(this,n);for(let t=0;t<n.length;t++){let r=i;""!==n[t]&&(r+="="+eN(n[t])),e.push(r)}}return this.i=e.join("&")},w(tg,eh),tg.prototype.g=function(){return new ty(this.i,this.h)},w(ty,et),(t=ty.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tb(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||g).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,tw(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tb(this)),this.g&&(this.readyState=3,tb(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==g.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tv(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tw(this):tb(this),3==this.readyState&&tv(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,tw(this))},t.Na=function(e){this.g&&(this.response=e,tw(this))},t.ga=function(){this.g&&tw(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(ty.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),w(tE,et);var tT=/^https?$/i,tS=["POST","PUT"];function tx(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tC(e),tD(e)}function tC(e){e.A||(e.A=!0,en(e,"complete"),en(e,"error"))}function tA(e){if(e.h&&void 0!==s){if(e.v&&4==tN(e))setTimeout(e.Ca.bind(e),0);else if(en(e,"readystatechange"),4==tN(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){let t=String(e.D).match(eZ)[1]||null;!t&&g.self&&g.self.location&&(t=g.self.location.protocol.slice(0,-1)),n=!tT.test(t?t.toLowerCase():"")}t=n}if(t)en(e,"complete"),en(e,"success");else{e.o=6;try{var i=tN(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tC(e)}}finally{tD(e)}}}}function tD(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let n=e.g;e.g=null,t||en(e,"ready");try{n.onreadystatechange=null}catch(e){}}}function tN(e){return e.g?e.g.readyState:0}function tk(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tR(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tO(e){this.za=0,this.i=[],this.j=new eS,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tR("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tR("baseRetryDelayMs",5e3,e),this.Za=tR("retryDelaySeedMs",1e4,e),this.Ta=tR("forwardChannelMaxRetries",2,e),this.va=tR("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eK(e&&e.concurrentRequestLimit),this.Ba=new tf,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tM(e){if(tL(e),3==e.I){var t=e.V++,n=e0(e.J);if(e3(n,"SID",e.M),e3(n,"RID",t),e3(n,"TYPE","terminate"),tB(e,n),(t=new ek(e,e.j,t)).M=2,t.A=e4(e0(n)),n=!1,g.navigator&&g.navigator.sendBeacon)try{n=g.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&g.Image&&((new Image).src=t.A,n=!0),n||(t.g=tY(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eV(t)}tJ(e)}function tP(e){e.g&&(tz(e),e.g.cancel(),e.g=null)}function tL(e){tP(e),e.v&&(g.clearTimeout(e.v),e.v=null),tK(e),e.h.cancel(),e.m&&("number"==typeof e.m&&g.clearTimeout(e.m),e.m=null)}function tF(e){if(!eQ(e.h)&&!e.m){e.m=!0;var t=e.Ea;S||A(),x||(S(),x=!0),C.add(t,e),e.D=0}}function tV(e,t){var n;n=t?t.l:e.V++;let r=e0(e.J);e3(r,"SID",e.M),e3(r,"RID",n),e3(r,"AID",e.K),tB(e,r),e.u&&e.o&&t_(r,e.u,e.o),n=new ek(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tU(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eJ(e.h,n),eP(n,r,t)}function tB(e,t){e.H&&B(e.H,function(e,n){e3(t,n,e)}),e.l&&B({},function(e,n){e3(t,n,e)})}function tU(e,t,n){n=Math.min(e.i.length,n);let r=e.l?y(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?n>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let l=0;l<n;l++){var s=i[l].g;let n=i[l].map;if((s-=t)<0)t=Math.max(0,i[l].g-100),o=!1;else try{s="req"+s+"_";try{var a=n instanceof Map?n:Object.entries(n);for(let[t,n]of a){let r=n;m(n)&&(r=el(n)),e.push(s+t+"="+encodeURIComponent(r))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){r&&r(n)}}if(o){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,n),a}function tq(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;S||A(),x||(S(),x=!0),C.add(t,e),e.A=0}}function tj(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eT(y(e.Da,e),tH(e,e.A)),e.A++,!0)}function tz(e){null!=e.B&&(g.clearTimeout(e.B),e.B=null)}function tG(e){e.g=new ek(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e3(t,"RID","rpc"),e3(t,"SID",e.M),e3(t,"AID",e.K),e3(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e3(t,"TO",e.ia),e3(t,"TYPE","xmlhttp"),tB(e,t),e.u&&e.o&&t_(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=e4(e0(t)),n.u=null,n.R=!0,eL(n,e)}function tK(e){null!=e.C&&(g.clearTimeout(e.C),e.C=null)}function tQ(e,t){var n,r=null;if(e.g==t){tK(e),tz(e),e.g=null;var i=2}else{if(!eW(e.h,t))return;r=t.G,eX(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){r=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;en(i=ev(),new eE(i,r)),tF(e)}else tq(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(n=t,!(eH(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=n.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eT(y(e.Ea,e,n),tH(e,e.D)),e.D++,!0)))||2==i&&tj(e)))switch(r&&r.length>0&&((t=e.h).i=t.i.concat(r)),s){case 1:tW(e,5);break;case 4:tW(e,10);break;case 3:tW(e,6);break;default:tW(e,2)}}}function tH(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function tW(e,t){if(e.j.info("Error code "+t),2==t){var n=y(e.bb,e),r=e.Ua;let t=!r;r=new e$(r||"//www.google.com/images/cleardot.gif"),g.location&&"http"==g.location.protocol||e1(r,"https"),e4(r),t?function(e,t){let n=new eS;if(g.Image){let r=new Image;r.onload=v(td,n,"TestLoadImage: loaded",!0,t,r),r.onerror=v(td,n,"TestLoadImage: error",!1,t,r),r.onabort=v(td,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=v(td,n,"TestLoadImage: timeout",!1,t,r),g.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){let n=new eS,r=new AbortController,i=setTimeout(()=>{r.abort(),td(n,"TestPingServer: timeout",!1,t)},1e4);fetch(e,{signal:r.signal}).then(e=>{clearTimeout(i),e.ok?td(n,"TestPingServer: ok",!0,t):td(n,"TestPingServer: server error",!1,t)}).catch(()=>{clearTimeout(i),td(n,"TestPingServer: error",!1,t)})}(r.toString(),n)}else e_(2);e.I=0,e.l&&e.l.pa(t),tJ(e),tL(e)}function tJ(e){if(e.I=0,e.ja=[],e.l){let t=eY(e.h);(0!=t.length||0!=e.i.length)&&(_(e.ja,t),_(e.ja,e.i),e.h.i.length=0,I(e.i),e.i.length=0),e.l.oa()}}function tX(e,t,n){var r=n instanceof e$?e0(n):new e$(n);if(""!=r.g)t&&(r.g=t+"."+r.g),e2(r,r.u);else{var i=g.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new e$(null);r&&e1(e,r),t&&(e.g=t),i&&e2(e,i),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&e3(r,n,t),e3(r,"VER",e.ka),tB(e,r),r}function tY(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tE(e.Aa&&!e.ma?new tg({ab:n}):e.ma)).Fa(e.L),t}function tZ(){}function t$(){}function t0(e,t){et.call(this),this.g=new tO(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!O(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!O(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t6(this)}function t1(e){eg.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t2(){em.call(this),this.status=1}function t6(e){this.g=e}(t=tE.prototype).Fa=function(e){this.H=e},t.ea=function(t,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);n=n?n.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=b(y(this.Ca,this));try{this.B=!0,this.g.open(n,String(t),!0),this.B=!1}catch(e){tx(this,e);return}if(t=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,a]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=g.FormData&&t instanceof g.FormData,!(Array.prototype.indexOf.call(tS,n,void 0)>=0)||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(e,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tx(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,en(this,"complete"),en(this,"abort"),tD(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tD(this,!0)),tE.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tA(this):this.Xa())},t.Xa=function(){tA(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tN(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eu(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tO.prototype).ka=8,t.I=1,t.connect=function(e,t,n,r){e_(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=tX(this,null,this.W),tF(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new ek(this,this.j,e),s=this.o;if(this.U&&(s?j(s=U(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tU(this,i,t),e3(n=e0(this.J),"RID",e),e3(n,"CVER",22),this.G&&e3(n,"X-HTTP-Session-Id",this.G),tB(this,n),s&&(this.R?t="headers="+eN(tI(s))+"&"+t:this.u&&t_(n,this.u,s)),eJ(this.h,i),this.Ra&&e3(n,"TYPE","init"),this.S?(e3(n,"$req",t),e3(n,"SID","null"),i.U=!0,eP(i,n,null)):eP(i,n,t),this.I=2}}else 3==this.I&&(e?tV(this,e):0==this.i.length||eQ(this.h)||tV(this))},t.Da=function(){if(this.v=null,tG(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eT(y(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,e_(10),tP(this),tG(this))},t.Va=function(){null!=this.C&&(this.C=null,tP(this),tj(this),e_(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),e_(2)):(this.j.info("Failed to ping google.com"),e_(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tZ.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},t$.prototype.g=function(e,t){return new t0(e,t)},w(t0,et),t0.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},t0.prototype.close=function(){tM(this.g)},t0.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=el(e),e=n);t.i.push(new eG(t.Ya++,e)),3==t.I&&tF(t)},t0.prototype.N=function(){this.g.l=null,delete this.j,tM(this.g),delete this.g,t0.Z.N.call(this)},w(t1,eg),w(t2,em),w(t6,tZ),t6.prototype.ra=function(){en(this.g,"a")},t6.prototype.qa=function(e){en(this.g,new t1(e))},t6.prototype.pa=function(e){en(this.g,new t2)},t6.prototype.oa=function(){en(this.g,"b")},t$.prototype.createWebChannel=t$.prototype.g,t0.prototype.send=t0.prototype.o,t0.prototype.open=t0.prototype.m,t0.prototype.close=t0.prototype.close,f=tp.createWebChannelTransport=function(){return new t$},d=tp.getStatEventTarget=function(){return ev()},h=tp.Event=ep,c=tp.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eC.NO_ERROR=0,eC.TIMEOUT=8,eC.HTTP_ERROR=6,u=tp.ErrorCode=eC,eA.COMPLETE="complete",l=tp.EventType=eA,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,o=tp.WebChannel=ed,tp.FetchXmlHttpFactory=tg,tE.prototype.listenOnce=tE.prototype.K,tE.prototype.getLastError=tE.prototype.Ha,tE.prototype.getLastErrorCode=tE.prototype.ya,tE.prototype.getStatus=tE.prototype.ca,tE.prototype.getResponseJson=tE.prototype.La,tE.prototype.getResponseText=tE.prototype.la,tE.prototype.send=tE.prototype.ea,tE.prototype.setWithCredentials=tE.prototype.Fa,a=tp.XhrIo=tE}).apply(void 0!==tm?tm:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let ty="@firebase/firestore",tv="4.9.2";class tw{isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}constructor(e){this.uid=e}}tw.UNAUTHENTICATED=new tw(null),tw.GOOGLE_CREDENTIALS=new tw("google-credentials-uid"),tw.FIRST_PARTY=new tw("first-party-uid"),tw.MOCK_USER=new tw("mock-user");let tb="12.3.0",tI=new eI("@firebase/firestore");function t_(){return tI.logLevel}function tE(e){tI.setLogLevel(e)}function tT(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(tI.logLevel<=r.DEBUG){let t=n.map(tC);tI.debug("Firestore (".concat(tb,"): ").concat(e),...t)}}function tS(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(tI.logLevel<=r.ERROR){let t=n.map(tC);tI.error("Firestore (".concat(tb,"): ").concat(e),...t)}}function tx(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(tI.logLevel<=r.WARN){let t=n.map(tC);tI.warn("Firestore (".concat(tb,"): ").concat(e),...t)}}function tC(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function tA(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,tD(e,r,n)}function tD(e,t,n){let r="FIRESTORE (".concat(tb,") INTERNAL ASSERTION FAILED: ").concat(t," (ID: ").concat(e.toString(16),")");if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw tS(r),Error(r)}function tN(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||tD(t,i,r)}function tk(e,t){e||tA(57014,t)}let tR={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class tO extends ${constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class tM{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class tP{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class tL{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tw.UNAUTHENTICATED))}shutdown(){}}class tF{getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}constructor(e){this.token=e,this.changeListener=null}}class tV{start(e,t){tN(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new tM;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new tM,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{tT("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(tT("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new tM)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(tT("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(tN("string"==typeof t.accessToken,31837,{l:t}),new tP(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return tN(null===e||"string"==typeof e,2055,{h:e}),new tw(e)}constructor(e){this.t=e,this.currentUser=tw.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}}class tB{R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=tw.FIRST_PARTY,this.A=new Map}}class tU{getToken(){return Promise.resolve(new tB(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(tw.FIRST_PARTY))}shutdown(){}invalidateToken(){}constructor(e,t,n){this.P=e,this.T=t,this.I=n}}class tq{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class tj{start(e,t){tN(void 0===this.o,3512);let n=e=>{null!=e.error&&tT("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));let n=e.token!==this.m;return this.m=e.token,tT("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{tT("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):tT("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new tq(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(tN("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new tq(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,eZ(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}}class tz{getToken(){return Promise.resolve(new tq(""))}invalidateToken(){}start(e,t){}shutdown(){}}class tG{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function tK(e,t){return e<t?-1:+(e>t)}function tQ(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.charAt(r),i=t.charAt(r);if(n!==i)return tH(n)===tH(i)?tK(n,i):tH(n)?1:-1}return tK(e.length,t.length)}function tH(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function tW(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}let tJ="__name__";class tX{get length(){return this.len}isEqual(e){return 0===tX.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof tX?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=tX.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return tK(e.length,t.length)}static compareSegments(e,t){let n=tX.isNumericId(e),r=tX.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?tX.extractNumericId(e).compare(tX.extractNumericId(t)):tQ(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return i.fromString(e.substring(4,e.length-2))}constructor(e,t,n){void 0===t?t=0:t>e.length&&tA(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&tA(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}}class tY extends tX{construct(e,t,n){return new tY(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[];for(let e of t){if(e.indexOf("//")>=0)throw new tO(tR.INVALID_ARGUMENT,"Invalid segment (".concat(e,"). Paths must not contain // in them."));r.push(...e.split("/").filter(e=>e.length>0))}return new tY(r)}static emptyPath(){return new tY([])}}let tZ=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class t$ extends tX{construct(e,t,n){return new t$(e,t,n)}static isValidIdentifier(e){return tZ.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t$.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===tJ}static keyField(){return new t$([tJ])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new tO(tR.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new tO(tR.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new tO(tR.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new tO(tR.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new t$(t)}static emptyPath(){return new t$([])}}class t0{static fromPath(e){return new t0(tY.fromString(e))}static fromName(e){return new t0(tY.fromString(e).popFirst(5))}static empty(){return new t0(tY.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===tY.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return tY.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new t0(new tY(e.slice()))}constructor(e){this.path=e}}function t1(e,t,n){if(!n)throw new tO(tR.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function t2(e,t,n,r){if(!0===t&&!0===r)throw new tO(tR.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function t6(e){if(!t0.isDocumentKey(e))throw new tO(tR.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function t3(e){if(t0.isDocumentKey(e))throw new tO(tR.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function t4(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function t5(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?"a custom ".concat(n," object"):"an object"}}return"function"==typeof e?"a function":tA(12329,{type:typeof e})}function t8(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new tO(tR.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=t5(e);throw new tO(tR.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}function t7(e,t){if(t<=0)throw new tO(tR.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}function t9(e,t){let n={typeString:e};return t&&(n.value=t),n}function ne(e,t){let n;if(!t4(e))throw new tO(tR.INVALID_ARGUMENT,"JSON must be an object");for(let r in t)if(t[r]){let i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n="JSON missing required field: '".concat(r,"'");break}let a=e[r];if(i&&typeof a!==i){n="JSON field '".concat(r,"' must be a ").concat(i,".");break}if(void 0!==s&&a!==s.value){n="Expected '".concat(r,"' field to equal '").concat(s.value,"'");break}}if(n)throw new tO(tR.INVALID_ARGUMENT,n);return!0}class nt{static now(){return nt.fromMillis(Date.now())}static fromDate(e){return nt.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new nt(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?tK(this.nanoseconds,e.nanoseconds):tK(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:nt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ne(e,nt._jsonSchema))return new nt(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new tO(tR.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new tO(tR.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}}nt._jsonSchemaVersion="firestore/timestamp/1.0",nt._jsonSchema={type:t9("string",nt._jsonSchemaVersion),seconds:t9("number"),nanoseconds:t9("number")};class nn{static fromTimestamp(e){return new nn(e)}static min(){return new nn(new nt(0,0))}static max(){return new nn(new nt(0x3afff4417f,0x3b9ac9ff))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}constructor(e){this.timestamp=e}}class nr{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function ni(e){return e.fields.find(e=>2===e.kind)}function ns(e){return e.fields.filter(e=>2!==e.kind)}function na(e,t){let n=tK(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=function(e,t){let n=t$.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:tK(e.kind,t.kind)}(e.fields[r],t.fields[r])))return n;return tK(e.fields.length,t.fields.length)}nr.UNKNOWN_ID=-1;class no{constructor(e,t){this.fieldPath=e,this.kind=t}}class nl{static empty(){return new nl(0,nh.min())}constructor(e,t){this.sequenceNumber=e,this.offset=t}}function nu(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new nh(nn.fromTimestamp(1e9===r?new nt(n+1,0):new nt(n,r)),t0.empty(),t)}function nc(e){return new nh(e.readTime,e.key,-1)}class nh{static min(){return new nh(nn.min(),t0.empty(),-1)}static max(){return new nh(nn.max(),t0.empty(),-1)}constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}}function nd(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=t0.comparator(e.documentKey,t.documentKey))?n:tK(e.largestBatchId,t.largestBatchId)}let nf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ng{addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}constructor(){this.onCommittedListeners=[]}}async function nm(e){if(e.code!==tR.FAILED_PRECONDITION||e.message!==nf)throw e;tT("LocalStore","Unexpectedly lost primary lease")}class np{catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&tA(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new np((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof np?t:np.resolve(t)}catch(e){return np.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):np.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):np.reject(t)}static resolve(e){return new np((t,n)=>{t(e)})}static reject(e){return new np((t,n)=>{n(e)})}static waitFor(e){return new np((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=np.resolve(!1);for(let n of e)t=t.next(e=>e?np.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new np((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new np((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}}let ny="SimpleDb";class nv{static open(e,t,n,r){try{return new nv(t,e.transaction(r,n))}catch(e){throw new n_(t,e)}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(tT(ny,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new nT(this.transaction.objectStore(e))}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new tM,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new n_(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let n=nC(t.target.error);this.S.reject(new n_(e,n))}}}class nw{static delete(e){return tT(ny,"Removing database:",e),nS(C().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Y())return!1;if(nw.F())return!0;let e=U(),t=nw.M(e),n=nb(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static F(){var e;return void 0!==v.default&&"YES"===(null==(e=v.default.__PRIVATE_env)?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}async L(e){return this.db||(tT(ny,"Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new n_(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new tO(tR.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new tO(tR.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new n_(e,r))},r.onupgradeneeded=e=>{tT(ny,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,r.transaction,e.oldVersion,this.version).next(()=>{tT(ny,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=e=>this.q(e)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=nv.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),np.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(tT(ny,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,12.2===nw.M(U())&&tS("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}}function nb(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class nI{get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return nS(this.U.delete())}constructor(e){this.U=e,this.K=!1,this.W=null}}class n_ extends tO{constructor(e,t){super(tR.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(t)),this.name="IndexedDbTransactionError"}}function nE(e){return"IndexedDbTransactionError"===e.name}class nT{put(e,t){let n;return void 0!==t?(tT(ny,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(tT(ny,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),nS(n)}add(e){return tT(ny,"ADD",this.store.name,e,e),nS(this.store.add(e))}get(e){return nS(this.store.get(e)).next(t=>(void 0===t&&(t=null),tT(ny,"GET",this.store.name,e,t),t))}delete(e){return tT(ny,"DELETE",this.store.name,e),nS(this.store.delete(e))}count(){return tT(ny,"COUNT",this.store.name),nS(this.store.count())}J(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new np((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.H(e,(e,n)=>{t.push(n)}).next(()=>t)}}Y(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new np((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}Z(e,t){tT(ny,"DELETE ALL",this.store.name);let n=this.options(e,t);n.X=!1;let r=this.cursor(n);return this.H(r,(e,t,n)=>n.delete())}ee(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.H(r,t)}te(e){let t=this.cursor({});return new np((n,r)=>{t.onerror=e=>{r(nC(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}H(e,t){let n=[];return new np((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new nI(i),a=t(i.primaryKey,i.value,s);if(a instanceof np){let e=a.catch(e=>(s.done(),np.reject(e)));n.push(e)}s.isDone?r():null===s.G?i.continue():i.continue(s.G)}}).next(()=>np.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}constructor(e){this.store=e}}function nS(e){return new np((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(nC(e.target.error))}})}let nx=!1;function nC(e){let t=nw.M(U());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new tO("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(t,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return nx||(nx=!0,setTimeout(()=>{throw e},0)),e}}return e}let nA="IndexBackfiller";class nD{start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){tT(nA,"Scheduled in ".concat(e,"ms")),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();tT(nA,"Documents written: ".concat(e))}catch(e){nE(e)?tT(nA,"Ignoring IndexedDB error during index backfill: ",e):await nm(e)}await this.re(6e4)})}constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}}class nN{async ie(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let n=new Set,r=t,i=!0;return np.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return tT(nA,"Processing collection: ".concat(t)),this.oe(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(r,n)).next(n=>(tT(nA,"Updating offset: ".concat(n)),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}_e(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=nc(t);nd(r,n)>0&&(n=r)}),new nh(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}constructor(e,t){this.localStore=e,this.persistence=t}}class nk{ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}}function nR(e){return null==e}function nO(e){return 0===e&&1/e==-1/0}function nM(e){return"number"==typeof e&&Number.isInteger(e)&&!nO(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function nP(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}nk.ce=-1;function nL(e){let t=e.length;if(tN(t>=2,64408,{path:e}),2===t)return tN("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),tY.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&tA(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:tA(61167,{path:e})}s=t+2}return new tY(r)}let nF="remoteDocuments",nV="owner",nB="owner",nU="mutationQueues",nq="mutations",nj="batchId",nz="userMutationsIndex",nG=["userId","batchId"],nK={},nQ="documentMutations",nH="remoteDocumentsV14",nW=["prefixPath","collectionGroup","readTime","documentId"],nJ="documentKeyIndex",nX=["prefixPath","collectionGroup","documentId"],nY="collectionGroupIndex",nZ=["collectionGroup","readTime","prefixPath","documentId"],n$="remoteDocumentGlobal",n0="remoteDocumentGlobalKey",n1="targets",n2="queryTargetsIndex",n6=["canonicalId","targetId"],n3="targetDocuments",n4=["targetId","path"],n5="documentTargetsIndex",n8=["path","targetId"],n7="targetGlobalKey",n9="targetGlobal",re="collectionParents",rt=["collectionId","parent"],rn="clientMetadata",rr="bundles",ri="namedQueries",rs="indexConfiguration",ra="collectionGroupIndex",ro="indexState",rl=["indexId","uid"],ru="sequenceNumberIndex",rc=["uid","sequenceNumber"],rh="indexEntries",rd=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],rf="documentKeyIndex",rg=["indexId","uid","orderedDocumentKey"],rm="documentOverlays",rp=["userId","collectionPath","documentId"],ry="collectionPathOverlayIndex",rv=["userId","collectionPath","largestBatchId"],rw="collectionGroupOverlayIndex",rb=["userId","collectionGroup","largestBatchId"],rI="globals",r_=[nU,nq,nQ,nF,n1,nV,n9,n3,rn,n$,re,rr,ri],rE=[...r_,rm],rT=[nU,nq,nQ,nH,n1,nV,n9,n3,rn,n$,re,rr,ri,rm],rS=[...rT,rs,ro,rh],rx=[...rS,rI];class rC extends ng{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function rA(e,t){return nw.O(e.le,t)}function rD(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function rN(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function rk(e,t){let n=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}function rR(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class rO{insert(e,t){return new rO(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,rP.BLACK,null,null))}remove(e){return new rO(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rP.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push("".concat(t,":").concat(n)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new rM(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new rM(this.root,e,this.comparator,!1)}getReverseIterator(){return new rM(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new rM(this.root,e,this.comparator,!0)}constructor(e,t){this.comparator=e,this.root=t||rP.EMPTY}}class rM{getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}}class rP{copy(e,t,n,r,i){return new rP(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return rP.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return rP.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,rP.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,rP.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw tA(43730,{key:this.key,value:this.value});if(this.right.isRed())throw tA(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw tA(27949);return e+ +!this.isRed()}constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:rP.RED,this.left=null!=r?r:rP.EMPTY,this.right=null!=i?i:rP.EMPTY,this.size=this.left.size+1+this.right.size}}rP.EMPTY=null,rP.RED=!0,rP.BLACK=!1,rP.EMPTY=new class{get key(){throw tA(57766)}get value(){throw tA(16141)}get color(){throw tA(16727)}get left(){throw tA(29726)}get right(){throw tA(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new rP(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}constructor(){this.size=0}};class rL{has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new rF(this.data.getIterator())}getIteratorFrom(e){return new rF(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof rL)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new rL(this.comparator);return t.data=e,t}constructor(e){this.comparator=e,this.data=new rO(this.comparator)}}class rF{getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}constructor(e){this.iter=e}}function rV(e){return e.hasNext()?e.getNext():void 0}class rB{static empty(){return new rB([])}unionWith(e){let t=new rL(t$.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new rB(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return tW(this.fields,e.fields,(e,t)=>e.isEqual(t))}constructor(e){this.fields=e,e.sort(t$.comparator)}}class rU extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function rq(){return"undefined"!=typeof atob}class rj{static fromBase64String(e){return new rj(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new rU("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new rj(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return tK(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}constructor(e){this.binaryString=e}}rj.EMPTY_BYTE_STRING=new rj("");let rz=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function rG(e){if(tN(!!e,39018),"string"==typeof e){let t=0,n=rz.exec(e);if(tN(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:rK(e.seconds),nanos:rK(e.nanos)}}function rK(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function rQ(e){return"string"==typeof e?rj.fromBase64String(e):rj.fromUint8Array(e)}let rH="server_timestamp",rW="__type__",rJ="__previous_value__",rX="__local_write_time__";function rY(e){var t,n;return(null==(t=((null==e||null==(n=e.mapValue)?void 0:n.fields)||{})[rW])?void 0:t.stringValue)===rH}function rZ(e){let t=e.mapValue.fields[rJ];return rY(t)?rZ(t):t}function r$(e){let t=rG(e.mapValue.fields[rX].timestampValue);return new nt(t.seconds,t.nanos)}class r0{constructor(e,t,n,r,i,s,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u}}let r1="(default)";class r2{static empty(){return new r2("","")}get isDefaultDatabase(){return this.database===r1}isEqual(e){return e instanceof r2&&e.projectId===this.projectId&&e.database===this.database}constructor(e,t){this.projectId=e,this.database=t||r1}}let r6="__type__",r3="__max__",r4={mapValue:{fields:{__type__:{stringValue:r3}}}},r5="__vector__",r8="value",r7={nullValue:"NULL_VALUE"};function r9(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?rY(e)?4:ip(e)?0x1fffffffffffff:ig(e)?10:11:tA(28295,{value:e})}function ie(e,t){if(e===t)return!0;let n=r9(e);if(n!==r9(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return r$(e).isEqual(r$(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=rG(e.timestampValue),i=rG(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return rQ(e.bytesValue).isEqual(rQ(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return rK(e.geoPointValue.latitude)===rK(t.geoPointValue.latitude)&&rK(e.geoPointValue.longitude)===rK(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return rK(e.integerValue)===rK(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=rK(e.doubleValue),r=rK(t.doubleValue);return n===r?nO(n)===nO(r):isNaN(n)&&isNaN(r)}return!1;case 9:return tW(e.arrayValue.values||[],t.arrayValue.values||[],ie);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(rD(s)!==rD(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!ie(s[e],a[e])))return!1;return!0;default:return tA(52216,{left:e})}}function it(e,t){return void 0!==(e.values||[]).find(e=>ie(e,t))}function ir(e,t){if(e===t)return 0;let n=r9(e),r=r9(t);if(n!==r)return tK(n,r);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return tK(e.booleanValue,t.booleanValue);case 2:let i=rK(e.integerValue||e.doubleValue),s=rK(t.integerValue||t.doubleValue);return i<s?-1:i>s?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return ii(e.timestampValue,t.timestampValue);case 4:return ii(r$(e),r$(t));case 5:return tQ(e.stringValue,t.stringValue);case 6:return function(e,t){let n=rQ(e),r=rQ(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=tK(n[e],r[e]);if(0!==t)return t}return tK(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=tK(rK(e.latitude),rK(t.latitude));return 0!==n?n:tK(rK(e.longitude),rK(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return is(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;let a=e.fields||{},o=t.fields||{},l=null==(n=a[r8])?void 0:n.arrayValue,u=null==(r=o[r8])?void 0:r.arrayValue,c=tK((null==l||null==(i=l.values)?void 0:i.length)||0,(null==u||null==(s=u.values)?void 0:s.length)||0);return 0!==c?c:is(l,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===r4.mapValue&&t===r4.mapValue)return 0;if(e===r4.mapValue)return 1;if(t===r4.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=tQ(r[e],s[e]);if(0!==t)return t;let a=ir(n[r[e]],i[s[e]]);if(0!==a)return a}return tK(r.length,s.length)}(e.mapValue,t.mapValue);default:throw tA(23264,{he:n})}}function ii(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return tK(e,t);let n=rG(e),r=rG(t),i=tK(n.seconds,r.seconds);return 0!==i?i:tK(n.nanos,r.nanos)}function is(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=ir(n[e],r[e]);if(t)return t}return tK(n.length,r.length)}function ia(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=rG(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?rQ(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,t0.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,"geo(".concat(n.latitude,",").concat(n.longitude,")")):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=ia(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+="".concat(i,":").concat(ia(e.fields[i]));return n+"}"}(e.mapValue):tA(61005,{value:e})}function io(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function il(e){return!!e&&"integerValue"in e}function iu(e){return!!e&&"arrayValue"in e}function ic(e){return!!e&&"nullValue"in e}function ih(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function id(e){return!!e&&"mapValue"in e}function ig(e){var t,n;return(null==(t=((null==e||null==(n=e.mapValue)?void 0:n.fields)||{})[r6])?void 0:t.stringValue)===r5}function im(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return rN(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=im(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=im(e.arrayValue.values[n]);return t}return{...e}}function ip(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===r3}let iy={mapValue:{fields:{[r6]:{stringValue:r5},[r8]:{arrayValue:{}}}}};function iv(e,t){let n=ir(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function iw(e,t){let n=ir(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class ib{static empty(){return new ib({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!id(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=im(t)}setAll(e){let t=t$.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=im(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());id(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ie(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];id(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(rN(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new ib(im(this.value))}constructor(e){this.value=e}}class iI{static newInvalidDocument(e){return new iI(e,0,nn.min(),nn.min(),nn.min(),ib.empty(),0)}static newFoundDocument(e,t,n,r){return new iI(e,1,t,nn.min(),n,r,0)}static newNoDocument(e,t){return new iI(e,2,t,nn.min(),nn.min(),ib.empty(),0)}static newUnknownDocument(e,t){return new iI(e,3,t,nn.min(),nn.min(),ib.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(nn.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ib.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ib.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=nn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof iI&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new iI(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}}class i_{constructor(e,t){this.position=e,this.inclusive=t}}function iE(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?t0.comparator(t0.fromName(a.referenceValue),n.key):ir(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function iT(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ie(e.position[n],t.position[n]))return!1;return!0}class iS{constructor(e,t="asc"){this.field=e,this.dir=t}}class ix{}class iC extends ix{static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new iM(e,t,n):"array-contains"===t?new iV(e,n):"in"===t?new iB(e,n):"not-in"===t?new iU(e,n):"array-contains-any"===t?new iq(e,n):new iC(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new iP(e,n):new iL(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(ir(t,this.value)):null!==t&&r9(this.value)===r9(t)&&this.matchesComparison(ir(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return tA(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}}class iA extends ix{static create(e,t){return new iA(e,t)}matches(e){return iD(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}}function iD(e){return"and"===e.op}function iN(e){return"or"===e.op}function ik(e){return iR(e)&&iD(e)}function iR(e){for(let t of e.filters)if(t instanceof iA)return!1;return!0}function iO(e,t){let n=e.filters.concat(t);return iA.create(n,e.op)}class iM extends iC{matches(e){let t=t0.comparator(e.key,this.key);return this.matchesComparison(t)}constructor(e,t,n){super(e,t,n),this.key=t0.fromName(n.referenceValue)}}class iP extends iC{matches(e){return this.keys.some(t=>t.isEqual(e.key))}constructor(e,t){super(e,"in",t),this.keys=iF("in",t)}}class iL extends iC{matches(e){return!this.keys.some(t=>t.isEqual(e.key))}constructor(e,t){super(e,"not-in",t),this.keys=iF("not-in",t)}}function iF(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>t0.fromName(e.referenceValue))}class iV extends iC{matches(e){let t=e.data.field(this.field);return iu(t)&&it(t.arrayValue,this.value)}constructor(e,t){super(e,"array-contains",t)}}class iB extends iC{matches(e){let t=e.data.field(this.field);return null!==t&&it(this.value.arrayValue,t)}constructor(e,t){super(e,"in",t)}}class iU extends iC{matches(e){if(it(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!it(this.value.arrayValue,t)}constructor(e,t){super(e,"not-in",t)}}class iq extends iC{matches(e){let t=e.data.field(this.field);return!(!iu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>it(this.value.arrayValue,e))}constructor(e,t){super(e,"array-contains-any",t)}}class ij{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function iz(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new ij(e,t,n,r,i,s,a)}function iG(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof iC)return t.field.canonicalString()+t.op.toString()+ia(t.value);if(ik(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return"".concat(t.op,"(").concat(n,")")}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),nR(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>ia(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>ia(e)).join(",")),e.Te=t}return e.Te}function iK(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof iC?n instanceof iC&&t.op===n.op&&t.field.isEqual(n.field)&&ie(t.value,n.value):t instanceof iA?n instanceof iA&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void tA(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!iT(e.startAt,t.startAt)&&iT(e.endAt,t.endAt)}function iQ(e){return t0.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function iH(e,t){return e.filters.filter(e=>e instanceof iC&&e.field.isEqual(t))}function iW(e,t,n){let r=r7,i=!0;for(let n of iH(e,t)){let e=r7,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?r7:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?io(r2.empty(),t0.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?ig(s)?iy:{mapValue:{}}:tA(35942,{value:s});break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=r7}0>iv({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>iv({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function iJ(e,t,n){let r=r4,i=!0;for(let n of iH(e,t)){let e=r4,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?io(r2.empty(),t0.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?iy:"mapValue"in s?ig(s)?{mapValue:{}}:r4:tA(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=r4}iw({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];iw({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class iX{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function iY(e){return new iX(e)}function iZ(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function i$(e){return null!==e.collectionGroup}function i0(e){if(null===e.Ie){let t;e.Ie=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new rL(t$.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new iS(t,r))}),n.has(t$.keyField().canonicalString())||e.Ie.push(new iS(t$.keyField(),r))}return e.Ie}function i1(e){return e.Ee||(e.Ee=i6(e,i0(e))),e.Ee}function i2(e){return e.de||(e.de=i6(e,e.explicitOrderBy)),e.de}function i6(e,t){if("F"===e.limitType)return iz(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new iS(e.field,t)});let n=e.endAt?new i_(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new i_(e.startAt.position,e.startAt.inclusive):null;return iz(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function i3(e,t){let n=e.filters.concat([t]);return new iX(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function i4(e,t,n){return new iX(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function i5(e,t){return iK(i1(e),i1(t))&&e.limitType===t.limitType}function i8(e){return"".concat(iG(i1(e)),"|lt:").concat(e.limitType)}function i7(e){var t;let n;return"Query(target=".concat((n=(t=i1(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=", filters: [".concat(t.filters.map(e=>(function e(t){return t instanceof iC?"".concat(t.field.canonicalString()," ").concat(t.op," ").concat(ia(t.value)):t instanceof iA?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", "),"]")),nR(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=", orderBy: [".concat(t.orderBy.map(e=>"".concat(e.field.canonicalString()," (").concat(e.dir,")")).join(", "),"]")),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>ia(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>ia(e)).join(",")),"Target(".concat(n,")")),"; limitType=").concat(e.limitType,")")}function i9(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):t0.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of i0(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,n){let r=iE(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,i0(e),t))&&(!e.endAt||!!function(e,t,n){let r=iE(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,i0(e),t))}function se(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function st(e){return(t,n)=>{let r=!1;for(let i of i0(e)){let e=function(e,t,n){let r=e.field.isKeyField()?t0.comparator(t.key,n.key):function(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?ir(r,i):tA(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return tA(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class sn{get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){rN(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return rR(this.inner)}size(){return this.innerSize}constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}}let sr=new rO(t0.comparator),si=new rO(t0.comparator);function ss(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=si;for(let e of t)r=r.insert(e.key,e);return r}function sa(e){let t=si;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function so(){return new sn(e=>e.toString(),(e,t)=>e.isEqual(t))}let sl=new rO(t0.comparator),su=new rL(t0.comparator);function sc(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=su;for(let e of t)r=r.add(e);return r}let sh=new rL(tK);function sd(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:nO(t)?"-0":t}}function sf(e){return{integerValue:""+e}}function sg(e,t){return nM(t)?sf(t):sd(e,t)}class sm{constructor(){this._=void 0}}function sp(e,t){return e instanceof s_?il(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class sy extends sm{}class sv extends sm{constructor(e){super(),this.elements=e}}function sw(e,t){let n=sT(t);for(let t of e.elements)n.some(e=>ie(e,t))||n.push(t);return{arrayValue:{values:n}}}class sb extends sm{constructor(e){super(),this.elements=e}}function sI(e,t){let n=sT(t);for(let t of e.elements)n=n.filter(e=>!ie(e,t));return{arrayValue:{values:n}}}class s_ extends sm{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function sE(e){return rK(e.integerValue||e.doubleValue)}function sT(e){return iu(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class sS{constructor(e,t){this.field=e,this.transform=t}}class sx{constructor(e,t){this.version=e,this.transformResults=t}}class sC{static none(){return new sC}static exists(e){return new sC(void 0,e)}static updateTime(e){return new sC(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}constructor(e,t){this.updateTime=e,this.exists=t}}function sA(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class sD{}function sN(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new sV(e.key,sC.none()):new sO(e.key,e.data,sC.none());{let n=e.data,r=ib.empty(),i=new rL(t$.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new sM(e.key,r,new rB(i.toArray()),sC.none())}}function sk(e,t,n,r){return e instanceof sO?function(e,t,n,r){if(!sA(e.precondition,t))return n;let i=e.value.clone(),s=sF(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof sM?function(e,t,n,r){if(!sA(e.precondition,t))return n;let i=sF(e.fieldTransforms,r,t),s=t.data;return(s.setAll(sP(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):sA(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function sR(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&tW(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof sv&&r instanceof sv||n instanceof sb&&r instanceof sb?tW(n.elements,r.elements,ie):n instanceof s_&&r instanceof s_?ie(n.Ae,r.Ae):n instanceof sy&&r instanceof sy)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class sO extends sD{getFieldMask(){return null}constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class sM extends sD{getFieldMask(){return this.fieldMask}constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function sP(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function sL(e,t,n){let r=new Map;tN(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let s=0;s<n.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);r.set(a.field,(i=n[s],o instanceof sv?sw(o,l):o instanceof sb?sI(o,l):i))}return r}function sF(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,e instanceof sy?function(e,t){let n={fields:{[rW]:{stringValue:rH},[rX]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&rY(t)&&(t=rZ(t)),t&&(n.fields[rJ]=t),{mapValue:n}}(t,s):e instanceof sv?sw(e,s):e instanceof sb?sI(e,s):function(e,t){let n=sp(e,t),r=sE(n)+sE(e.Ae);return il(n)&&il(e.Ae)?sf(r):sd(e.serializer,r)}(e,s))}return r}class sV extends sD{getFieldMask(){return null}constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class sB extends sD{getFieldMask(){return null}constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class sU{applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){e instanceof sO?function(e,t,n){let r=e.value.clone(),i=sL(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof sM?function(e,t,n){if(!sA(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=sL(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(sP(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=sk(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=sk(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=so();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=sN(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(nn.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),sc())}isEqual(e){return this.batchId===e.batchId&&tW(this.mutations,e.mutations,(e,t)=>sR(e,t))&&tW(this.baseMutations,e.baseMutations,(e,t)=>sR(e,t))}constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}}class sq{static from(e,t,n){tN(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=sl,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new sq(e,t,n,r)}constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}}class sj{getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}constructor(e,t){this.largestBatchId=e,this.mutation=t}}class sz{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class sG{constructor(e,t){this.count=e,this.unchangedNames=t}}function sK(e){switch(e){case tR.OK:return tA(64938);case tR.CANCELLED:case tR.UNKNOWN:case tR.DEADLINE_EXCEEDED:case tR.RESOURCE_EXHAUSTED:case tR.INTERNAL:case tR.UNAVAILABLE:case tR.UNAUTHENTICATED:return!1;case tR.INVALID_ARGUMENT:case tR.NOT_FOUND:case tR.ALREADY_EXISTS:case tR.PERMISSION_DENIED:case tR.FAILED_PRECONDITION:case tR.ABORTED:case tR.OUT_OF_RANGE:case tR.UNIMPLEMENTED:case tR.DATA_LOSS:return!0;default:return tA(15467,{code:e})}}function sQ(e){if(void 0===e)return tS("GRPC error has no .code"),tR.UNKNOWN;switch(e){case g.OK:return tR.OK;case g.CANCELLED:return tR.CANCELLED;case g.UNKNOWN:return tR.UNKNOWN;case g.DEADLINE_EXCEEDED:return tR.DEADLINE_EXCEEDED;case g.RESOURCE_EXHAUSTED:return tR.RESOURCE_EXHAUSTED;case g.INTERNAL:return tR.INTERNAL;case g.UNAVAILABLE:return tR.UNAVAILABLE;case g.UNAUTHENTICATED:return tR.UNAUTHENTICATED;case g.INVALID_ARGUMENT:return tR.INVALID_ARGUMENT;case g.NOT_FOUND:return tR.NOT_FOUND;case g.ALREADY_EXISTS:return tR.ALREADY_EXISTS;case g.PERMISSION_DENIED:return tR.PERMISSION_DENIED;case g.FAILED_PRECONDITION:return tR.FAILED_PRECONDITION;case g.ABORTED:return tR.ABORTED;case g.OUT_OF_RANGE:return tR.OUT_OF_RANGE;case g.UNIMPLEMENTED:return tR.UNIMPLEMENTED;case g.DATA_LOSS:return tR.DATA_LOSS;default:return tA(39323,{code:e})}}(m=g||(g={}))[m.OK=0]="OK",m[m.CANCELLED=1]="CANCELLED",m[m.UNKNOWN=2]="UNKNOWN",m[m.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",m[m.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",m[m.NOT_FOUND=5]="NOT_FOUND",m[m.ALREADY_EXISTS=6]="ALREADY_EXISTS",m[m.PERMISSION_DENIED=7]="PERMISSION_DENIED",m[m.UNAUTHENTICATED=16]="UNAUTHENTICATED",m[m.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",m[m.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",m[m.ABORTED=10]="ABORTED",m[m.OUT_OF_RANGE=11]="OUT_OF_RANGE",m[m.UNIMPLEMENTED=12]="UNIMPLEMENTED",m[m.INTERNAL=13]="INTERNAL",m[m.UNAVAILABLE=14]="UNAVAILABLE",m[m.DATA_LOSS=15]="DATA_LOSS";let sH=null;function sW(){return new TextEncoder}let sJ=new i([0xffffffff,0xffffffff],0);function sX(e){let t=sW().encode(e),n=new s;return n.update(t),new Uint8Array(n.digest())}function sY(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new i([n,r],0),new i([s,a],0)]}class sZ{ye(e,t,n){let r=e.add(t.multiply(i.fromNumber(n)));return 1===r.compare(sJ)&&(r=new i([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,n]=sY(sX(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);if(!this.we(r))return!1}return!0}static create(e,t,n){let r=new sZ(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.ge)return;let[t,n]=sY(sX(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);this.Se(r)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new s$("Invalid padding: ".concat(t));if(n<0||e.length>0&&0===this.hashCount)throw new s$("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new s$("Invalid padding when bitmap length is 0: ".concat(t));this.ge=8*e.length-t,this.pe=i.fromNumber(this.ge)}}class s$ extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class s0{static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,s1.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new s0(nn.min(),r,new rO(tK),sr,sc())}constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}}class s1{static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new s1(n,t,sc(),sc(),sc())}constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}}class s2{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class s6{constructor(e,t){this.targetId=e,this.Ce=t}}class s3{constructor(e,t,n=rj.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class s4{get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=sc(),t=sc(),n=sc();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:tA(38017,{changeType:i})}}),new s1(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=s7()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,tN(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}constructor(){this.ve=0,this.Fe=s7(),this.Me=rj.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}}class s5{Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:tA(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){let t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){let i=r.target;if(iQ(i))if(0===n){let e=new t0(i.path);this.et(t,e,iI.newNoDocument(e,nn.min()))}else tN(1===n,20013,{expectedCount:n});else{let r=this._t(t);if(r!==n){let n=this.ut(e),i=n?this.ct(n,e,r):1;0!==i&&(this.it(t),this.Ye=this.Ye.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null==sH||sH.lt(function(e,t,n,r,i){var s,a,o,l,u,c;let h={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(h.bloomFilter={applied:0===i,hashCount:null!=(l=null==d?void 0:d.hashCount)?l:0,bitmapLength:null!=(u=null==d||null==(a=d.bits)||null==(s=a.bitmap)?void 0:s.length)?u:0,padding:null!=(c=null==d||null==(o=d.bits)?void 0:o.padding)?c:0,mightContain:e=>{var t;return null!=(t=null==r?void 0:r.mightContain(e))&&t}}),h}(r,e.Ce,this.Ge.ht(),n,i))}}}}ut(e){let t,n,r=e.Ce.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=rQ(i).toUint8Array()}catch(e){if(e instanceof rU)return tx("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new sZ(t,s,a)}catch(e){return tx(e instanceof s$?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.ge?null:n}ct(e,t,n){return 2*(t.Ce.count!==n-this.Pt(e,t.targetId))}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Ge.ht(),s="projects/".concat(i.projectId,"/databases/").concat(i.database,"/documents/").concat(n.path.canonicalString());e.mightContain(s)||(this.et(t,n,null),r++)}),r}Tt(e){let t=new Map;this.ze.forEach((n,r)=>{let i=this.ot(r);if(i){if(n.current&&iQ(i.target)){let t=new t0(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,iI.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}});let n=sc();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));let r=new s0(e,t,this.Ye,this.je,n);return this.je=sr,this.Je=s8(),this.He=s8(),this.Ye=new rO(tK),r}Xe(e,t){if(!this.rt(e))return;let n=2*!!this.Et(e,t.key);this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new s4,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new rL(tK),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new rL(tK),this.Je=this.Je.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||tT("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new s4),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}constructor(e){this.Ge=e,this.ze=new Map,this.je=sr,this.Je=s8(),this.He=s8(),this.Ye=new rO(tK)}}function s8(){return new rO(t0.comparator)}function s7(){return new rO(t0.comparator)}let s9={asc:"ASCENDING",desc:"DESCENDING"},ae={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},at={and:"AND",or:"OR"};class an{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ar(e,t){return e.useProto3Json||nR(t)?t:{value:t}}function ai(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function as(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function aa(e){return tN(!!e,49232),nn.fromTimestamp(function(e){let t=rG(e);return new nt(t.seconds,t.nanos)}(e))}function ao(e,t){return al(e,t).canonicalString()}function al(e,t){let n=new tY(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function au(e){let t=tY.fromString(e);return tN(ax(t),10190,{key:t.toString()}),t}function ac(e,t){return ao(e.databaseId,t.path)}function ah(e,t){let n=au(t);if(n.get(1)!==e.databaseId.projectId)throw new tO(tR.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new tO(tR.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new t0(am(n))}function ad(e,t){return ao(e.databaseId,t)}function af(e){let t=au(e);return 4===t.length?tY.emptyPath():am(t)}function ag(e){return new tY(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function am(e){return tN(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function ap(e,t,n){return{name:ac(e,t),fields:n.value.mapValue.fields}}function ay(e,t,n){let r=ah(e,t.name),i=aa(t.updateTime),s=t.createTime?aa(t.createTime):nn.min(),a=new ib({mapValue:{fields:t.fields}}),o=iI.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function av(e,t){var n;let r;if(t instanceof sO)r={update:ap(e,t.key,t.value)};else if(t instanceof sV)r={delete:ac(e,t.key)};else if(t instanceof sM)r={update:ap(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof sB))return tA(16599,{Vt:t.type});r={verify:ac(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof sy)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof sv)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof sb)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof s_)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw tA(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(r.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:ai(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:tA(27497)),r}function aw(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?sC.updateTime(aa(n.updateTime)):void 0!==n.exists?sC.exists(n.exists):sC.none():sC.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let n;return n=null,"setToServerValue"in t?(tN("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new sy):"appendMissingElements"in t?n=new sv(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new sb(t.removeAllFromArray.values||[]):"increment"in t?n=new s_(e,t.increment):tA(16584,{proto:t}),new sS(t$.fromServerFormat(t.fieldPath),n)}):[];if(t.update){t.update.name;let n=ah(e,t.update.name),s=new ib({mapValue:{fields:t.update.fields}});return t.updateMask?new sM(n,s,new rB((t.updateMask.fieldPaths||[]).map(e=>t$.fromServerFormat(e))),r,i):new sO(n,s,r,i)}return t.delete?new sV(ah(e,t.delete),r):t.verify?new sB(ah(e,t.verify),r):tA(1463,{proto:t})}function ab(e,t){return{documents:[ad(e,t.path)]}}function aI(e,t){var n,r;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=ad(e,i);let o=function(e){if(0!==e.length)return function e(t){return t instanceof iC?function(e){if("=="===e.op){if(ih(e.value))return{unaryFilter:{field:aT(e.field),op:"IS_NAN"}};if(ic(e.value))return{unaryFilter:{field:aT(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ih(e.value))return{unaryFilter:{field:aT(e.field),op:"IS_NOT_NAN"}};if(ic(e.value))return{unaryFilter:{field:aT(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:aT(e.field),op:ae[e.op],value:e.value}}}(t):t instanceof iA?function(t){let n=t.getFilters().map(t=>e(t));return 1===n.length?n[0]:{compositeFilter:{op:at[t.op],filters:n}}}(t):tA(54877,{filter:t})}(iA.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:aT(e.field),direction:s9[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=ar(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{ft:s,parent:i}}function a_(e,t,n,r){let{ft:i,parent:s}=aI(e,t),a={},o=[],l=0;return n.forEach(e=>{let t=r?e.alias:"aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:aT(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:aT(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},gt:a,parent:s}}function aE(e){var t;let n,r=af(e.parent),i=e.structuredQuery,s=i.from?i.from.length:0,a=null;if(s>0){tN(1===s,65062);let e=i.from[0];e.allDescendants?a=e.collectionId:r=r.child(e.collectionId)}let o=[];i.where&&(o=function(e){let t=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=aS(e.unaryFilter.field);return iC.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=aS(e.unaryFilter.field);return iC.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=aS(e.unaryFilter.field);return iC.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=aS(e.unaryFilter.field);return iC.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return tA(61313);default:return tA(60726)}}(t):void 0!==t.fieldFilter?iC.create(aS(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return tA(58110);default:return tA(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?iA.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return tA(1026)}}(t.compositeFilter.op)):tA(30097,{filter:t})}(e);return t instanceof iA&&ik(t)?t.getFilters():[t]}(i.where));let l=[];i.orderBy&&(l=i.orderBy.map(e=>new iS(aS(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let u=null;i.limit&&(u=nR(n="object"==typeof(t=i.limit)?t.value:t)?null:n);let c=null;i.startAt&&(c=function(e){let t=!!e.before;return new i_(e.values||[],t)}(i.startAt));let h=null;return i.endAt&&(h=function(e){let t=!e.before;return new i_(e.values||[],t)}(i.endAt)),new iX(r,a,l,o,u,"F",c,h)}function aT(e){return{fieldPath:e.canonicalString()}}function aS(e){return t$.fromServerFormat(e.fieldPath)}function ax(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class aC{withSequenceNumber(e){return new aC(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new aC(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new aC(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new aC(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}constructor(e,t,n,r,i=nn.min(),s=nn.min(),a=rj.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}}class aA{constructor(e){this.yt=e}}function aD(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:aN(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:ac(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:ai(i,t.version.toTimestamp()),createTime:ai(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:ak(t.version)};else{if(!t.isUnknownDocument())return tA(57904,{document:t});r.unknownDocument={path:n.path.toArray(),version:ak(t.version)}}return r}function aN(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function ak(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function aR(e){let t=new nt(e.seconds,e.nanoseconds);return nn.fromTimestamp(t)}function aO(e,t){let n=(t.baseMutations||[]).map(t=>aw(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(n.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let r=t.mutations.map(t=>aw(e.yt,t)),i=nt.fromMillis(t.localWriteTimeMs);return new sU(t.batchId,i,n,r)}function aM(e){let t=aR(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?aR(e.lastLimboFreeSnapshotVersion):nn.min();return new aC(void 0!==e.query.documents?function(e){let t=e.documents.length;return tN(1===t,1966,{count:t}),i1(iY(af(e.documents[0])))}(e.query):i1(aE(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,rj.fromBase64String(e.resumeToken))}function aP(e,t){let n,r=ak(t.snapshotVersion),i=ak(t.lastLimboFreeSnapshotVersion);n=iQ(t.target)?ab(e.yt,t.target):aI(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:iG(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function aL(e){let t=aE({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?i4(t,t.limit,"L"):t}function aF(e,t){return new sj(t.largestBatchId,aw(e.yt,t.overlayMutation))}function aV(e,t){let n=t.path.lastSegment();return[e,nP(t.path.popLast()),n]}function aB(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:ak(r.readTime),documentKey:nP(r.documentKey.path),largestBatchId:r.largestBatchId}}class aU{getBundleMetadata(e,t){return rA(e,rr).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:aR(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return rA(e,rr).put({bundleId:t.id,createTime:ak(aa(t.createTime)),version:t.version})}getNamedQuery(e,t){return rA(e,ri).get(t).next(e=>{if(e)return{name:e.name,query:aL(e.bundledQuery),readTime:aR(e.readTime)}})}saveNamedQuery(e,t){return rA(e,ri).put({name:t.name,readTime:ak(aa(t.readTime)),bundledQuery:t.bundledQuery})}}class aq{static wt(e,t){return new aq(e,t.uid||"")}getOverlay(e,t){return rA(e,rm).get(aV(this.userId,t)).next(e=>e?aF(this.serializer,e):null)}getOverlays(e,t){let n=so();return np.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new sj(t,i);r.push(this.St(e,s))}),np.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(nP(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(rA(e,rm).Z(ry,r))}),np.waitFor(i)}getOverlaysForCollection(e,t,n){let r=so(),i=nP(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,1/0],!0);return rA(e,rm).J(ry,s).next(e=>{for(let t of e){let e=aF(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i,s=so(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,1/0],!0);return rA(e,rm).ee({index:rw,range:a},(e,t,n)=>{let a=aF(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}St(e,t){return rA(e,rm).put(function(e,t,n){let[r,i,s]=aV(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:av(e.yt,n.mutation)}}(this.serializer,this.userId,t))}constructor(e,t){this.serializer=e,this.userId=t}}class aj{bt(e){return rA(e,rI)}getSessionToken(e){return this.bt(e).get("sessionToken").next(e=>{let t=null==e?void 0:e.value;return t?rj.fromUint8Array(t):rj.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class az{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(rK(e.integerValue));else if("doubleValue"in e){let n=rK(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),nO(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=rG(n)),t.xt("".concat(n.seconds||"")),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(rQ(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?ip(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):ig(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):tA(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let n=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(n)))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){var n,r;let i=e.fields||{};this.Ft(t,53);let s=(null==(r=i[r8].arrayValue)||null==(n=r.values)?void 0:n.length)||0;this.Ft(t,15),t.Mt(rK(s)),this.Ot(r8,t),this.Ct(i[r8],t)}Qt(e,t){let n=e.values||[];for(let e of(this.Ft(t,50),n))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),t0.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}constructor(){}}function aG(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}az.Kt=new az;class aK{Wt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Ht()}Yt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Jt(e);else if(e<2048)this.Jt(960|e>>>6),this.Jt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Jt(480|e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e);else{let e=t.codePointAt(0);this.Jt(240|e>>>18),this.Jt(128|63&e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e)}}this.Ht()}Xt(e){let t=this.en(e),n=aG(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),n=aG(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t=function(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=255*!!n;return t}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Jt(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}constructor(){this.buffer=new Uint8Array(1024),this.position=0}}class aQ{Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}constructor(e){this.cn=e}}class aH{Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}constructor(e){this.cn=e}}class aW{seed(e){this.cn.seed(e)}Pn(e){return 0===e?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}constructor(){this.cn=new aK,this.ln=new aQ(this.cn),this.hn=new aH(this.cn)}}class aJ{An(){let e=this.dn.length,t=0===e||255===this.dn[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new aJ(this.Tn,this.In,this.En,n)}Rn(e,t,n){return{indexId:this.Tn,uid:e,arrayValue:aZ(this.En),directionalValue:aZ(this.dn),orderedDocumentKey:aZ(t),documentKey:n.path.toArray()}}Vn(e,t,n){let r=this.Rn(e,t,n);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}constructor(e,t,n,r){this.Tn=e,this.In=t,this.En=n,this.dn=r}}function aX(e,t){let n=e.Tn-t.Tn;return 0!==n||0!==(n=aY(e.En,t.En))||0!==(n=aY(e.dn,t.dn))?n:t0.comparator(e.In,t.In)}function aY(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}function aZ(e){return X()?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(e):e}function a$(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)}class a0{get pn(){return this.mn.size>1}yn(e){if(tN(e.collectionGroup===this.collectionId,49279),this.pn)return!1;let t=ni(e);if(void 0!==t&&!this.wn(t))return!1;let n=ns(e),r=new Set,i=0,s=0;for(;i<n.length&&this.wn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.mn.size>0){let e=this.mn.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.Sn(e,t)||!this.bn(this.fn[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.fn.length||!this.bn(this.fn[s++],e))return!1}return!0}Dn(){if(this.pn)return null;let e=new rL(t$.comparator),t=[];for(let n of this.gn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new no(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new no(n.field,0))}for(let n of this.fn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new no(n.field,+("asc"!==n.dir))));return new nr(nr.UNKNOWN_ID,this.collectionId,t,nl.empty())}wn(e){for(let t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}constructor(e){for(let t of(this.mn=new rL((e,t)=>t$.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[],e.filters))t.isInequality()?this.mn=this.mn.add(t):this.gn.push(t)}}function a1(e){return e instanceof iC}function a2(e){return e instanceof iA&&ik(e)}function a6(e){return a1(e)||a2(e)||function(e){if(e instanceof iA&&iN(e)){for(let t of e.getFilters())if(!a1(t)&&!a2(t))return!1;return!0}return!1}(e)}function a3(e,t){return tN(e instanceof iC||e instanceof iA,38388),tN(t instanceof iC||t instanceof iA,25473),a5(e instanceof iC?t instanceof iC?iA.create([e,t],"and"):a4(e,t):t instanceof iC?a4(t,e):function(e,t){if(tN(e.filters.length>0&&t.filters.length>0,48005),iD(e)&&iD(t))return iO(e,t.getFilters());let n=iN(e)?e:t,r=iN(e)?t:e,i=n.filters.map(e=>a3(e,r));return iA.create(i,"or")}(e,t))}function a4(e,t){if(iD(t))return iO(t,e.getFilters());{let n=t.filters.map(t=>a3(e,t));return iA.create(n,"or")}}function a5(e){if(tN(e instanceof iC||e instanceof iA,11850),e instanceof iC)return e;let t=e.getFilters();if(1===t.length)return a5(t[0]);if(iR(e))return e;let n=t.map(e=>a5(e)),r=[];return n.forEach(t=>{t instanceof iC?r.push(t):t instanceof iA&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:iA.create(r,e.op)}class a8{addToCollectionParentIndex(e,t){return this.Cn.add(t),np.resolve()}getCollectionParents(e,t){return np.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return np.resolve()}deleteFieldIndex(e,t){return np.resolve()}deleteAllFieldIndexes(e){return np.resolve()}createTargetIndexes(e,t){return np.resolve()}getDocumentsMatchingTarget(e,t){return np.resolve(null)}getIndexType(e,t){return np.resolve(0)}getFieldIndexes(e,t){return np.resolve([])}getNextCollectionGroupToUpdate(e){return np.resolve(null)}getMinOffset(e,t){return np.resolve(nh.min())}getMinOffsetFromCollectionGroup(e,t){return np.resolve(nh.min())}updateCollectionGroup(e,t,n){return np.resolve()}updateIndexEntries(e,t){return np.resolve()}constructor(){this.Cn=new a7}}class a7{add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new rL(tY.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new rL(tY.comparator)).toArray()}constructor(){this.index={}}}let a9="IndexedDbIndexManager",oe=new Uint8Array(0);class ot{addToCollectionParentIndex(e,t){if(!this.vn.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});let i={collectionId:n,parent:nP(r)};return rA(e,re).put(i)}return np.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return rA(e,re).J(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(nL(r.parent))}return n})}addFieldIndex(e,t){let n=rA(e,rs),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=rA(e,ro);return i.next(e=>{n.put(aB(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=rA(e,rs),r=rA(e,ro),i=rA(e,rh);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=rA(e,rs),n=rA(e,rh),r=rA(e,ro);return t.Z().next(()=>n.Z()).next(()=>r.Z())}createTargetIndexes(e,t){return np.forEach(this.Mn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new a0(t).Dn();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=rA(e,rh),r=!0,i=new Map;return np.forEach(this.Mn(t),t=>this.xn(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=sc(),r=[];return np.forEach(i,(i,s)=>{tT(a9,"Using index ".concat("id=".concat(i.indexId,"|cg=").concat(i.collectionGroup,"|f=").concat(i.fields.map(e=>"".concat(e.fieldPath,":").concat(e.kind)).join(","))," to execute ").concat(iG(t)));let a=function(e,t){let n=ni(t);if(void 0===n)return null;for(let t of iH(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let n=new Map;for(let r of ns(t))for(let t of iH(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of ns(t)){let t=0===i.kind?iW(e,i.fieldPath,e.startAt):iJ(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new i_(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of ns(t)){let t=0===i.kind?iJ(e,i.fieldPath,e.endAt):iW(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new i_(n,r)}(s,i),c=this.On(i,s,l),h=this.On(i,s,u),d=this.Nn(i,s,o),f=this.Bn(i.indexId,a,c,l.inclusive,h,u.inclusive,d);return np.forEach(f,i=>n.Y(i,t.limit).next(t=>{t.forEach(t=>{let n=t0.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return np.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(tN(t instanceof iC||t instanceof iA,34018),t instanceof iC)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=iA.create(n,t.op);return a6(r=a5(r))?r:(tN(r instanceof iA,64498),tN(iD(r),40251),tN(r.filters.length>1,57927),r.filters.reduce((e,t)=>a3(e,t)))}(function e(t){if(tN(t instanceof iC||t instanceof iA,20012),t instanceof iC){if(t instanceof iB){var n,r;let e=(null==(r=t.value.arrayValue)||null==(n=r.values)?void 0:n.map(e=>iC.create(t.field,"==",e)))||[];return iA.create(e,"or")}return t}let i=t.filters.map(t=>e(t));return iA.create(i,t.op)}(e));return tN(a6(t),7391),a1(t)||a2(t)?[t]:t.getFilters()})(iA.create(e.filters,"and")).map(t=>iz(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t)),t}Bn(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let c=0;c<o;++c){let o=t?this.Ln(t[c/l]):oe,h=this.kn(e,o,n[c%l],r),d=this.qn(e,o,i[c%l],s),f=a.map(t=>this.kn(e,o,t,!0));u.push(...this.createRange(h,d,f))}return u}kn(e,t,n,r){let i=new aJ(e,t0.empty(),t,n);return r?i:i.An()}qn(e,t,n,r){let i=new aJ(e,t0.empty(),t,n);return r?i.An():i}xn(e,t){let n=new a0(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.yn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.Mn(t);return np.forEach(r,t=>this.xn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new rL(t$.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+ +!!n}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}Qn(e,t){let n=new aW;for(let r of ns(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.Pn(r.kind);az.Kt.Dt(e,i)}return n.un()}Ln(e){let t=new aW;return az.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){let n=new aW;return az.Kt.Dt(io(this.databaseId,t),n.Pn(function(e){let t=ns(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.un()}Nn(e,t,n){if(null===n)return[];let r=[];r.push(new aW);let i=0;for(let s of ns(e)){let e=n[i++];for(let n of r)if(this.Un(t,s.fieldPath)&&iu(e))r=this.Kn(r,s,e);else{let t=n.Pn(s.kind);az.Kt.Dt(e,t)}}return this.Wn(r)}On(e,t,n){return this.Nn(e,t,n.position)}Wn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Kn(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new aW;r.seed(n.un()),az.Kt.Dt(e,r.Pn(t.kind)),i.push(r)}return i}Un(e,t){return!!e.filters.find(e=>e instanceof iC&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=rA(e,rs),r=rA(e,ro);return(t?n.J(ra,IDBKeyRange.bound(t,t)):n.J()).next(e=>{let t=[];return np.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){let n=t?new nl(t.sequenceNumber,new nh(aR(t.readTime),new t0(nL(t.documentKey)),t.largestBatchId)):nl.empty(),r=e.fields.map(e=>{let[t,n]=e;return new no(t$.fromServerFormat(t),n)});return new nr(e.indexId,e.collectionGroup,r,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:tK(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=rA(e,rs),i=rA(e,ro);return this.Gn(e).next(e=>r.J(ra,IDBKeyRange.bound(t,t)).next(t=>np.forEach(t,t=>i.put(aB(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return np.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?np.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),np.forEach(i,n=>this.zn(e,t,n).next(t=>{let i=this.jn(r,n);return t.isEqual(i)?np.resolve():this.Jn(e,r,n,t,i)}))))})}Hn(e,t,n,r){return rA(e,rh).put(r.Rn(this.uid,this.$n(n,t.key),t.key))}Yn(e,t,n,r){return rA(e,rh).delete(r.Vn(this.uid,this.$n(n,t.key),t.key))}zn(e,t,n){let r=rA(e,rh),i=new rL(aX);return r.ee({index:rf,range:IDBKeyRange.only([n.indexId,this.uid,aZ(this.$n(n,t))])},(e,r)=>{i=i.add(new aJ(n.indexId,t,a$(r.arrayValue),a$(r.directionalValue)))}).next(()=>i)}jn(e,t){let n=new rL(aX),r=this.Qn(t,e);if(null==r)return n;let i=ni(t);if(null!=i){let s=e.data.field(i.fieldPath);if(iu(s))for(let i of s.arrayValue.values||[])n=n.add(new aJ(t.indexId,e.key,this.Ln(i),r))}else n=n.add(new aJ(t.indexId,e.key,oe,r));return n}Jn(e,t,n,r,i){tT(a9,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=rV(s),l=rV(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=rV(a)):t?(i(o),o=rV(s)):(o=rV(s),l=rV(a))}}(r,i,aX,r=>{s.push(this.Hn(e,t,n,r))},r=>{s.push(this.Yn(e,t,n,r))}),np.waitFor(s)}Gn(e){let t=1;return rA(e,ro).ee({index:ru,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>aX(e,t)).filter((e,t,n)=>!t||0!==aX(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=aX(i,e),s=aX(i,t);if(0===n)r[0]=e.An();else if(n>0&&s<0)r.push(i),r.push(i.An());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.Zn(r[e],r[e+1]))return[];let t=r[e].Vn(this.uid,oe,t0.empty()),n=r[e+1].Vn(this.uid,oe,t0.empty());i.push(IDBKeyRange.bound(t,n))}return i}Zn(e,t){return aX(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(on)}getMinOffset(e,t){return np.mapArray(this.Mn(t),t=>this.xn(e,t).next(e=>e||tA(44426))).next(on)}constructor(e,t){this.databaseId=t,this.vn=new a7,this.Fn=new sn(e=>iG(e),(e,t)=>iK(e,t)),this.uid=e.uid||""}}function on(e){tN(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>nd(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new nh(t.readTime,t.documentKey,n)}let or={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class oi{static withCacheSize(e){return new oi(e,oi.DEFAULT_COLLECTION_PERCENTILE,oi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function os(e,t,n){let r=e.store(nq),i=e.store(nQ),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.ee({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{tN(1===o,47070,{batchId:n.batchId})}));let u=[];for(let e of n.mutations){var c,h;let r=(c=e.key.path,h=n.batchId,[t,nP(c),h]);s.push(i.delete(r)),u.push(e.key)}return np.waitFor(s).next(()=>u)}function oa(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw tA(14731);t=e.noDocument}return JSON.stringify(t).length}oi.DEFAULT_COLLECTION_PERCENTILE=10,oi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,oi.DEFAULT=new oi(0x2800000,oi.DEFAULT_COLLECTION_PERCENTILE,oi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),oi.DISABLED=new oi(-1,0,0);class oo{static wt(e,t,n,r){return tN(""!==e.uid,64387),new oo(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return ou(e).ee({index:nz,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=rA(e,nQ),s=ou(e);return s.add({}).next(a=>{tN("number"==typeof a,49019);let o=new sU(a,t,n,r),l=function(e,t,n){let r=n.baseMutations.map(t=>av(e.yt,t)),i=n.mutations.map(t=>av(e.yt,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,o),u=[],c=new rL((e,t)=>tK(e.canonicalString(),t.canonicalString()));for(let e of r){var h,d;let t=(h=this.userId,d=e.key.path,[h,nP(d),a]);c=c.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,nK))}return c.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Xn[a]=o.keys()}),np.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return ou(e).get(t).next(e=>e?(tN(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),aO(this.serializer,e)):null)}er(e,t){return this.Xn[t]?np.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.Xn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return ou(e).ee({index:nz,range:r},(e,t,r)=>{t.userId===this.userId&&(tN(t.batchId>=n,47524,{tr:n}),i=aO(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),n=-1;return ou(e).ee({index:nz,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return ou(e).J(nz,t).next(e=>e.map(e=>aO(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,nP(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return rA(e,nQ).ee({range:r},(n,r,s)=>{let[a,o,l]=n,u=nL(o);if(a===this.userId&&t.path.isEqual(u))return ou(e).get(l).next(e=>{if(!e)throw tA(61480,{nr:n,batchId:l});tN(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(aO(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new rL(tK),r=[];return t.forEach(t=>{let i=[this.userId,nP(t.path)],s=IDBKeyRange.lowerBound(i),a=rA(e,nQ).ee({range:s},(e,r,i)=>{let[s,a,o]=e,l=nL(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):i.done()});r.push(a)}),np.waitFor(r).next(()=>this.rr(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,nP(n)],s=IDBKeyRange.lowerBound(i),a=new rL(tK);return rA(e,nQ).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=nL(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(l)):i.done()}).next(()=>this.rr(e,a))}rr(e,t){let n=[],r=[];return t.forEach(t=>{r.push(ou(e).get(t).next(e=>{if(null===e)throw tA(35274,{batchId:t});tN(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(aO(this.serializer,e))}))}),np.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return os(e.le,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),np.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return np.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return rA(e,nQ).ee({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=nL(e[1]);r.push(t)}else n.done()}).next(()=>{tN(0===r.length,56720,{sr:r.map(e=>e.canonicalString())})})})}containsKey(e,t){return ol(e,this.userId,t)}_r(e){return rA(e,nU).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Xn={}}}function ol(e,t,n){let r=[t,nP(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return rA(e,nQ).ee({range:s,X:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function ou(e){return rA(e,nq)}class oc{next(){return this.ar+=2,this.ar}static ur(){return new oc(0)}static cr(){return new oc(-1)}constructor(e){this.ar=e}}class oh{allocateTargetId(e){return this.lr(e).next(t=>{let n=new oc(t.highestTargetId);return t.highestTargetId=n.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(e=>nn.fromTimestamp(new nt(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.lr(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.hr(e,r)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(n=>(n.targetCount+=1,this.Tr(t,n),this.hr(e,n))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>rA(e,n1).delete(t.targetId)).next(()=>this.lr(e)).next(t=>(tN(t.targetCount>0,8065),t.targetCount-=1,this.hr(e,t)))}removeTargets(e,t,n){let r=0,i=[];return rA(e,n1).ee((s,a)=>{let o=aM(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>np.waitFor(i)).next(()=>r)}forEachTarget(e,t){return rA(e,n1).ee((e,n)=>{t(aM(n))})}lr(e){return rA(e,n9).get(n7).next(e=>(tN(null!==e,2888),e))}hr(e,t){return rA(e,n9).put(n7,t)}Pr(e,t){return rA(e,n1).put(aP(this.serializer,t))}Tr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.lr(e).next(e=>e.targetCount)}getTargetData(e,t){let n=iG(t),r=IDBKeyRange.bound([n,-1/0],[n,1/0]),i=null;return rA(e,n1).ee({range:r,index:n2},(e,n,r)=>{let s=aM(n);iK(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=od(e);return t.forEach(t=>{let s=nP(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),np.waitFor(r)}removeMatchingKeys(e,t,n){let r=od(e);return np.forEach(t,t=>{let i=nP(t.path);return np.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=od(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=od(e),i=sc();return r.ee({range:n,X:!0},(e,t,n)=>{let r=new t0(nL(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=nP(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return od(e).ee({index:n5,X:!0,range:r},(e,t,n)=>{let[r,s]=e;0!==r&&(i++,n.done())}).next(()=>i>0)}At(e,t){return rA(e,n1).get(t).next(e=>e?aM(e):null)}constructor(e,t){this.referenceDelegate=e,this.serializer=t}}function od(e){return rA(e,n3)}let of="LruGarbageCollector";function og(e,t){let[n,r]=e,[i,s]=t,a=tK(n,i);return 0===a?tK(r,s):a}class om{dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>og(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}constructor(e){this.Ir=e,this.buffer=new rL(og),this.Er=0}}class op{start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){tT(of,"Garbage collection scheduled in ".concat(e,"ms")),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){nE(e)?tT(of,"Ignoring IndexedDB error during garbage collection: ",e):await nm(e)}await this.Vr(3e5)})}constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}}class oy{calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return np.resolve(nk.ce);let n=new om(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(tT("LruGarbageCollector","Garbage collection skipped; disabled"),np.resolve(or)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(tT("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(n," is lower than threshold ").concat(this.params.cacheSizeCollectionThreshold)),or):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,i,s,a,o,l,u,c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(tT("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(this.params.maximumSequenceNumbersToCollect," from ").concat(t)),i=this.params.maximumSequenceNumbersToCollect):i=t,a=Date.now(),this.nthSequenceNumber(e,i))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(s=t,l=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(u=Date.now(),t_()<=r.DEBUG&&tT("LruGarbageCollector","LRU Garbage Collection\n	Counted targets in ".concat(a-c,"ms\n	Determined least recently used ").concat(i," in ")+(o-a)+"ms\n"+"	Removed ".concat(s," targets in ")+(l-o)+"ms\n"+"	Removed ".concat(e," documents in ")+(u-l)+"ms\n"+"Total Duration: ".concat(u-c,"ms")),np.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}constructor(e,t){this.mr=e,this.params=t}}class ov{gr(e){let t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(e,n)=>t(n))}addReference(e,t,n){return ow(e,n)}removeReference(e,t,n){return ow(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return ow(e,t)}br(e,t){let n;return n=!1,rA(e,nU).te(r=>ol(e,r,t).next(e=>(e&&(n=!0),np.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.Sr(e,(s,a)=>{if(a<=t){let t=this.br(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,nn.min()),od(e).delete([0,nP(s.path)])))});r.push(t)}}).next(()=>np.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return ow(e,t)}Sr(e,t){let n=od(e),r,i=nk.ce;return n.ee({index:n5},(e,n)=>{let[s,a]=e,{path:o,sequenceNumber:l}=n;0===s?(i!==nk.ce&&t(new t0(nL(r)),i),i=l,r=o):i=nk.ce}).next(()=>{i!==nk.ce&&t(new t0(nL(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}constructor(e,t){this.db=e,this.garbageCollector=new oy(this,t)}}function ow(e,t){var n;return od(e).put((n=e.currentSequenceNumber,{targetId:0,path:nP(t.path),sequenceNumber:n}))}class ob{addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,iI.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?np.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}constructor(){this.changes=new sn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}}class oI{setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return rA(e,nH).put(n)}removeEntry(e,t,n){return rA(e,nH).delete(function(e,t){let n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],aN(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.Dr(e,n)))}getEntry(e,t){let n=iI.newInvalidDocument(t);return rA(e,nH).ee({index:nJ,range:IDBKeyRange.only(oE(t))},(e,r)=>{n=this.Cr(t,r)}).next(()=>n)}vr(e,t){let n={size:0,document:iI.newInvalidDocument(t)};return rA(e,nH).ee({index:nJ,range:IDBKeyRange.only(oE(t))},(e,r)=>{n={document:this.Cr(t,r),size:oa(r)}}).next(()=>n)}getEntries(e,t){let n=sr;return this.Fr(e,t,(e,t)=>{let r=this.Cr(e,t);n=n.insert(e,r)}).next(()=>n)}Mr(e,t){let n=sr,r=new rO(t0.comparator);return this.Fr(e,t,(e,t)=>{let i=this.Cr(e,t);n=n.insert(e,i),r=r.insert(e,oa(t))}).next(()=>({documents:n,Or:r}))}Fr(e,t,n){if(t.isEmpty())return np.resolve();let r=new rL(oS);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(oE(r.first()),oE(r.last())),s=r.getIterator(),a=s.getNext();return rA(e,nH).ee({index:nJ,range:i},(e,t,r)=>{let i=t0.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>oS(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.j(oE(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),aN(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return rA(e,nH).J(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let n=sr;for(let i of e){let e=this.Cr(t0.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(i9(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=sr,s=oT(t,n),a=oT(t,nh.max());return rA(e,nH).ee({index:nY,range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.Cr(t0.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new o_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return rA(e,n$).get(n0).next(e=>(tN(!!e,20021),e))}Dr(e,t){return rA(e,n$).put(n0,t)}Cr(e,t){if(t){let e=function(e,t){let n;if(t.document)n=ay(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=t0.fromSegments(t.noDocument.path),r=aR(t.noDocument.readTime);n=iI.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return tA(56709);{let e=t0.fromSegments(t.unknownDocument.path),r=aR(t.unknownDocument.version);n=iI.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){let t=new nt(e[0],e[1]);return nn.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(nn.min())))return e}return iI.newInvalidDocument(e)}constructor(e){this.serializer=e}}class o_ extends ob{applyChanges(e){let t=[],n=0,r=new rL((e,t)=>tK(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=aD(this.Nr.serializer,s);r=r.add(i.path.popLast());let l=oa(o);n+=l-a.size,t.push(this.Nr.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=aD(this.Nr.serializer,s.convertToNoDocument(nn.min()));t.push(this.Nr.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Nr.updateMetadata(e,n)),np.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(e=>(this.Br.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(e=>{let{documents:t,Or:n}=e;return n.forEach((e,n)=>{this.Br.set(e,{size:n,readTime:t.get(e).readTime})}),t})}constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new sn(e=>e.toString(),(e,t)=>e.isEqual(t))}}function oE(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function oT(e,t){let n=t.documentKey.path.toArray();return[e,aN(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function oS(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=tK(n[e],r[e]))return i;return(i=tK(n.length,r.length))||(i=tK(n[n.length-2],r[r.length-2]))||tK(n[n.length-1],r[r.length-1])}class ox{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class oC{getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&sk(n.mutation,e,rB.empty(),nt.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,sc()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sc(),r=so();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=ss();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=so();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,sc()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=sr,s=so(),a=so();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof sM)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),sk(a.mutation,t,a.mutation.getFieldMask(),nt.now())):s.set(t.key,rB.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new ox(t,null!=(n=s.get(e))?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=so(),r=new rO((e,t)=>e-t),i=sc();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||rB.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||sc()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=so();l.forEach(e=>{if(!i.has(e)){let r=sN(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return np.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return t0.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):i$(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):np.resolve(so()),a=-1,o=i;return s.next(t=>np.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?np.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,sc())).next(e=>({batchId:a,changes:sa(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new t0(t)).next(e=>{let t=ss();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=ss();return this.indexManager.getCollectionParents(e,i).next(a=>np.forEach(a,a=>{let o=new iX(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,iI.newInvalidDocument(r)))});let n=ss();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&sk(s.mutation,r,rB.empty(),nt.now()),i9(t,r)&&(n=n.insert(e,r))}),n})}constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}}class oA{getBundleMetadata(e,t){return np.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:t.id,version:t.version,createTime:aa(t.createTime)}),np.resolve()}getNamedQuery(e,t){return np.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:t.name,query:aL(t.bundledQuery),readTime:aa(t.readTime)}),np.resolve()}constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}}class oD{getOverlay(e,t){return np.resolve(this.overlays.get(t))}getOverlays(e,t){let n=so();return np.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),np.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),np.resolve()}getOverlaysForCollection(e,t,n){let r=so(),i=t.length+1,s=new t0(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return np.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new rO((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=so(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=so(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return np.resolve(a)}St(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new sj(t,n));let i=this.qr.get(t);void 0===i&&(i=sc(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}constructor(){this.overlays=new rO(t0.comparator),this.qr=new Map}}class oN{getSessionToken(e){return np.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,np.resolve()}constructor(){this.sessionToken=rj.EMPTY_BYTE_STRING}}class ok{isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let n=new oR(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new oR(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){let t=new t0(new tY([])),n=new oR(t,e),r=new oR(t,e+1),i=[];return this.Ur.forEachInRange([n,r],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new t0(new tY([])),n=new oR(t,e),r=new oR(t,e+1),i=sc();return this.Ur.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new oR(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}constructor(){this.Qr=new rL(oR.$r),this.Ur=new rL(oR.Kr)}}class oR{static $r(e,t){return t0.comparator(e.key,t.key)||tK(e.Yr,t.Yr)}static Kr(e,t){return tK(e.Yr,t.Yr)||t0.comparator(e.key,t.key)}constructor(e,t){this.key=e,this.Yr=t}}class oO{checkEmpty(e){return np.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new sU(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Zr=this.Zr.add(new oR(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return np.resolve(s)}lookupMutationBatch(e,t){return np.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.ei(t+1),r=n<0?0:n;return np.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return np.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return np.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new oR(t,0),r=new oR(t,1/0),i=[];return this.Zr.forEachInRange([n,r],e=>{let t=this.Xr(e.Yr);i.push(t)}),np.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new rL(tK);return t.forEach(e=>{let t=new oR(e,0),r=new oR(e,1/0);this.Zr.forEachInRange([t,r],e=>{n=n.add(e.Yr)})}),np.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;t0.isDocumentKey(i)||(i=i.child(""));let s=new oR(new t0(i),0),a=new rL(tK);return this.Zr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Yr)),!0)},s),np.resolve(this.ti(a))}ti(e){let t=[];return e.forEach(e=>{let n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){tN(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return np.forEach(t.mutations,r=>{let i=new oR(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){let n=new oR(t,0),r=this.Zr.firstAfterOrEqual(n);return np.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,np.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new rL(oR.$r)}}class oM{setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return np.resolve(n?n.document.mutableCopy():iI.newInvalidDocument(t))}getEntries(e,t){let n=sr;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():iI.newInvalidDocument(e))}),np.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=sr,s=t.path,a=new t0(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=nd(nc(a),n)||(r.has(a.key)||i9(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return np.resolve(i)}getAllFromCollectionGroup(e,t,n,r){tA(9500)}ii(e,t){return np.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new oP(this)}getSize(e){return np.resolve(this.size)}constructor(e){this.ri=e,this.docs=new rO(t0.comparator),this.size=0}}class oP extends ob{applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),np.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}constructor(e){super(),this.Nr=e}}class oL{forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),np.resolve()}getLastRemoteSnapshotVersion(e){return np.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return np.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),np.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),np.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new oc(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,np.resolve()}updateTargetData(e,t){return this.Pr(t),np.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,np.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.si.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),np.waitFor(i).next(()=>r)}getTargetCount(e){return np.resolve(this.targetCount)}getTargetData(e,t){let n=this.si.get(t)||null;return np.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),np.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),np.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),np.resolve()}getMatchingKeysForTargetId(e,t){let n=this._i.Hr(t);return np.resolve(n)}containsKey(e,t){return np.resolve(this._i.containsKey(t))}constructor(e){this.persistence=e,this.si=new sn(e=>iG(e),iK),this.lastRemoteSnapshotVersion=nn.min(),this.highestTargetId=0,this.oi=0,this._i=new ok,this.targetCount=0,this.ai=oc.ur()}}class oF{start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new oD,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new oO(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){tT("MemoryPersistence","Starting transaction:",e);let r=new oV(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return np.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}constructor(e,t){this.ui={},this.overlays={},this.ci=new nk(0),this.li=!1,this.li=!0,this.hi=new oN,this.referenceDelegate=e(this),this.Pi=new oL(this),this.indexManager=new a8,this.remoteDocumentCache=new oM(e=>this.referenceDelegate.Ti(e)),this.serializer=new aA(t),this.Ii=new oA(this.serializer)}}class oV extends ng{constructor(e){super(),this.currentSequenceNumber=e}}class oB{static mi(e){return new oB(e)}get fi(){if(this.Vi)return this.Vi;throw tA(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),np.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),np.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),np.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return np.forEach(this.fi,n=>{let r=t0.fromPath(n);return this.gi(e,r).next(e=>{e||t.removeEntry(r,nn.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return np.or([()=>np.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}constructor(e){this.persistence=e,this.Ri=new ok,this.Vi=null}}class oU{static mi(e,t){return new oU(e,t)}Ei(){}di(e){return np.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return np.forEach(this.pi,(n,r)=>this.br(e,n,r).next(e=>e?np.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(n++,i.removeEntry(r,nn.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),np.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),np.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),np.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),np.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(r9(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=rZ(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return rQ(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,rN(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw tA(13486,{value:t})}}(e.data.value)),t}br(e,t,n){return np.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.pi.get(t);return np.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}constructor(e,t){this.persistence=e,this.pi=new sn(e=>nP(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new oy(this,t)}}class oq{k(e,t,n,r){let i=new nv("createOrUpgrade",t);n<1&&r>=1&&(e.createObjectStore(nV),e.createObjectStore(nU,{keyPath:"userId"}),e.createObjectStore(nq,{keyPath:nj,autoIncrement:!0}).createIndex(nz,nG,{unique:!0}),e.createObjectStore(nQ),oj(e),e.createObjectStore(nF));let s=np.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore(n3),e.deleteObjectStore(n1),e.deleteObjectStore(n9),oj(e)),s=s.next(()=>(function(e){let t=e.store(n9),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:nn.min().toTimestamp(),targetCount:0};return t.put(n7,n)})(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store(nq).J().next(t=>{e.deleteObjectStore(nq),e.createObjectStore(nq,{keyPath:nj,autoIncrement:!0}).createIndex(nz,nG,{unique:!0});let n=i.store(nq),r=t.map(e=>n.put(e));return np.waitFor(r)}))),s=s.next(()=>{e.createObjectStore(rn,{keyPath:"clientId"})})),n<5&&r>=5&&(s=s.next(()=>this.yi(i))),n<6&&r>=6&&(s=s.next(()=>(e.createObjectStore(n$),this.wi(i)))),n<7&&r>=7&&(s=s.next(()=>this.Si(i))),n<8&&r>=8&&(s=s.next(()=>this.bi(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.Di(i))),n<11&&r>=11&&(s=s.next(()=>{e.createObjectStore(rr,{keyPath:"bundleId"}),e.createObjectStore(ri,{keyPath:"name"})})),n<12&&r>=12&&(s=s.next(()=>{let t=e.createObjectStore(rm,{keyPath:rp});t.createIndex(ry,rv,{unique:!1}),t.createIndex(rw,rb,{unique:!1})})),n<13&&r>=13&&(s=s.next(()=>(function(e){let t=e.createObjectStore(nH,{keyPath:nW});t.createIndex(nJ,nX),t.createIndex(nY,nZ)})(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(nF))),n<14&&r>=14&&(s=s.next(()=>this.Fi(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore(rs,{keyPath:"indexId",autoIncrement:!0}).createIndex(ra,"collectionGroup",{unique:!1}),e.createObjectStore(ro,{keyPath:rl}).createIndex(ru,rc,{unique:!1}),e.createObjectStore(rh,{keyPath:rd}).createIndex(rf,rg,{unique:!1})})),n<16&&r>=16&&(s=s.next(()=>{t.objectStore(ro).clear()}).next(()=>{t.objectStore(rh).clear()})),n<17&&r>=17&&(s=s.next(()=>{e.createObjectStore(rI,{keyPath:"name"})})),n<18&&r>=18&&X()&&(s=s.next(()=>{t.objectStore(ro).clear()}).next(()=>{t.objectStore(rh).clear()})),s}wi(e){let t=0;return e.store(nF).ee((e,n)=>{t+=oa(n)}).next(()=>{let n={byteSize:t};return e.store(n$).put(n0,n)})}yi(e){let t=e.store(nU),n=e.store(nq);return t.J().next(t=>np.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.J(nz,r).next(n=>np.forEach(n,n=>{tN(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});let r=aO(this.serializer,n);return os(e,t.userId,r).next(()=>{})}))}))}Si(e){let t=e.store(n3),n=e.store(nF);return e.store(n9).get(n7).next(e=>{let r=[];return n.ee((n,i)=>{let s=new tY(n),a=[0,nP(s)];r.push(t.get(a).next(n=>n?np.resolve():t.put({targetId:0,path:nP(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>np.waitFor(r))})}bi(e,t){e.createObjectStore(re,{keyPath:rt});let n=t.store(re),r=new a7,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:nP(r)})}};return t.store(nF).ee({X:!0},(e,t)=>i(new tY(e).popLast())).next(()=>t.store(nQ).ee({X:!0},(e,t)=>{let[n,r,s]=e;return i(nL(r).popLast())}))}Di(e){let t=e.store(n1);return t.ee((e,n)=>{let r=aM(n),i=aP(this.serializer,r);return t.put(i)})}Ci(e,t){let n=t.store(nF),r=[];return n.ee((e,n)=>{let i=t.store(nH),s=(n.document?new t0(tY.fromString(n.document.name).popFirst(5)):n.noDocument?t0.fromSegments(n.noDocument.path):n.unknownDocument?t0.fromSegments(n.unknownDocument.path):tA(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>np.waitFor(r))}Fi(e,t){let n=t.store(nq),r=new oI(this.serializer),i=new oF(oB.mi,this.serializer.yt);return n.J().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!=(t=n.get(e.userId))?t:sc();aO(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),np.forEach(n,(e,n)=>{let s=new tw(n),a=aq.wt(this.serializer,s),o=i.getIndexManager(s);return new oC(r,oo.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new rC(t,nk.ce),e).next()})})}constructor(e){this.serializer=e}}function oj(e){e.createObjectStore(n3,{keyPath:n4}).createIndex(n5,n8,{unique:!0}),e.createObjectStore(n1,{keyPath:"targetId"}).createIndex(n2,n6,{unique:!0}),e.createObjectStore(n9)}let oz="IndexedDbPersistence",oG="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",oK="main";class oQ{start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new tO(tR.FAILED_PRECONDITION,oG);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new nk(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>rA(e,rn).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(e=>{e||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(nE(e))return tT(oz,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return tT(oz,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return rA(e,nV).get(nB).next(e=>np.resolve(this.es(e)))}ts(e){return rA(e,rn).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,18e5)){this.qi=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=rA(e,rn);return t.J().next(e=>{let n=this.ss(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return np.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Ki)for(let t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?np.resolve(!0):rA(e,nV).get(nB).next(t=>{if(null!==t&&this.rs(t.leaseTimestampMs,5e3)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new tO(tR.FAILED_PRECONDITION,oG);return!1}}return!(!this.networkEnabled||!this.inForeground)||rA(e,rn).J().next(e=>void 0===this.ss(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&tT(oz,"Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[nV,rn],e=>{let t=new rC(e,nk.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(e=>this.rs(e.updateTimeMs,t)&&!this.us(e.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>rA(e,rn).J().next(e=>this.ss(e,18e5).map(e=>e.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return oo.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ot(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return aq.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,n){var r;let i;tT(oz,"Starting transaction:",e);let s=18===(r=this.Ni)||17===r?rx:16===r||15===r?rS:14===r||13===r?rT:12===r?rE:11===r?r_:void tA(60245);return this.Ui.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new rC(r,this.ci?this.ci.next():nk.ce),"readwrite-primary"===t?this.Hi(i).next(e=>!!e||this.Yi(i)).next(t=>{if(!t)throw tS("Failed to obtain primary lease for action '".concat(e,"'.")),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new tO(tR.FAILED_PRECONDITION,nf);return n(i)}).next(e=>this.Xi(i).next(()=>e)):this.Is(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Is(e){return rA(e,nV).get(nB).next(e=>{if(null!==e&&this.rs(e.leaseTimestampMs,5e3)&&!this.us(e.ownerId)&&!this.es(e)&&!(this.Oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new tO(tR.FAILED_PRECONDITION,oG)})}Xi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return rA(e,nV).put(nB,t)}static v(){return nw.v()}Zi(e){let t=rA(e,nV);return t.get(nB).next(e=>this.es(e)?(tT(oz,"Releasing primary lease."),t.delete(nB)):np.resolve())}rs(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(tS("Detected an update time that is in the future: ".concat(e," > ").concat(n)),!1))}Gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground="visible"===this.document.visibilityState)}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.Bi=()=>{this.cs();let e=/(?:Version|Mobile)\/1[456]/;J()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{var t;let n=null!==(null==(t=this.Ki)?void 0:t.getItem(this._s(e)));return tT(oz,"Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return tS(oz,"Failed to get zombied client id.",e),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){tS("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch(e){}}_s(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}constructor(e,t,n,r,i,s,a,o,l,u,c=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Mi=i,this.window=s,this.document=a,this.xi=l,this.Oi=u,this.Ni=c,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=-1/0,this.Qi=e=>Promise.resolve(),!oQ.v())throw new tO(tR.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ov(this,r),this.$i=t+oK,this.serializer=new aA(o),this.Ui=new nw(this.$i,this.Ni,new oq(this.serializer)),this.hi=new aj,this.Pi=new oh(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new oI(this.serializer),this.Ii=new aU,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,!1===u&&tS(oz,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}}function oH(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class oW{static As(e,t){let n=sc(),r=sc();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new oW(e,t.fromCache,n,r)}constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}}class oJ{get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}constructor(){this._documentReadCount=0}}class oX{initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new oJ;return this.Ss(e,t,n).next(r=>{if(i.result=r,this.Vs)return this.bs(e,t,n,r.size)})}).next(()=>i.result)}bs(e,t,n,i){return n.documentReadCount<this.fs?(t_()<=r.DEBUG&&tT("QueryEngine","SDK will not create cache indexes for query:",i7(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),np.resolve()):(t_()<=r.DEBUG&&tT("QueryEngine","Query:",i7(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.gs*i?(t_()<=r.DEBUG&&tT("QueryEngine","The SDK decides to create cache indexes for query:",i7(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,i1(t))):np.resolve())}ys(e,t){if(iZ(t))return np.resolve(null);let n=i1(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=i1(t=i4(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=sc(...r);return this.ps.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Ds(t,r);return this.Cs(t,s,i,n.readTime)?this.ys(e,i4(t,null,"F")):this.vs(e,s,t,n)}))})))}ws(e,t,n,i){return iZ(t)||i.isEqual(nn.min())?np.resolve(null):this.ps.getDocuments(e,n).next(s=>{let a=this.Ds(t,s);return this.Cs(t,a,n,i)?np.resolve(null):(t_()<=r.DEBUG&&tT("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),i7(t)),this.vs(e,a,t,nu(i,-1)).next(e=>e))})}Ds(e,t){let n=new rL(st(e));return t.forEach((t,r)=>{i9(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return t_()<=r.DEBUG&&tT("QueryEngine","Using full collection scan to execute query:",i7(t)),this.ps.getDocumentsMatchingQuery(e,t,nh.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=J()?8:nb(U())>0?6:4}}let oY="LocalStore";class oZ{Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new oC(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new rO(tK),this.xs=new sn(e=>iG(e),iK),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}}async function o$(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=sc();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:s}))})})}function o0(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function o1(e,t,n){let r=sc(),i=sc();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=sr;return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(nn.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):tT(oY,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{ks:r,qs:i}})}function o2(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.Pi.getTargetData(n,t).next(i=>i?(r=i,np.resolve(r)):e.Pi.allocateTargetId(n).next(i=>(r=new aC(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.Pi.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.Ms.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(n.targetId,n),e.xs.set(t,n.targetId)),n})}async function o6(e,t,n){let r=e.Ms.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!nE(e))throw e;tT(oY,"Failed to update sequence numbers for target ".concat(t,": ").concat(e))}e.Ms=e.Ms.remove(t),e.xs.delete(r.target)}function o3(e,t,n){let r=nn.min(),i=sc();return e.persistence.runTransaction("Execute query","readwrite",s=>(function(e,t,n){let r=e.xs.get(n);return void 0!==r?np.resolve(e.Ms.get(r)):e.Pi.getTargetData(t,n)})(e,s,i1(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Pi.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Fs.getDocumentsMatchingQuery(s,t,n?r:nn.min(),n?i:sc())).next(n=>(o8(e,se(t),n),{documents:n,Qs:i})))}function o4(e,t){let n=e.Pi,r=e.Ms.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n.At(e,t).next(e=>e?e.target:null))}function o5(e,t){let n=e.Os.get(t)||nn.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.Ns.getAllFromCollectionGroup(r,t,nu(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(o8(e,t,n),n))}function o8(e,t,n){let r=e.Os.get(t)||nn.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Os.set(t,r)}async function o7(e,t,n,r){let i=sc(),s=sr;for(let e of n){let n=t.$s(e.metadata.name);e.document&&(i=i.add(n));let r=t.Us(e);r.setReadTime(t.Ks(e.metadata.readTime)),s=s.insert(n,r)}let a=e.Ns.newChangeBuffer({trackRemovals:!0}),o=await o2(e,i1(iY(tY.fromString("__bundle__/docs/".concat(r)))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>o1(t,a,s).next(e=>(a.apply(t),e)).next(n=>e.Pi.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.Pi.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,n.ks,n.qs)).next(()=>n.ks)))}async function o9(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sc(),r=await o2(e,i1(aL(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=aa(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return e.Ii.saveNamedQuery(i,t);let a=r.withResumeToken(rj.EMPTY_BYTE_STRING,s);return e.Ms=e.Ms.insert(a.targetId,a),e.Pi.updateTargetData(i,a).next(()=>e.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>e.Pi.addMatchingKeys(i,n,r.targetId)).next(()=>e.Ii.saveNamedQuery(i,t))})}let le="firestore_clients";function lt(e,t){return"".concat(le,"_").concat(e,"_").concat(t)}let ln="firestore_mutations";function lr(e,t,n){let r="".concat(ln,"_").concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}let li="firestore_targets";function ls(e,t){return"".concat(li,"_").concat(e,"_").concat(t)}let la="SharedClientState";class lo{static Ws(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new tO(r.error.code,r.error.message)),s?new lo(e,t,r.state,i):(tS(la,"Failed to parse mutation state for ID '".concat(t,"': ").concat(n)),null)}Gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}}class ll{static Ws(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new tO(n.error.code,n.error.message)),i?new ll(e,n.state,r):(tS(la,"Failed to parse target state for ID '".concat(e,"': ").concat(t)),null)}Gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}}class lu{static Ws(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=sh;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=nM(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new lu(e,i):(tS(la,"Failed to parse client data for instance '".concat(e,"': ").concat(t)),null)}constructor(e,t){this.clientId=e,this.activeTargetIds=t}}class lc{static Ws(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new lc(t.clientId,t.onlineState):(tS(la,"Failed to parse online state: ".concat(e)),null)}constructor(e,t){this.clientId=e,this.onlineState=t}}class lh{zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}constructor(){this.activeTargetIds=sh}}class ld{static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.Ts())){if(e===this.Js)continue;let t=this.getItem(lt(this.persistenceKey,e));if(t){let n=lu.Ws(e,t);n&&(this.Zs=this.Zs.insert(n.clientId,n))}}this.ao();let e=this.storage.getItem(this.oo);if(e){let t=this.uo(e);t&&this.co(t)}for(let e of this.Xs)this.Ys(e);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,n){this.ho(e,t,n),this.Po(e)}addLocalQueryTarget(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(ls(this.persistenceKey,e));if(t){let r=ll.Ws(e,t);r&&(n=r.state)}}return t&&this.To.zs(e),this.ao(),n}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ls(this.persistenceKey,e))}updateQueryState(e,t,n){this.Io(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Po(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return tT(la,"READ",e,t),t}setItem(e,t){tT(la,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){tT(la,"REMOVE",e),this.storage.removeItem(e)}Ys(e){if(e.storageArea===this.storage){if(tT(la,"EVENT",e.key,e.newValue),e.key===this.eo)return void tS("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.ro.test(e.key)){if(null==e.newValue){let t=this.Ro(e.key);return this.Vo(t,null)}{let t=this.mo(e.key,e.newValue);if(t)return this.Vo(t.clientId,t)}}else if(this.io.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(this.so.test(e.key)){if(null!==e.newValue){let t=this.yo(e.key,e.newValue);if(t)return this.wo(t)}}else if(e.key===this.oo){if(null!==e.newValue){let t=this.uo(e.newValue);if(t)return this.co(t)}}else if(e.key===this.no){let t=function(e){let t=nk.ce;if(null!=e)try{let n=JSON.parse(e);tN("number"==typeof n,30636,{So:e}),t=n}catch(e){tS(la,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==nk.ce&&this.sequenceNumberHandler(t)}else if(e.key===this._o){let t=this.bo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.Do(e)))}}}else this.Xs.push(e)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,n){let r=new lo(this.currentUser,e,t,n),i=lr(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Gs())}Po(e){let t=lr(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){let t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,n){let r=ls(this.persistenceKey,e),i=new ll(e,t,n);this.setItem(r,i.Gs())}Ao(e){let t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){let t=this.ro.exec(e);return t?t[1]:null}mo(e,t){let n=this.Ro(e);return lu.Ws(n,t)}fo(e,t){let n=this.io.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return lo.Ws(new tw(i),r,t)}yo(e,t){let n=Number(this.so.exec(e)[1]);return ll.Ws(n,t)}uo(e){return lc.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);tT(la,"Ignoring mutation for non-active user ".concat(e.user.uid))}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){let n=t?this.Zs.insert(e,t):this.Zs.remove(e),r=this.lo(this.Zs),i=this.lo(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Fo(s,a).then(()=>{this.Zs=n})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=sh;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}constructor(e,t,n,r,i){var s,a,o;this.window=e,this.Mi=t,this.persistenceKey=n,this.Js=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new rO(tK),this.started=!1,this.Xs=[];let l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=lt(this.persistenceKey,this.Js),this.no=(s=this.persistenceKey,"firestore_sequence_number_".concat(s)),this.Zs=this.Zs.insert(this.Js,new lh),this.ro=new RegExp("^".concat(le,"_").concat(l,"_([^_]*)$")),this.io=new RegExp("^".concat(ln,"_").concat(l,"_(\\d+)(?:_(.*))?$")),this.so=new RegExp("^".concat(li,"_").concat(l,"_(\\d+)$")),this.oo=(a=this.persistenceKey,"firestore_online_state_".concat(a)),this._o=(o=this.persistenceKey,"firestore_bundle_loaded_v2_".concat(o)),this.window.addEventListener("storage",this.Hs)}}class lf{addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new lh,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}constructor(){this.Mo=new lh,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}}class lg{Oo(e){}shutdown(){}}let lm="ConnectivityMonitor";class lp{Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){for(let e of(tT(lm,"Network connectivity changed: AVAILABLE"),this.qo))e(0)}ko(){for(let e of(tT(lm,"Network connectivity changed: UNAVAILABLE"),this.qo))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}}let ly=null;function lv(){return null===ly?ly=0x10000000+Math.round(0x80000000*Math.random()):ly++,"0x"+ly.toString(16)}let lw="RestConnection",lb={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lI{get $o(){return!1}Go(e,t,n,r,i){let s=lv(),a=this.zo(e,t.toUriEncodedString());tT(lw,"Sending RPC '".concat(e,"' ").concat(s,":"),a,n);let o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,r,i);let{host:l}=new URL(a),u=M(l);return this.Jo(e,a,o,n,u).then(t=>(tT(lw,"Received RPC '".concat(e,"' ").concat(s,": "),t),t),t=>{throw tx(lw,"RPC '".concat(e,"' ").concat(s," failed with error: "),t,"url: ",a,"request:",n),t})}Ho(e,t,n,r,i,s){return this.Go(e,t,n,r,i)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+tb,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){let n=lb[e];return"".concat(this.Uo,"/v1/").concat(t,":").concat(n)}terminate(){}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko="projects/".concat(n,"/databases/").concat(r),this.Wo=this.databaseId.database===r1?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}}class l_{Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}}let lE="WebChannelConnection";class lT extends lI{Jo(e,t,n,r,i){let s=lv();return new Promise((i,o)=>{let c=new a;c.setWithCredentials(!0),c.listenOnce(l.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case u.NO_ERROR:let t=c.getResponseJson();tT(lE,"XHR for RPC '".concat(e,"' ").concat(s," received:"),JSON.stringify(t)),i(t);break;case u.TIMEOUT:tT(lE,"RPC '".concat(e,"' ").concat(s," timed out")),o(new tO(tR.DEADLINE_EXCEEDED,"Request time out"));break;case u.HTTP_ERROR:let n=c.getStatus();if(tT(lE,"RPC '".concat(e,"' ").concat(s," failed with status:"),n,"response text:",c.getResponseText()),n>0){let e=c.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(tR).indexOf(t)>=0?t:tR.UNKNOWN}(t.status);o(new tO(e,t.message))}else o(new tO(tR.UNKNOWN,"Server responded with status "+c.getStatus()))}else o(new tO(tR.UNAVAILABLE,"Connection failed."));break;default:tA(9055,{l_:e,streamId:s,h_:c.getLastErrorCode(),P_:c.getLastError()})}}finally{tT(lE,"RPC '".concat(e,"' ").concat(s," completed."))}});let h=JSON.stringify(r);tT(lE,"RPC '".concat(e,"' ").concat(s," sending request:"),r),c.send(t,"POST",h,n,15)})}T_(e,t,n){let r=lv(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=f(),a=d(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,n),l.encodeInitMessageHeaders=!0;let m=i.join("");tT(lE,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(m),l);let p=s.createWebChannel(m,l);this.I_(p);let y=!1,v=!1,w=new l_({Yo:t=>{v?tT(lE,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(y||(tT(lE,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),p.open(),y=!0),tT(lE,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),p.send(t))},Zo:()=>p.close()}),b=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return b(p,o.EventType.OPEN,()=>{v||(tT(lE,"RPC '".concat(e,"' stream ").concat(r," transport opened.")),w.o_())}),b(p,o.EventType.CLOSE,()=>{v||(v=!0,tT(lE,"RPC '".concat(e,"' stream ").concat(r," transport closed")),w.a_(),this.E_(p))}),b(p,o.EventType.ERROR,t=>{v||(v=!0,tx(lE,"RPC '".concat(e,"' stream ").concat(r," transport errored. Name:"),t.name,"Message:",t.message),w.a_(new tO(tR.UNAVAILABLE,"The operation could not be completed")))}),b(p,o.EventType.MESSAGE,t=>{if(!v){var n;let i=t.data[0];tN(!!i,16349);let s=(null==i?void 0:i.error)||(null==(n=i[0])?void 0:n.error);if(s){tT(lE,"RPC '".concat(e,"' stream ").concat(r," received error:"),s);let t=s.status,n=function(e){let t=g[e];if(void 0!==t)return sQ(t)}(t),i=s.message;void 0===n&&(n=tR.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),v=!0,w.a_(new tO(n,i)),p.close()}else tT(lE,"RPC '".concat(e,"' stream ").concat(r," received:"),i),w.u_(i)}}),b(a,h.STAT_EVENT,t=>{t.stat===c.PROXY?tT(lE,"RPC '".concat(e,"' stream ").concat(r," detected buffering proxy")):t.stat===c.NOPROXY&&tT(lE,"RPC '".concat(e,"' stream ").concat(r," detected no buffering proxy"))}),setTimeout(()=>{w.__()},0),w}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}}function lS(){return"undefined"!=typeof window?window:null}function lx(){return"undefined"!=typeof document?document:null}function lC(e){return new an(e,!0)}class lA{reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&tT("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.V_," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}constructor(e,t,n=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}}let lD="PersistentStream";class lN{x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===tR.RESOURCE_EXHAUSTED?(tS(t.toString()),tS("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===tR.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,r]=e;this.D_===t&&this.G_(n,r)},t=>{e(()=>{let e=new tO(tR.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return tT(lD,"close with error: ".concat(e)),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(tT(lD,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}constructor(e,t,n,r,i,s,a,o){this.Mi=e,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new lA(e,t)}}class lk extends lN{j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:tA(39313,{state:r}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(tN(void 0===i||"string"==typeof i,58123),rj.fromBase64String(i||"")):(tN(void 0===i||i instanceof w.Buffer||i instanceof Uint8Array,16193),rj.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new s3(s,a,o,l&&new tO(void 0===l.code?tR.UNKNOWN:sQ(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=ah(e,r.document.name),s=aa(r.document.updateTime),a=r.document.createTime?aa(r.document.createTime):nn.min(),o=new ib({mapValue:{fields:r.document.fields}}),l=iI.newFoundDocument(i,s,a,o);n=new s2(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=ah(e,r.document),s=r.readTime?aa(r.readTime):nn.min(),a=iI.newNoDocument(i,s);n=new s2([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=ah(e,r.document);n=new s2([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return tA(11601,{Rt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new sG(r,i);n=new s6(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return nn.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?nn.min():t.readTime?aa(t.readTime):nn.min()}(e);return this.listener.H_(t,n)}Y_(e){let t={};t.database=ag(this.serializer),t.addTarget=function(e,t){let n,r=t.target;if((n=iQ(r)?{documents:ab(e,r)}:{query:aI(e,r).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=as(e,t.resumeToken);let r=ar(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(nn.min())>0){n.readTime=ai(e,t.snapshotVersion.toTimestamp());let r=ar(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let n=function(e,t){let n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return tA(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){let t={};t.database=ag(this.serializer),t.removeTarget=e,this.q_(t)}constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}}class lR extends lN{get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return tN(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,tN(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,n;tN(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(tN(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?aa(e.updateTime):aa(n)).isEqual(nn.min())&&(t=aa(n)),new sx(t,e.transformResults||[])})):[]),i=aa(e.commitTime);return this.listener.na(i,r)}ra(){let e={};e.database=ag(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>av(this.serializer,e))};this.q_(t)}constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}}class lO{}class lM extends lO{sa(){if(this.ia)throw new tO(tR.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[s,a]=i;return this.connection.Go(e,al(t,n),r,s,a)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===tR.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tO(tR.UNKNOWN,e.toString())})}Ho(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(s=>{let[a,o]=s;return this.connection.Ho(e,al(t,n),r,a,o,i)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===tR.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tO(tR.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}}class lP{ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.aa?(tS(t),this.aa=!1):tT("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}}let lL="RemoteStore";class lF{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{lQ(this)&&(tT(lL,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await lB(e),e.Ra.set("Unknown"),e.Ea.delete(4),await lV(e)}(this))})}),this.Ra=new lP(n,r)}}async function lV(e){if(lQ(e))for(let t of e.da)await t(!0)}async function lB(e){for(let t of e.da)await t(!1)}function lU(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),lK(e)?lG(e):l7(e).O_()&&lj(e,t))}function lq(e,t){let n=l7(e);e.Ia.delete(t),n.O_()&&lz(e,t),0===e.Ia.size&&(n.O_()?n.L_():lQ(e)&&e.Ra.set("Unknown"))}function lj(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(nn.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}l7(e).Y_(t)}function lz(e,t){e.Va.Ue(t),l7(e).Z_(t)}function lG(e){e.Va=new s5({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),l7(e).start(),e.Ra.ua()}function lK(e){return lQ(e)&&!l7(e).x_()&&e.Ia.size>0}function lQ(e){return 0===e.Ea.size}async function lH(e){e.Ra.set("Online")}async function lW(e){e.Ia.forEach((t,n)=>{lj(e,t)})}async function lJ(e,t){e.Va=void 0,lK(e)?(e.Ra.ha(t),lG(e)):e.Ra.set("Unknown")}async function lX(e,t,n){if(e.Ra.set("Online"),t instanceof s3&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(n){tT(lL,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await lY(e,n)}else if(t instanceof s2?e.Va.Ze(t):t instanceof s6?e.Va.st(t):e.Va.tt(t),!n.isEqual(nn.min()))try{let t=await o0(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.Va.Tt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(rj.EMPTY_BYTE_STRING,r.snapshotVersion)),lz(e,t);let i=new aC(r.target,t,n,r.sequenceNumber);lj(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){tT(lL,"Failed to raise snapshot:",t),await lY(e,t)}}async function lY(e,t,n){if(!nE(t))throw t;e.Ea.add(1),await lB(e),e.Ra.set("Offline"),n||(n=()=>o0(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{tT(lL,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await lV(e)})}function lZ(e,t){return t().catch(n=>lY(e,n,t))}async function l$(e){var t;let n=l9(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;lQ(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,function(e,t){e.Ta.push(t);let n=l9(e);n.O_()&&n.X_&&n.ea(t.mutations)}(e,t)}catch(t){await lY(e,t)}l0(e)&&l1(e)}function l0(e){return lQ(e)&&!l9(e).x_()&&e.Ta.length>0}function l1(e){l9(e).start()}async function l2(e){l9(e).ra()}async function l6(e){let t=l9(e);for(let n of e.Ta)t.ea(n.mutations)}async function l3(e,t,n){let r=e.Ta.shift(),i=sq.from(r,t,n);await lZ(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await l$(e)}async function l4(e,t){t&&l9(e).X_&&await async function(e,t){var n;if(sK(n=t.code)&&n!==tR.ABORTED){let n=e.Ta.shift();l9(e).B_(),await lZ(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await l$(e)}}(e,t),l0(e)&&l1(e)}async function l5(e,t){e.asyncQueue.verifyOperationInProgress(),tT(lL,"RemoteStore received new credentials");let n=lQ(e);e.Ea.add(3),await lB(e),n&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await lV(e)}async function l8(e,t){t?(e.Ea.delete(2),await lV(e)):t||(e.Ea.add(2),await lB(e),e.Ra.set("Unknown"))}function l7(e){var t,n,r;return e.ma||(t=e.datastore,n=e.asyncQueue,r={Xo:lH.bind(null,e),t_:lW.bind(null,e),r_:lJ.bind(null,e),H_:lX.bind(null,e)},t.sa(),e.ma=new lk(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.ma.B_(),lK(e)?lG(e):e.Ra.set("Unknown")):(await e.ma.stop(),e.Va=void 0)})),e.ma}function l9(e){var t,n,r;return e.fa||(t=e.datastore,n=e.asyncQueue,r={Xo:()=>Promise.resolve(),t_:l2.bind(null,e),r_:l4.bind(null,e),ta:l6.bind(null,e),na:l3.bind(null,e)},t.sa(),e.fa=new lR(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.fa.B_(),await l$(e)):(await e.fa.stop(),e.Ta.length>0&&(tT(lL,"Stopping write stream with ".concat(e.Ta.length," pending writes")),e.Ta=[]))})),e.fa}class ue{get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new ue(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new tO(tR.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new tM,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}}function ut(e,t){if(tS("AsyncQueue","".concat(t,": ").concat(e)),nE(e))return new tO(tR.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class un{static emptySet(e){return new un(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof un)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new un;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}constructor(e){this.comparator=e?(t,n)=>e(t,n)||t0.comparator(t.key,n.key):(e,t)=>t0.comparator(e.key,t.key),this.keyedMap=ss(),this.sortedSet=new rO(this.comparator)}}class ur{track(e){let t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):tA(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}constructor(){this.ga=new rO(t0.comparator)}}class ui{static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new ui(e,t,un.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&i5(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}}class us{ba(){return this.Sa.some(e=>e.Da())}constructor(){this.wa=void 0,this.Sa=[]}}class ua{terminate(){!function(e,t){let n=e.queries;e.queries=uo(),n.forEach((e,n)=>{for(let e of n.Sa)e.onError(t)})}(this,new tO(tR.ABORTED,"Firestore shutting down"))}constructor(){this.queries=uo(),this.onlineState="Unknown",this.Ca=new Set}}function uo(){return new sn(e=>i8(e),i5)}async function ul(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.ba()&&t.Da()&&(n=2):(i=new us,n=+!t.Da());try{switch(n){case 0:i.wa=await e.onListen(r,!0);break;case 1:i.wa=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=ut(n,"Initialization of query '".concat(i7(t.query),"' failed"));return void t.onError(e)}e.queries.set(r,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&ud(e)}async function uu(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?r=+!t.Da():!i.ba()&&t.Da()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function uc(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.Sa)e.Fa(r)&&(n=!0);i.wa=r}}n&&ud(e)}function uh(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.Sa)e.onError(n);e.queries.delete(t)}function ud(e){e.Ca.forEach(e=>{e.next()})}(y=p||(p={})).Ma="default",y.Cache="cache";class uf{Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new ui(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.qa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=ui.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==p.Cache}constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}}class ug{$a(){return"metadata"in this.Qa}constructor(e,t){this.Qa=e,this.byteLength=t}}class um{$s(e){return ah(this.serializer,e)}Us(e){return e.metadata.exists?ay(this.serializer,e.document,!1):iI.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return aa(e)}constructor(e){this.serializer=e}}class up{get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;let n=tY.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,n=new um(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.$s(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||sc()).add(e);t.set(n,r)}}return t}async ja(e){let t=await o7(e,new um(this.serializer),this.Wa,this.Ua.id),n=this.za(this.documents);for(let t of this.Ka)await o9(e,t,n.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=uy(e)}}function uy(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class uv{constructor(e){this.key=e}}class uw{constructor(e){this.key=e}}class ub{get nu(){return this.Ya}ru(e,t){let n=t?t.iu:new ur,r=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),c=i9(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),f=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(n.track({type:3,doc:c}),f=!0):this.su(u,c)||(n.track({type:2,doc:c}),f=!0,(o&&this.eu(c,o)>0||l&&0>this.eu(c,l))&&(a=!0)):!u&&c?(n.track({type:0,doc:c}),f=!0):u&&!c&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(c?(s=s.add(c),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return tA(20277,{Rt:e})}};return n(e)-n(t)})(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),r=null!=r&&r;let a=t&&!r?this._u():[],o=0===this.Xa.size&&this.current&&!r?1:0,l=o!==this.Za;return(this.Za=o,0!==s.length||l)?{snapshot:new ui(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ur,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=sc(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});let t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new uw(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new uv(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=sc();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ui.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=sc(),this.mutatedKeys=sc(),this.eu=st(e),this.tu=new un(this.eu)}}let uI="SyncEngine";class u_{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class uE{constructor(e){this.key=e,this.hu=!1}}class uT{get isPrimaryClient(){return!0===this.gu}constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new sn(e=>i8(e),i5),this.Iu=new Map,this.Eu=new Set,this.du=new rO(t0.comparator),this.Au=new Map,this.Ru=new ok,this.Vu={},this.mu=new Map,this.fu=oc.cr(),this.onlineState="Unknown",this.gu=void 0}}async function uS(e,t){let n,r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=u2(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.lu()):n=await uC(i,t,r,!0),n}async function ux(e,t){let n=u2(e);await uC(n,t,!0,!1)}async function uC(e,t,n,r){let i,s=await o2(e.localStore,i1(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,n);return r&&(i=await uA(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&lU(e.remoteStore,s),i}async function uA(e,t,n,r,i){e.pu=(t,n,r)=>(async function(e,t,n,r){let i=t.view.ru(n);i.Cs&&(i=await o3(e.localStore,t.query,!1).then(e=>{let{documents:n}=e;return t.view.ru(n,i)}));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return uj(e,t.targetId,o.au),o.snapshot})(e,t,n,r);let s=await o3(e.localStore,t,!0),a=new ub(t,s.Qs),o=a.ru(s.documents),l=s1.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);uj(e,n,u.au);let c=new u_(t,n,a);return e.Tu.set(t,c),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),u.snapshot}async function uD(e,t,n){let r=e.Tu.get(t),i=e.Iu.get(r.targetId);if(i.length>1)return e.Iu.set(r.targetId,i.filter(e=>!i5(e,t))),void e.Tu.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await o6(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&lq(e.remoteStore,r.targetId),uU(e,r.targetId)}).catch(nm)):(uU(e,r.targetId),await o6(e.localStore,r.targetId,!0))}async function uN(e,t){let n=e.Tu.get(t),r=e.Iu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),lq(e.remoteStore,n.targetId))}async function uk(e,t,n){let r=u6(e);try{var i;let e,s=await function(e,t){let n,r,i=nt.now(),s=t.reduce((e,t)=>e.add(t.key),sc());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let o=sr,l=sc();return e.Ns.getEntries(a,s).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,o)).next(r=>{n=r;let s=[];for(let e of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=sp(r.transform,e||null);null!=i&&(null===n&&(n=ib.empty()),n.set(r.field,i))}return n||null}(e,n.get(e.key).overlayedDocument);null!=t&&s.push(new sM(e.key,t,function e(t){let n=[];return rN(t.fields,(t,r)=>{let i=new t$([t]);if(id(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new rB(n)}(t.value.mapValue),sC.exists(!0)))}return e.mutationQueue.addMutationBatch(a,i,s,t)}).next(t=>{r=t;let i=t.applyToLocalDocumentSet(n,l);return e.documentOverlayCache.saveOverlays(a,t.batchId,i)})}).then(()=>({batchId:r.batchId,changes:sa(n)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),i=s.batchId,(e=r.Vu[r.currentUser.toKey()])||(e=new rO(tK)),e=e.insert(i,n),r.Vu[r.currentUser.toKey()]=e,await uG(r,s.changes),await l$(r.remoteStore)}catch(t){let e=ut(t,"Failed to persist write");n.reject(e)}}async function uR(e,t){try{let n=await function(e,t){let n=t.snapshotVersion,r=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let s=e.Ns.newChangeBuffer({trackRemovals:!0});r=e.Ms;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=r.get(o);if(!u)return;a.push(e.Pi.removeMatchingKeys(i,s.removedDocuments,o).next(()=>e.Pi.addMatchingKeys(i,s.addedDocuments,o)));let c=u.withSequenceNumber(i.currentSequenceNumber);null!==t.targetMismatches.get(o)?c=c.withResumeToken(rj.EMPTY_BYTE_STRING,nn.min()).withLastLimboFreeSnapshotVersion(nn.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,n)),r=r.insert(o,c),l=c,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(e.Pi.updateTargetData(i,c))});let o=sr,l=sc();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(i,n))}),a.push(o1(i,s,t.documentUpdates).next(e=>{o=e.ks,l=e.qs})),!n.isEqual(nn.min())){let t=e.Pi.getLastRemoteSnapshotVersion(i).next(t=>e.Pi.setTargetsMetadata(i,i.currentSequenceNumber,n));a.push(t)}return np.waitFor(a).next(()=>s.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,o,l)).next(()=>o)}).then(t=>(e.Ms=r,t))}(e.localStore,t);t.targetChanges.forEach((t,n)=>{let r=e.Au.get(n);r&&(tN(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?tN(r.hu,14607):t.removedDocuments.size>0&&(tN(r.hu,42227),r.hu=!1))}),await uG(e,n,t)}catch(e){await nm(e)}}function uO(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.Tu.forEach((e,n)=>{let r=n.view.va(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.Sa)e.va(t)&&(n=!0)}),n&&ud(r),i.length&&e.Pu.H_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function uM(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Au.get(t),i=r&&r.key;if(i){let n=new rO(t0.comparator);n=n.insert(i,iI.newNoDocument(i,nn.min()));let r=sc().add(i),s=new s0(nn.min(),new Map,new rO(tK),n,r);await uR(e,s),e.du=e.du.remove(i),e.Au.delete(t),uz(e)}else await o6(e.localStore,t,!1).then(()=>uU(e,t,n)).catch(nm)}async function uP(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(e,t,n,r){let i=n.batch,s=i.keys(),a=np.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);tN(null!==s,48541),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))})(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=sc();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))}));uB(e,r,null),uV(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await uG(e,i)}catch(e){await nm(e)}}async function uL(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(tN(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));uB(e,t,n),uV(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await uG(e,i)}catch(e){await nm(e)}}async function uF(e,t){var n;lQ(e.remoteStore)||tT(uI,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=await (n=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>n.mutationQueue.getHighestUnacknowledgedBatchId(e));if(-1===r)return void t.resolve();let i=e.mu.get(r)||[];i.push(t),e.mu.set(r,i)}catch(n){let e=ut(n,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function uV(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function uB(e,t,n){let r=e.Vu[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Vu[e.currentUser.toKey()]=r}}function uU(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||uq(e,t)})}function uq(e,t){e.Eu.delete(t.path.canonicalString());let n=e.du.get(t);null!==n&&(lq(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),uz(e))}function uj(e,t,n){for(let r of n)r instanceof uv?(e.Ru.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(tT(uI,"New document in limbo: "+n),e.Eu.add(r),uz(e))}(e,r)):r instanceof uw?(tT(uI,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||uq(e,r.key)):tA(19791,{wu:r})}function uz(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let n=new t0(tY.fromString(t)),r=e.fu.next();e.Au.set(r,new uE(n)),e.du=e.du.insert(n,r),lU(e.remoteStore,new aC(i1(iY(n.path)),r,"TargetPurposeLimboResolution",nk.ce))}}async function uG(e,t,n){let r=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,n).then(t=>{if((t||n)&&e.isPrimaryClient){var s;let r=t?!t.fromCache:null==n||null==(s=n.targetChanges.get(o.targetId))?void 0:s.current;e.sharedClientState.updateQueryState(o.targetId,r?"current":"not-current")}if(t){r.push(t);let e=oW.As(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.H_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>np.forEach(t,t=>np.forEach(t.Es,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>np.forEach(t.ds,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!nE(e))throw e;tT(oY,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ms.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.Ms=e.Ms.insert(t,i)}}}(e.localStore,i))}async function uK(e,t){if(!e.currentUser.isEqual(t)){tT(uI,"User change. New user:",t.toKey());let n=await o$(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new tO(tR.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await uG(e,n.Ls)}}function uQ(e,t){let n=e.Au.get(t);if(n&&n.hu)return sc().add(n.key);{let n=sc(),r=e.Iu.get(t);if(!r)return n;for(let t of r){let r=e.Tu.get(t);n=n.unionWith(r.view.nu)}return n}}async function uH(e,t){let n=await o3(e.localStore,t.query,!0),r=t.view.cu(n);return e.isPrimaryClient&&uj(e,t.targetId,r.au),r}async function uW(e,t){return o5(e.localStore,t).then(t=>uG(e,t))}async function uJ(e,t,n,r){var i;let s=await function(e,t){let n=e.mutationQueue;return e.persistence.runTransaction("Lookup mutation documents","readonly",r=>n.er(r,t).next(t=>t?e.localDocuments.getDocuments(r,t):np.resolve(null)))}(e.localStore,t);null!==s?("pending"===n?await l$(e.remoteStore):"acknowledged"===n||"rejected"===n?(uB(e,t,r||null),uV(e,t),i=e.localStore,i.mutationQueue.ir(t)):tA(6720,"Unknown batchState",{Su:n}),await uG(e,s)):tT(uI,"Cannot apply mutation batch with id: "+t)}async function uX(e,t){if(u2(e),u6(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await uY(e,t.toArray());for(let t of(e.gu=!0,await l8(e.remoteStore,!0),n))lU(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],n=Promise.resolve();e.Iu.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(uU(e,i),o6(e.localStore,i,!0))),lq(e.remoteStore,i)}),await n,await uY(e,t),e.Au.forEach((t,n)=>{lq(e.remoteStore,n)}),e.Ru.Jr(),e.Au=new Map,e.du=new rO(t0.comparator),e.gu=!1,await l8(e.remoteStore,!1)}}async function uY(e,t,n){let r=[],i=[];for(let n of t){let t,s=e.Iu.get(n);if(s&&0!==s.length)for(let n of(t=await o2(e.localStore,i1(s[0])),s)){let t=e.Tu.get(n),r=await uH(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await o4(e.localStore,n);t=await o2(e.localStore,r),await uA(e,uZ(r),n,!1,t.resumeToken)}r.push(t)}return e.Pu.H_(i),r}function uZ(e){var t,n,r,i,s;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,s=e.limit,new iX(t,n,r,i,s,"F",e.startAt,e.endAt)}function u$(e){return e.localStore.persistence.Ts()}async function u0(e,t,n,r){if(e.gu)return void tT(uI,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await o5(e.localStore,se(i[0])),s=s0.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,rj.EMPTY_BYTE_STRING);await uG(e,r,s);break}case"rejected":await o6(e.localStore,t,!0),uU(e,t,r);break;default:tA(64155,n)}}async function u1(e,t,n){let r=u2(e);if(r.gu){for(let e of t){if(r.Iu.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){tT(uI,"Adding an already active target "+e);continue}let t=await o4(r.localStore,e),n=await o2(r.localStore,t);await uA(r,uZ(t),n.targetId,!1,n.resumeToken),lU(r.remoteStore,n)}for(let e of n)r.Iu.has(e)&&await o6(r.localStore,e,!1).then(()=>{lq(r.remoteStore,e),uU(r,e)}).catch(nm)}}function u2(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=uR.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=uQ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=uM.bind(null,e),e.Pu.H_=uc.bind(null,e.eventManager),e.Pu.yu=uh.bind(null,e.eventManager),e}function u6(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=uP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=uL.bind(null,e),e}class u3{async initialize(e){this.serializer=lC(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,n;return t=this.persistence,n=new oX,new oZ(t,n,e.initialUser,this.serializer)}Cu(e){return new oF(oB.mi,this.serializer)}Du(e){return new lf}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}constructor(){this.kind="memory",this.synchronizeTabs=!1}}u3.provider={build:()=>new u3};class u4 extends u3{Fu(e,t){return tN(this.persistence.referenceDelegate instanceof oU,46915),new op(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?oi.withCacheSize(this.cacheSizeBytes):oi.DEFAULT;return new oF(e=>oU.mi(e,t),this.serializer)}constructor(e){super(),this.cacheSizeBytes=e}}class u5 extends u3{async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await u6(this.xu.syncEngine),await l$(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,n;return t=this.persistence,n=new oX,new oZ(t,n,e.initialUser,this.serializer)}Fu(e,t){return new op(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let n=new nN(t,this.persistence);return new nD(e.asyncQueue,n)}Cu(e){let t=oH(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?oi.withCacheSize(this.cacheSizeBytes):oi.DEFAULT;return new oQ(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,lS(),lx(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new lf}constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}}class u8 extends u5{async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof ld&&(this.sharedClientState.syncEngine={Co:uJ.bind(null,t),vo:u0.bind(null,t),Fo:u1.bind(null,t),Ts:u$.bind(null,t),Do:uW.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async e=>{await uX(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=lS();if(!ld.v(t))throw new tO(tR.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=oH(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ld(t,e.asyncQueue,n,e.clientId,e.initialUser)}constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}}class u7{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>uO(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=uK.bind(null,this.syncEngine),await l8(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new ua}createDatastore(e){var t;let n=lC(e.databaseInfo.databaseId),r=new lT(e.databaseInfo);return t=e.authCredentials,new lM(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new lF(t,n,e.asyncQueue,e=>uO(this.syncEngine,e,0),lp.v()?new lp:new lg)}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){let o=new uT(e,t,n,r,i,s);return a&&(o.gu=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){tT(lL,"RemoteStore shutting down."),e.Ea.add(5),await lB(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()}}function u9(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}u7.provider={build:()=>new u7};class ce{next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):tS("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}constructor(e){this.observer=e,this.muted=!1}}class ct{close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.qu();if(null===e)return null;let t=this.Lu.decode(e),n=Number(t);return isNaN(n)&&this.Qu("length string (".concat(t,") is not valid number")),new ug(JSON.parse(await this.$u(n)),e.length+n)}Uu(){return this.buffer.findIndex(e=>123===e)}async qu(){for(;0>this.Uu()&&!await this.Ku(););if(0===this.buffer.length)return null;let e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),Error("Invalid bundle format: ".concat(e))}async Ku(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new tM,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.$a()?this.metadata.resolve(e.Qa.metadata):this.metadata.reject(Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.Qa))))},e=>this.metadata.reject(e))}}class cn{getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;let e=this.qu();return new ug(JSON.parse(this.$u(e)),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new tO(tR.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let n=this.bu();if(!n||!n.$a())throw Error("The first element of the bundle is not a metadata object, it is\n         ".concat(JSON.stringify(null==n?void 0:n.Qa)));this.metadata=n;do null!==(n=this.bu())&&this.elements.push(n);while(null!==n)}}class cr{async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new tO(tR.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let n={documents:t.map(t=>ac(e.serializer,t))},r=await e.Ho("BatchGetDocuments",e.serializer.databaseId,tY.emptyPath(),n,t.length),i=new Map;r.forEach(t=>{var n;let r=(n=e.serializer,"found"in t?function(e,t){tN(!!t.found,43571),t.found.name,t.found.updateTime;let n=ah(e,t.found.name),r=aa(t.found.updateTime),i=t.found.createTime?aa(t.found.createTime):nn.min(),s=new ib({mapValue:{fields:t.found.fields}});return iI.newFoundDocument(n,r,i,s)}(n,t):"missing"in t?function(e,t){tN(!!t.missing,3894),tN(!!t.readTime,22933);let n=ah(e,t.missing),r=aa(t.readTime);return iI.newNoDocument(n,r)}(n,t):tA(7234,{result:t}));i.set(r.key.toString(),r)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());tN(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new sV(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=t0.fromPath(t);this.mutations.push(new sB(n,this.precondition(n)))}),await async function(e,t){let n={writes:t.map(t=>av(e.serializer,t))};await e.Go("Commit",e.serializer.databaseId,tY.emptyPath(),n)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw tA(50498,{Gu:e.constructor.name});t=nn.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new tO(tR.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(nn.min())?sC.exists(!1):sC.updateTime(t):sC.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(nn.min()))throw new tO(tR.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return sC.updateTime(t)}return sC.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}}class ci{ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{let e=new cr(this.datastore),t=this.Hu(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Yu(e)}))}).catch(e=>{this.Yu(e)})})}Hu(e){try{let t=this.updateFunction(e);return!nR(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if("FirebaseError"===(null==e?void 0:e.name)){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!sK(t)}return!1}constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.zu=n.maxAttempts,this.M_=new lA(this.asyncQueue,"transaction_retry")}}let cs="FirestoreClient";class ca{get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new tM;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=ut(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=tw.UNAUTHENTICATED,this.clientId=tG.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{tT(cs,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(tT(cs,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}}async function co(e,t){e.asyncQueue.verifyOperationInProgress(),tT(cs,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await o$(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function cl(e,t){e.asyncQueue.verifyOperationInProgress();let n=await cu(e);tT(cs,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>l5(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>l5(t.remoteStore,n)),e._onlineComponents=t}async function cu(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){tT(cs,"Using user provided OfflineComponentProvider");try{await co(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===tR.FAILED_PRECONDITION||t.code===tR.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;tx("Error using user provided cache. Falling back to memory cache: "+t),await co(e,new u3)}}else tT(cs,"Using default OfflineComponentProvider"),await co(e,new u4(void 0));return e._offlineComponents}async function cc(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(tT(cs,"Using user provided OnlineComponentProvider"),await cl(e,e._uninitializedComponentsProvider._online)):(tT(cs,"Using default OnlineComponentProvider"),await cl(e,new u7))),e._onlineComponents}function ch(e){return cu(e).then(e=>e.persistence)}function cd(e){return cu(e).then(e=>e.localStore)}function cf(e){return cc(e).then(e=>e.remoteStore)}function cg(e){return cc(e).then(e=>e.syncEngine)}function cm(e){return cc(e).then(e=>e.datastore)}async function cp(e){let t=await cc(e),n=t.eventManager;return n.onListen=uS.bind(null,t.syncEngine),n.onUnlisten=uD.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=ux.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=uN.bind(null,t.syncEngine),n}function cy(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new tM;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new ce({next:o=>{s.Nu(),t.enqueueAndForget(()=>uu(e,a));let l=o.docs.has(n);!l&&o.fromCache?i.reject(new tO(tR.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&r&&"server"===r.source?i.reject(new tO(tR.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new uf(iY(n.path),s,{includeMetadataChanges:!0,qa:!0});return ul(e,a)})(await cp(e),e.asyncQueue,t,n,r)),r.promise}function cv(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new tM;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new ce({next:n=>{s.Nu(),t.enqueueAndForget(()=>uu(e,a)),n.fromCache&&"server"===r.source?i.reject(new tO(tR.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),a=new uf(n,s,{includeMetadataChanges:!0,qa:!0});return ul(e,a)})(await cp(e),e.asyncQueue,t,n,r)),r.promise}function cw(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let cb=new Map,cI="firestore.googleapis.com";class c_{isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new tO(tR.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=cI,this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new tO(tR.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}t2("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=cw(null!=(n=e.experimentalLongPollingOptions)?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new tO(tR.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new tO(tR.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new tO(tR.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}}class cE{get app(){if(!this._app)throw new tO(tR.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new tO(tR.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new c_(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new tL;switch(e.type){case"firstParty":return new tU(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new tO(tR.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=cb.get(e);t&&(tT("ComponentProvider","Removing Datastore"),cb.delete(e),t.terminate())}(this),Promise.resolve()}constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new c_({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}}function cT(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=t8(e,cE);let i=M(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o="".concat(t,":").concat(n);i&&(P("https://".concat(o)),B("Firestore",!0)),s.host!==cI&&s.host!==o&&tx("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:r};if(!er(l,a)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=tw.MOCK_USER;else{var u;t=L(r.mockUserToken,null==(u=e._app)?void 0:u.options.projectId);let i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new tO(tR.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new tw(i)}e._authCredentials=new tF(new tP(t,n))}}class cS{withConverter(e){return new cS(this.firestore,e,this._query)}constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}}class cx{get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new cC(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new cx(this.firestore,e,this._key)}toJSON(){return{type:cx._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(ne(t,cx._jsonSchema))return new cx(e,n||null,new t0(tY.fromString(t.referencePath)))}constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}}cx._jsonSchemaVersion="firestore/documentReference/1.0",cx._jsonSchema={type:t9("string",cx._jsonSchemaVersion),referencePath:t9("string")};class cC extends cS{get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new cx(this.firestore,null,new t0(e))}withConverter(e){return new cC(this.firestore,e,this._path)}constructor(e,t,n){super(e,t,iY(n)),this._path=n,this.type="collection"}}function cA(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=eh(e),t1("collection","path",t),e instanceof cE){let n=tY.fromString(t,...r);return t3(n),new cC(e,null,n)}{if(!(e instanceof cx||e instanceof cC))throw new tO(tR.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(tY.fromString(t,...r));return t3(n),new cC(e.firestore,null,n)}}function cD(e,t){if(e=t8(e,cE),t1("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new tO(tR.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new cS(e,null,new iX(tY.emptyPath(),t))}function cN(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=eh(e),1==arguments.length&&(t=tG.newId()),t1("doc","path",t),e instanceof cE){let n=tY.fromString(t,...r);return t6(n),new cx(e,null,new t0(n))}{if(!(e instanceof cx||e instanceof cC))throw new tO(tR.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(tY.fromString(t,...r));return t6(n),new cx(e.firestore,e instanceof cC?e.converter:null,new t0(n))}}function ck(e,t){return e=eh(e),t=eh(t),(e instanceof cx||e instanceof cC)&&(t instanceof cx||t instanceof cC)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function cR(e,t){return e=eh(e),t=eh(t),e instanceof cS&&t instanceof cS&&e.firestore===t.firestore&&i5(e._query,t._query)&&e.converter===t.converter}let cO="AsyncQueue";class cM{get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=lx();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new tM;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!nE(e))throw e;tT(cO,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,tS("INTERNAL UNHANDLED ERROR: ",cP(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let r=ue.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&tA(47125,{Pc:cP(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new lA(this,"async_queue_retry"),this._c=()=>{let e=lx();e&&tT(cO,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;let t=lx();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}}function cP(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function cL(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class cF{onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}constructor(){this._progressObserver={},this._taskCompletionResolver=new tM,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}}let cV=-1;class cB extends cE{async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new cM(e),this._firestoreClient=void 0,await e}}constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new cM,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}}function cU(e,t,n){n||(n=r1);let r=eW(e,"firestore");if(r.isInitialized(n)){let e=r.getImmediate({identifier:n});if(er(r.getOptions(n),t))return e;throw new tO(tR.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new tO(tR.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new tO(tR.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&M(t.host)&&P(t.host),r.initialize({options:t,instanceIdentifier:n})}function cq(e,t){let n="object"==typeof e?e:e8(),r="string"==typeof e?e:t||r1,i=eW(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let e=N("firestore");e&&cT(i,...e)}return i}function cj(e){if(e._terminated)throw new tO(tR.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||cz(e),e._firestoreClient}function cz(e){var t,n,r,i,s;let a=e._freezeSettings(),o=(i=e._databaseId,s=(null==(t=e._app)?void 0:t.options.appId)||"",new r0(i,s,e._persistenceKey,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,cw(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator));e._componentsProvider||(null==(n=a.localCache)?void 0:n._offlineComponentProvider)&&(null==(r=a.localCache)?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),e._firestoreClient=new ca(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&function(e){let t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}function cG(e,t){tx("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=e._freezeSettings();return cQ(e,u7.provider,{build:e=>new u5(e,n.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()}async function cK(e){tx("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();cQ(e,u7.provider,{build:e=>new u8(e,t.cacheSizeBytes)})}function cQ(e,t,n){if((e=t8(e,cB))._firestoreClient||e._terminated)throw new tO(tR.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new tO(tR.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},cz(e)}function cH(e){if(e._initialized&&!e._terminated)throw new tO(tR.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new tM;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!nw.v())return Promise.resolve();await nw.delete(e+oK)}(oH(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function cW(e){var t=cj(e=t8(e,cB));let n=new tM;return t.asyncQueue.enqueueAndForget(async()=>uF(await cg(t),n)),n.promise}function cJ(e){var t;return(t=cj(e=t8(e,cB))).asyncQueue.enqueue(async()=>{let e=await ch(t),n=await cf(t);return e.setNetworkEnabled(!0),n.Ea.delete(0),lV(n)})}function cX(e){var t;return(t=cj(e=t8(e,cB))).asyncQueue.enqueue(async()=>{let e=await ch(t),n=await cf(t);return e.setNetworkEnabled(!1),async function(e){e.Ea.add(0),await lB(e),e.Ra.set("Offline")}(n)})}function cY(e){return eJ(e.app,"firestore",e._databaseId.database),e._delete()}function cZ(e,t){let n=cj(e=t8(e,cB)),r=new cF;return function(e,t,n,r){var i;let s=(i=lC(t),new ct(function(e,t){if(e instanceof Uint8Array)return u9(e,void 0);if(e instanceof ArrayBuffer)return u9(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?sW().encode(n):n),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,n){try{var r;let i=await t.getMetadata();if(await function(e,t){let n=aa(t.createTime);return e.persistence.runTransaction("hasNewerBundle","readonly",n=>e.Ii.getBundleMetadata(n,t.id)).then(e=>!!e&&e.createTime.compareTo(n)>=0)}(e.localStore,i))return await t.close(),n._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);n._updateProgress(uy(i));let s=new up(i,t.serializer),a=await t.bu();for(;a;){let e=await s.Ga(a);e&&n._updateProgress(e),a=await t.bu()}let o=await s.ja(e.localStore);return await uG(e,o.Ha,void 0),await (r=e.localStore,r.persistence.runTransaction("Save bundle","readwrite",e=>r.Ii.saveBundleMetadata(e,i))),n._completeWith(o.progress),Promise.resolve(o.Ja)}catch(e){return tx(uI,"Loading bundle failed with ".concat(e)),n._failWith(e),Promise.resolve(new Set)}})(t=await cg(e),s,r).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(n,e._databaseId,t,r),r}function c$(e,t){var n;return(n=cj(e=t8(e,cB)),n.asyncQueue.enqueue(async()=>{var e;return e=await cd(n),e.persistence.runTransaction("Get named query","readonly",n=>e.Ii.getNamedQuery(n,t))})).then(t=>t?new cS(e,null,t.query):null)}class c0{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class c1{data(){return this._userDataWriter.convertObjectMap(this._data)}constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}}class c2{static fromBase64String(e){try{return new c2(rj.fromBase64String(e))}catch(e){throw new tO(tR.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new c2(rj.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:c2._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ne(e,c2._jsonSchema))return c2.fromBase64String(e.bytes)}constructor(e){this._byteString=e}}c2._jsonSchemaVersion="firestore/bytes/1.0",c2._jsonSchema={type:t9("string",c2._jsonSchemaVersion),bytes:t9("string")};class c6{isEqual(e){return this._internalPath.isEqual(e._internalPath)}constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new tO(tR.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new t$(e)}}function c3(){return new c6(tJ)}class c4{constructor(e){this._methodName=e}}class c5{get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return tK(this._lat,e._lat)||tK(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:c5._jsonSchemaVersion}}static fromJSON(e){if(ne(e,c5._jsonSchema))return new c5(e.latitude,e.longitude)}constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new tO(tR.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new tO(tR.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}}c5._jsonSchemaVersion="firestore/geoPoint/1.0",c5._jsonSchema={type:t9("string",c5._jsonSchemaVersion),latitude:t9("number"),longitude:t9("number")};class c8{toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:c8._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ne(e,c8._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new c8(e.vectorValues);throw new tO(tR.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}constructor(e){this._values=(e||[]).map(e=>e)}}c8._jsonSchemaVersion="firestore/vectorValue/1.0",c8._jsonSchema={type:t9("string",c8._jsonSchemaVersion),vectorValues:t9("object")};let c7=/^__.*__$/;class c9{toMutation(e,t){return null!==this.fieldMask?new sM(e,this.data,this.fieldMask,t,this.fieldTransforms):new sO(e,this.data,t,this.fieldTransforms)}constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}}class he{toMutation(e,t){return new sM(e,this.data,this.fieldMask,t,this.fieldTransforms)}constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}}function ht(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw tA(40011,{Ac:e})}}class hn{get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new hn({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return h_(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(ht(this.Ac)&&c7.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}}class hr{Cc(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new hn({Ac:e,methodName:t,Dc:n,path:t$.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||lC(e)}}function hi(e){let t=e._freezeSettings(),n=lC(e._databaseId);return new hr(e._databaseId,!!t.ignoreUndefinedProperties,n)}function hs(e,t,n,r,i){let s,a,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},l=e.Cc(o.merge||o.mergeFields?2:0,t,n,i);hv("Data must be an object, but it was:",l,r);let u=hp(r,l);if(o.merge)s=new rB(l.fieldMask),a=l.fieldTransforms;else if(o.mergeFields){let e=[];for(let r of o.mergeFields){let i=hw(t,r,n);if(!l.contains(i))throw new tO(tR.INVALID_ARGUMENT,"Field '".concat(i,"' is specified in your field mask but missing from your input data."));hE(e,i)||e.push(i)}s=new rB(e),a=l.fieldTransforms.filter(e=>s.covers(e.field))}else s=null,a=l.fieldTransforms;return new c9(new ib(u),s,a)}class ha extends c4{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Sc("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ha}}function ho(e,t,n){return new hn({Ac:3,Dc:t.settings.Dc,methodName:e._methodName,fc:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class hl extends c4{_toFieldTransform(e){return new sS(e.path,new sy)}isEqual(e){return e instanceof hl}}class hu extends c4{_toFieldTransform(e){let t=ho(this,e,!0),n=new sv(this.vc.map(e=>hm(e,t)));return new sS(e.path,n)}isEqual(e){return e instanceof hu&&er(this.vc,e.vc)}constructor(e,t){super(e),this.vc=t}}class hc extends c4{_toFieldTransform(e){let t=ho(this,e,!0),n=new sb(this.vc.map(e=>hm(e,t)));return new sS(e.path,n)}isEqual(e){return e instanceof hc&&er(this.vc,e.vc)}constructor(e,t){super(e),this.vc=t}}class hh extends c4{_toFieldTransform(e){let t=new s_(e.serializer,sg(e.serializer,this.Fc));return new sS(e.path,t)}isEqual(e){return e instanceof hh&&this.Fc===e.Fc}constructor(e,t){super(e),this.Fc=t}}function hd(e,t,n,r){let i=e.Cc(1,t,n);hv("Data must be an object, but it was:",i,r);let s=[],a=ib.empty();return rN(r,(e,r)=>{let o=hI(t,e,n);r=eh(r);let l=i.yc(o);if(r instanceof ha)s.push(o);else{let e=hm(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new he(a,new rB(s),i.fieldTransforms)}function hf(e,t,n,r,i,s){let a=e.Cc(1,t,n),o=[hw(t,r,n)],l=[i];if(s.length%2!=0)throw new tO(tR.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let e=0;e<s.length;e+=2)o.push(hw(t,s[e])),l.push(s[e+1]);let u=[],c=ib.empty();for(let e=o.length-1;e>=0;--e)if(!hE(u,o[e])){let t=o[e],n=l[e];n=eh(n);let r=a.yc(t);if(n instanceof ha)u.push(t);else{let e=hm(n,r);null!=e&&(u.push(t),c.set(t,e))}}return new he(c,new rB(u),a.fieldTransforms)}function hg(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return hm(n,e.Cc(r?4:3,t))}function hm(e,t){if(hy(e=eh(e)))return hv("Unsupported field value:",t,e),hp(e,t);if(e instanceof c4)return function(e,t){if(!ht(t.Ac))throw t.Sc("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Sc("".concat(e._methodName,"() is not currently supported inside arrays"));let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=hm(i,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}return function(e,t){if(null===(e=eh(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return sg(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=nt.fromDate(e);return{timestampValue:ai(t.serializer,n)}}if(e instanceof nt){let n=new nt(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ai(t.serializer,n)}}if(e instanceof c5)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof c2)return{bytesValue:as(t.serializer,e._byteString)};if(e instanceof cx){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc("Document reference is for database ".concat(r.projectId,"/").concat(r.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:ao(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof c8)return{mapValue:{fields:{[r6]:{stringValue:r5},[r8]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return sd(t.serializer,e)})}}}}};throw t.Sc("Unsupported field value: ".concat(t5(e)))}(e,t)}function hp(e,t){let n={};return rR(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):rN(e,(e,r)=>{let i=hm(r,t.mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function hy(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof nt||e instanceof c5||e instanceof c2||e instanceof cx||e instanceof c4||e instanceof c8)}function hv(e,t,n){if(!hy(n)||!t4(n)){let r=t5(n);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function hw(e,t,n){if((t=eh(t))instanceof c6)return t._internalPath;if("string"==typeof t)return hI(e,t);throw h_("Field path arguments must be of type string or ",e,!1,void 0,n)}let hb=RegExp("[~\\*/\\[\\]]");function hI(e,t,n){if(t.search(hb)>=0)throw h_("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new c6(...t.split("."))._internalPath}catch(r){throw h_("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function h_(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o="Function ".concat(t,"() called with invalid data");n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=" in field ".concat(r)),a&&(l+=" in document ".concat(i)),l+=")"),new tO(tR.INVALID_ARGUMENT,o+e+l)}function hE(e,t){return e.some(e=>e.isEqual(t))}class hT{get id(){return this._key.path.lastSegment()}get ref(){return new cx(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new hS(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(hx("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}}class hS extends hT{data(){return super.data()}}function hx(e,t){return"string"==typeof t?hI(e,t):t instanceof c6?t._internalPath:t._delegate._internalPath}function hC(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new tO(tR.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class hA{}class hD extends hA{}function hN(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];let s=[];for(let n of(t instanceof hA&&s.push(t),function(e){let t=e.filter(e=>e instanceof hO).length,n=e.filter(e=>e instanceof hk).length;if(t>1||t>0&&n>0)throw new tO(tR.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s=s.concat(r)),s))e=n._apply(e);return e}class hk extends hD{static _create(e,t,n){return new hk(e,t,n)}_apply(e){let t=this._parse(e);return hX(e._query,t),new cS(e.firestore,e.converter,i3(e._query,t))}_parse(e){let t=hi(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new tO(tR.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(s,"' queries on documentId()."));if("in"===s||"not-in"===s){hJ(a,s);let t=[];for(let n of a)t.push(hW(r,e,n));o={arrayValue:{values:t}}}else o=hW(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||hJ(a,s),o=hg(n,t,a,"in"===s||"not-in"===s);return iC.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}}function hR(e,t,n){let r=hx("where",e);return hk._create(r,t,n)}class hO extends hA{static _create(e,t){return new hO(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:iA.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())hX(n,e),n=i3(n,e)}(e._query,t),new cS(e.firestore,e.converter,i3(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}constructor(e,t){super(),this.type=e,this._queryConstraints=t}}function hM(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.forEach(e=>hY("or",e)),hO._create("or",t)}function hP(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.forEach(e=>hY("and",e)),hO._create("and",t)}class hL extends hD{static _create(e,t){return new hL(e,t)}_apply(e){let t=function(e,t,n){if(null!==e.startAt)throw new tO(tR.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new tO(tR.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new iS(t,n)}(e._query,this._field,this._direction);return new cS(e.firestore,e.converter,function(e,t){let n=e.explicitOrderBy.concat([t]);return new iX(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}}function hF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=hx("orderBy",e);return hL._create(n,t)}class hV extends hD{static _create(e,t,n){return new hV(e,t,n)}_apply(e){return new cS(e.firestore,e.converter,i4(e._query,this._limit,this._limitType))}constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}}function hB(e){return t7("limit",e),hV._create("limit",e,"F")}function hU(e){return t7("limitToLast",e),hV._create("limitToLast",e,"L")}class hq extends hD{static _create(e,t,n){return new hq(e,t,n)}_apply(e){var t;let n=hH(e,this.type,this._docOrFields,this._inclusive);return new cS(e.firestore,e.converter,(t=e._query,new iX(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt)))}constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}}function hj(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return hq._create("startAt",t,!0)}function hz(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return hq._create("startAfter",t,!1)}class hG extends hD{static _create(e,t,n){return new hG(e,t,n)}_apply(e){var t;let n=hH(e,this.type,this._docOrFields,this._inclusive);return new cS(e.firestore,e.converter,(t=e._query,new iX(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n)))}constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}}function hK(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return hG._create("endBefore",t,!1)}function hQ(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return hG._create("endAt",t,!0)}function hH(e,t,n,r){if(n[0]=eh(n[0]),n[0]instanceof hT)return function(e,t,n,r,i){if(!r)throw new tO(tR.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));let s=[];for(let n of i0(e))if(n.field.isKeyField())s.push(io(t,r.key));else{let e=r.data.field(n.field);if(rY(e))throw new tO(tR.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new tO(tR.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(e,"' (used as the orderBy) does not exist."))}s.push(e)}return new i_(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=hi(e.firestore);return function(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new tO(tR.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new tO(tR.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof l));if(!i$(e)&&-1!==l.indexOf("/"))throw new tO(tR.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(l,"' contains a slash."));let n=e.path.child(tY.fromString(l));if(!t0.isDocumentKey(n))throw new tO(tR.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(n,"' is not because it contains an odd number of segments."));let i=new t0(n);o.push(io(t,i))}else{let e=hg(n,r,l);o.push(e)}}return new i_(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function hW(e,t,n){if("string"==typeof(n=eh(n))){if(""===n)throw new tO(tR.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!i$(t)&&-1!==n.indexOf("/"))throw new tO(tR.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));let r=t.path.child(tY.fromString(n));if(!t0.isDocumentKey(r))throw new tO(tR.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return io(e,new t0(r))}if(n instanceof cx)return io(e,n._key);throw new tO(tR.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(t5(n),"."))}function hJ(e,t){if(!Array.isArray(e)||0===e.length)throw new tO(tR.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function hX(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new tO(tR.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new tO(tR.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}function hY(e,t){if(!(t instanceof hk||t instanceof hO))throw new tO(tR.INVALID_ARGUMENT,"Function ".concat(e,"() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'."))}class hZ{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(r9(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rK(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(rQ(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw tA(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",n={};return rN(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;return new c8(null==(r=e.fields)||null==(n=r[r8].arrayValue)||null==(t=n.values)?void 0:t.map(e=>rK(e.doubleValue)))}convertGeoPoint(e){return new c5(rK(e.latitude),rK(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=rZ(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(r$(e));default:return null}}convertTimestamp(e){let t=rG(e);return new nt(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=tY.fromString(e);tN(ax(n),9688,{name:e});let r=new r2(n.get(1),n.get(3)),i=new t0(n.popFirst(5));return r.isEqual(t)||tS("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}function h$(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class h0 extends hZ{convertBytes(e){return new c2(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new cx(this.firestore,null,t)}constructor(e){super(),this.firestore=e}}function h1(e){return new c0("sum",hw("sum",e))}function h2(e){return new c0("avg",hw("average",e))}function h6(){return new c0("count")}function h3(e,t){var n,r;return e instanceof c0&&t instanceof c0&&e.aggregateType===t.aggregateType&&(null==(n=e._internalFieldPath)?void 0:n.canonicalString())===(null==(r=t._internalFieldPath)?void 0:r.canonicalString())}function h4(e,t){return cR(e.query,t.query)&&er(e.data(),t.data())}let h5="NOT SUPPORTED";class h8{isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}}class h7 extends hT{exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){let t=new de(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){let n=this._document.data.field(hx("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new tO(tR.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=h7._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}}function h9(e,t,n){if(ne(t,h7._jsonSchema)){var r;if(t.bundle===h5)throw new tO(tR.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=lC(e._databaseId),s=(r=t.bundle,new cn(r,i)),a=s.Wu(),o=new up(s.getMetadata(),i);for(let e of a)o.Ga(e);let l=o.documents;if(1!==l.length)throw new tO(tR.INVALID_ARGUMENT,"Expected bundle data to contain 1 document, but it contains ".concat(l.length," documents."));let u=ay(i,l[0].document),c=new t0(tY.fromString(t.bundleName));return new h7(e,new h0(e),c,u,new h8(!1,!1),n||null)}}h7._jsonSchemaVersion="firestore/documentSnapshot/1.0",h7._jsonSchema={type:t9("string",h7._jsonSchemaVersion),bundleSource:t9("string","DocumentSnapshot"),bundleName:t9("string"),bundle:t9("string")};class de extends h7{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class dt{get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new de(this._firestore,this._userDataWriter,n.key,n,new h8(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new tO(tR.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new de(e._firestore,e._userDataWriter,n.doc.key,n.doc,new h8(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new de(e._firestore,e._userDataWriter,t.doc.key,t.doc,new h8(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return tA(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new tO(tR.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=dt._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=tG.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new h8(r.hasPendingWrites,r.fromCache),this.query=n}}function dn(e,t,n){if(ne(t,dt._jsonSchema)){var r;if(t.bundle===h5)throw new tO(tR.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=lC(e._databaseId),s=(r=t.bundle,new cn(r,i)),a=s.Wu(),o=new up(s.getMetadata(),i);for(let e of a)o.Ga(e);if(1!==o.queries.length)throw new tO(tR.INVALID_ARGUMENT,"Snapshot data expected 1 query but found ".concat(o.queries.length," queries."));let l=aL(o.queries[0].bundledQuery),u=o.documents,c=new un;u.map(e=>{let t=ay(i,e.document);c=c.add(t)});let h=ui.fromInitialDocuments(l,c,sc(),!1,!1),d=new cS(e,n||null,l);return new dt(e,new h0(e),d,h)}}function dr(e,t){return e instanceof h7&&t instanceof h7?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof dt&&t instanceof dt&&e._firestore===t._firestore&&cR(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function di(e){e=t8(e,cx);let t=t8(e.firestore,cB);return cy(cj(t),e._key).then(n=>db(t,e,n))}dt._jsonSchemaVersion="firestore/querySnapshot/1.0",dt._jsonSchema={type:t9("string",dt._jsonSchemaVersion),bundleSource:t9("string","QuerySnapshot"),bundleName:t9("string"),bundle:t9("string")};class ds extends hZ{convertBytes(e){return new c2(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new cx(this.firestore,null,t)}constructor(e){super(),this.firestore=e}}function da(e){e=t8(e,cx);let t=t8(e.firestore,cB),n=cj(t),r=new ds(t);return(function(e,t){let n=new tM;return e.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await e.persistence.runTransaction("read document","readonly",n=>e.localDocuments.getDocument(n,t));r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new tO(tR.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=ut(r,"Failed to get document '".concat(t," from cache"));n.reject(e)}})(await cd(e),t,n)),n.promise})(n,e._key).then(n=>new h7(t,r,e._key,n,new h8(null!==n&&n.hasLocalMutations,!0),e.converter))}function dl(e){e=t8(e,cx);let t=t8(e.firestore,cB);return cy(cj(t),e._key,{source:"server"}).then(n=>db(t,e,n))}function du(e){e=t8(e,cS);let t=t8(e.firestore,cB),n=cj(t),r=new ds(t);return hC(e._query),cv(n,e._query).then(n=>new dt(t,r,e,n))}function dc(e){e=t8(e,cS);let t=t8(e.firestore,cB),n=cj(t),r=new ds(t);return(function(e,t){let n=new tM;return e.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await o3(e,t,!0),i=new ub(t,r.Qs),s=i.ru(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(r){let e=ut(r,"Failed to execute query '".concat(t," against cache"));n.reject(e)}})(await cd(e),t,n)),n.promise})(n,e._query).then(n=>new dt(t,r,e,n))}function dh(e){e=t8(e,cS);let t=t8(e.firestore,cB),n=cj(t),r=new ds(t);return cv(n,e._query,{source:"server"}).then(n=>new dt(t,r,e,n))}function dd(e,t,n){e=t8(e,cx);let r=t8(e.firestore,cB),i=h$(e.converter,t,n);return dw(r,[hs(hi(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,sC.none())])}function df(e,t,n){for(var r=arguments.length,i=Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];e=t8(e,cx);let a=t8(e.firestore,cB),o=hi(a);return dw(a,[("string"==typeof(t=eh(t))||t instanceof c6?hf(o,"updateDoc",e._key,t,n,i):hd(o,"updateDoc",e._key,t)).toMutation(e._key,sC.exists(!0))])}function dg(e){return dw(t8(e.firestore,cB),[new sV(e._key,sC.none())])}function dm(e,t){let n=t8(e.firestore,cB),r=cN(e),i=h$(e.converter,t);return dw(n,[hs(hi(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,sC.exists(!1))]).then(()=>r)}function dp(e){let t,n,r;for(var i,s,a,o=arguments.length,l=Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];e=eh(e);let c={includeMetadataChanges:!1,source:"default"},h=0;"object"!=typeof l[0]||cL(l[h])||(c=l[h++]);let d={includeMetadataChanges:c.includeMetadataChanges,source:c.source};if(cL(l[h])){let e=l[h];l[h]=null==(i=e.next)?void 0:i.bind(e),l[h+1]=null==(s=e.error)?void 0:s.bind(e),l[h+2]=null==(a=e.complete)?void 0:a.bind(e)}if(e instanceof cx)n=t8(e.firestore,cB),r=iY(e._key.path),t={next:t=>{l[h]&&l[h](db(n,e,t))},error:l[h+1],complete:l[h+2]};else{let i=t8(e,cS);n=t8(i.firestore,cB),r=i._query;let s=new ds(n);t={next:e=>{l[h]&&l[h](new dt(n,s,i,e))},error:l[h+1],complete:l[h+2]},hC(e._query)}var f=cj(n),g=r;let m=new ce(t),p=new uf(g,m,d);return f.asyncQueue.enqueueAndForget(async()=>ul(await cp(f),p)),()=>{m.Nu(),f.asyncQueue.enqueueAndForget(async()=>uu(await cp(f),p))}}function dy(e,t){for(var n,r,i,s,a,o,l=arguments.length,u=Array(l>2?l-2:0),c=2;c<l;c++)u[c-2]=arguments[c];let h=eh(e),d=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let n of["bundle","bundleName","bundleSource"]){if(!(n in e)){t.error="snapshotJson missing required field: ".concat(n);break}let r=e[n];if("string"!=typeof r){t.error="snapshotJson field '".concat(n,"' must be a string.");break}if(0===r.length){t.error="snapshotJson field '".concat(n,"' cannot be an empty string.");break}"bundle"===n?t.bundle=r:"bundleName"===n?t.bundleName=r:"bundleSource"===n&&(t.bundleSource=r)}return t}(t);if(d.error)throw new tO(tR.INVALID_ARGUMENT,d.error);let f,g=0;if("object"!=typeof u[0]||cL(u[g])||(f=u[g++]),"QuerySnapshot"===d.bundleSource){let e,t,s=null;if("object"==typeof u[g]&&cL(u[g])){let e=u[g++];s={next:e.next,error:e.error,complete:e.complete}}else s={next:u[g++],error:u[g++],complete:u[g++]};return n=f,r=s,i=u[g],t=!1,cZ(h,d.bundle).then(()=>c$(h,d.bundleName)).then(s=>{s&&!t&&(i&&s.withConverter(i),e=dp(s,n||{},r))}).catch(e=>(r.error&&r.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===d.bundleSource){let e,t,n=null;if("object"==typeof u[g]&&cL(u[g])){let e=u[g++];n={next:e.next,error:e.error,complete:e.complete}}else n={next:u[g++],error:u[g++],complete:u[g++]};return s=f,a=n,o=u[g],t=!1,cZ(h,d.bundle).then(()=>{t||(e=dp(new cx(h,o||null,t0.fromPath(d.bundleName)),s||{},a))}).catch(e=>(a.error&&a.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new tO(tR.INVALID_ARGUMENT,"unsupported bundle source: ".concat(d.bundleSource))}function dv(e,t){return function(e,t){let n=new ce(t);return e.asyncQueue.enqueueAndForget(async()=>{var t;return t=await cp(e),void(t.Ca.add(n),n.next())}),()=>{n.Nu(),e.asyncQueue.enqueueAndForget(async()=>{var t;return t=await cp(e),void t.Ca.delete(n)})}}(cj(e=t8(e,cB)),cL(t)?t:{next:t})}function dw(e,t){var n=cj(e);let r=new tM;return n.asyncQueue.enqueueAndForget(async()=>uk(await cg(n),t,r)),r.promise}function db(e,t,n){let r=n.docs.get(t._key),i=new ds(e);return new h7(e,i,t._key,r,new h8(n.hasPendingWrites,n.fromCache),t.converter)}function dI(e){return d_(e,{count:h6()})}function d_(e,t){let n=t8(e.firestore,cB),r=cj(n),i=rk(t,(e,t)=>new sz(t,e.aggregateType,e._internalFieldPath));return(function(e,t,n){let r=new tM;return e.asyncQueue.enqueueAndForget(async()=>{try{let i=await cm(e);r.resolve(async function(e,t,n){var r;let{request:i,gt:s,parent:a}=a_(e.serializer,i2(t),n);e.connection.$o||delete i.parent;let o=(await e.Ho("RunAggregationQuery",e.serializer.databaseId,a,i,1)).filter(e=>!!e.result);tN(1===o.length,64727);let l=null==(r=o[0].result)?void 0:r.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}(i,t,n))}catch(e){r.reject(e)}}),r.promise})(r,e._query,i).then(t=>new c1(e,new ds(n),t))}class dE{toJSON(){return{kind:this.kind}}constructor(e){this.kind="memory",this._onlineComponentProvider=u7.provider,this._offlineComponentProvider=(null==e?void 0:e.garbageCollector)?e.garbageCollector._offlineComponentProvider:{build:()=>new u4(void 0)}}}class dT{toJSON(){return{kind:this.kind}}constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=dO(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}}class dS{toJSON(){return{kind:this.kind}}constructor(){this.kind="memoryEager",this._offlineComponentProvider=u3.provider}}class dx{toJSON(){return{kind:this.kind}}constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new u4(e)}}}function dC(){return new dS}function dA(e){return new dx(null==e?void 0:e.cacheSizeBytes)}function dD(e){return new dE(e)}function dN(e){return new dT(e)}class dk{toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=u7.provider,this._offlineComponentProvider={build:t=>new u5(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}}class dR{toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=u7.provider,this._offlineComponentProvider={build:t=>new u8(t,null==e?void 0:e.cacheSizeBytes)}}constructor(){this.kind="PersistentMultipleTab"}}function dO(e){return new dk(null==e?void 0:e.forceOwnership)}function dM(){return new dR}let dP={maxAttempts:5};class dL{set(e,t,n){this._verifyNotCommitted();let r=dF(e,this._firestore),i=h$(r.converter,t,n),s=hs(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,sC.none())),this}update(e,t,n){let r;for(var i=arguments.length,s=Array(i>3?i-3:0),a=3;a<i;a++)s[a-3]=arguments[a];this._verifyNotCommitted();let o=dF(e,this._firestore);return r="string"==typeof(t=eh(t))||t instanceof c6?hf(this._dataReader,"WriteBatch.update",o._key,t,n,s):hd(this._dataReader,"WriteBatch.update",o._key,t),this._mutations.push(r.toMutation(o._key,sC.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=dF(e,this._firestore);return this._mutations=this._mutations.concat(new sV(t._key,sC.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new tO(tR.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=hi(e)}}function dF(e,t){if((e=eh(e)).firestore!==t)throw new tO(tR.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class dV{get(e){let t=dF(e,this._firestore),n=new h0(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return tA(24041);let r=e[0];if(r.isFoundDocument())return new hT(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new hT(this._firestore,n,t._key,null,t.converter);throw tA(18433,{doc:r})})}set(e,t,n){let r=dF(e,this._firestore),i=h$(r.converter,t,n),s=hs(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n){let r;for(var i=arguments.length,s=Array(i>3?i-3:0),a=3;a<i;a++)s[a-3]=arguments[a];let o=dF(e,this._firestore);return r="string"==typeof(t=eh(t))||t instanceof c6?hf(this._dataReader,"Transaction.update",o._key,t,n,s):hd(this._dataReader,"Transaction.update",o._key,t),this._transaction.update(o._key,r),this}delete(e){let t=dF(e,this._firestore);return this._transaction.delete(t._key),this}constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=hi(e)}}class dB extends dV{get(e){let t=dF(e,this._firestore),n=new ds(this._firestore);return super.get(e).then(e=>new h7(this._firestore,n,t._key,e._document,new h8(!1,!1),t.converter))}constructor(e,t){super(e,t),this._firestore=e}}function dU(e,t,n){e=t8(e,cB);let r={...dP,...n};if(r.maxAttempts<1)throw new tO(tR.INVALID_ARGUMENT,"Max attempts must be at least 1");return function(e,t,n){let r=new tM;return e.asyncQueue.enqueueAndForget(async()=>{let i=await cm(e);new ci(e.asyncQueue,i,n,t,r).ju()}),r.promise}(cj(e),n=>t(new dB(e,n)),r)}function dq(){return new ha("deleteField")}function dj(){return new hl("serverTimestamp")}function dz(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new hu("arrayUnion",t)}function dG(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new hc("arrayRemove",t)}function dK(e){return new hh("increment",e)}function dQ(e){return new c8(e)}function dH(e){return cj(e=t8(e,cB)),new dL(e,t=>dw(e,t))}function dW(e,t){let n=cj(e=t8(e,cB));if(!n._uninitializedComponentsProvider||"memory"===n._uninitializedComponentsProvider._offline.kind)return tx("Cannot enable indexes when persistence is disabled"),Promise.resolve();let r=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new tO(tR.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}(e):e,n=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=dJ(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=hI("setIndexConfiguration",dJ(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new no(e,2)):"ASCENDING"===t.order?r.push(new no(e,0)):"DESCENDING"===t.order&&r.push(new no(e,1))}n.push(new nr(nr.UNKNOWN_ID,t,r,nl.empty()))}return n}(t);return n.asyncQueue.enqueue(async()=>(async function(e,t){let n=e.indexManager,r=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(i=>(function(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=n(e[l],t[o]);s<0?i(e[l++]):s>0?r(t[o++]):(o++,l++)}for(;o<a;)r(t[o++]);for(;l<s;)i(e[l++])})(i,t,na,t=>{r.push(n.addFieldIndex(e,t))},t=>{r.push(n.deleteFieldIndex(e,t))})).next(()=>np.waitFor(r)))})(await cd(n),r))}function dJ(e,t){if("string"!=typeof e[t])throw new tO(tR.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class dX{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function dY(e){var t;e=t8(e,cB);let n=d2.get(e);if(n)return n;if("persistent"!==(null==(t=cj(e)._uninitializedComponentsProvider)?void 0:t._offline.kind))return null;let r=new dX(e);return d2.set(e,r),r}function dZ(e){d1(e,!0)}function d$(e){d1(e,!1)}function d0(e){var t;(t=cj(e._firestore)).asyncQueue.enqueue(async()=>(function(e){let t=e.indexManager;return e.persistence.runTransaction("Delete All Indexes","readwrite",e=>t.deleteAllFieldIndexes(e))})(await cd(t))).then(e=>tT("deleting all persistent cache indexes succeeded")).catch(e=>tx("deleting all persistent cache indexes failed",e))}function d1(e,t){var n;(n=cj(e._firestore),n.asyncQueue.enqueue(async()=>{var e;return e=await cd(n),void(e.Fs.Vs=t)})).then(e=>tT("setting persistent cache index auto creation isEnabled=".concat(t," succeeded"))).catch(e=>tx("setting persistent cache index auto creation isEnabled=".concat(t," failed"),e))}let d2=new WeakMap;function d6(e){var t;let n=null==(t=cj(t8(e.firestore,cB))._onlineComponents)?void 0:t.datastore.serializer;return void 0===n?null:aI(n,i1(e._query)).ft}function d3(e,t){var n;let r=rk(t,(e,t)=>new sz(t,e.aggregateType,e._internalFieldPath)),i=null==(n=cj(t8(e.firestore,cB))._onlineComponents)?void 0:n.datastore.serializer;return void 0===i?null:a_(i,i2(e._query),r,!0).request}class d4{static onExistenceFilterMismatch(e){return d5.instance.onExistenceFilterMismatch(e)}constructor(){throw Error("instances of this class should not be created")}}class d5{static get instance(){return d8||function(e){if(sH)throw Error("a TestingHooksSpi instance is already set");sH=e}(d8=new d5),d8}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),n=this.Mc;return n.set(t,e),()=>n.delete(t)}constructor(){this.Mc=new Map}}let d8=null;!function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];tb=e3,eH(new ed("firestore",(e,n)=>{let{instanceIdentifier:r,options:i}=n,s=e.getProvider("app").getImmediate(),a=new cB(new tV(e.getProvider("auth-internal")),new tj(s,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new tO(tR.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new r2(e.options.projectId,t)}(s,r),s);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),te(ty,tv,e),te(ty,tv,"esm2020")}()}]);